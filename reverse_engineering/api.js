"use strict";var Se=Object.defineProperty;var ni=Object.getOwnPropertyDescriptor;var ii=Object.getOwnPropertyNames;var ai=Object.prototype.hasOwnProperty;var i=(t,e)=>Se(t,"name",{value:e,configurable:!0});var oi=(t,e)=>()=>(t&&(e=t(t=0)),e);var _=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),ci=(t,e)=>{for(var r in e)Se(t,r,{get:e[r],enumerable:!0})},ui=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of ii(e))!ai.call(t,n)&&n!==r&&Se(t,n,{get:()=>e[n],enumerable:!(s=ni(e,n))||s.enumerable});return t};var li=t=>ui(Se({},"__esModule",{value:!0}),t);var Ir=_((Rl,Or)=>{"use strict";var pi=i(({title:t,logger:e,hiddenKeys:r})=>({info(s,n={}){e.log("info",{message:s,...n},t,r)},progress(s,n="",a=""){e.progress({message:s,containerName:n,entityName:a})},error(s){e.log("error",hi(s),t)}}),"createLogger"),hi=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError");Or.exports={createLogger:pi}});var ze=_(xr=>{"use strict";xr.parse=function(t,e){return new $e(t,e).parse()};var Te=class Te{constructor(e,r){this.source=e,this.transform=r||_i,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return e==="\\"?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var r;(this.recorded.length>0||e)&&(r=this.recorded.join(""),r==="NULL"&&!e&&(r=null),r!==null&&(r=this.transform(r)),this.entries.push(r),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var e=this.nextCharacter();if(e.value==="=")break}}parse(e){var r,s,n;for(this.consumeDimensions();!this.isEof();)if(r=this.nextCharacter(),r.value==="{"&&!n)this.dimension++,this.dimension>1&&(s=new Te(this.source.substr(this.position-1),this.transform),this.entries.push(s.parse(!0)),this.position+=s.position-2);else if(r.value==="}"&&!n){if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else r.value==='"'&&!r.escaped?(n&&this.newEntry(!0),n=!n):r.value===","&&!n?this.newEntry():this.record(r.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};i(Te,"ArrayParser");var $e=Te;function _i(t){return t}i(_i,"identity")});var Ke=_((xl,Lr)=>{var di=ze();Lr.exports={create:function(t,e){return{parse:function(){return di.parse(t,e)}}}}});var qr=_((Ll,Mr)=>{"use strict";var fi=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,mi=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,gi=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,yi=/^-?infinity$/;Mr.exports=i(function(e){if(yi.test(e))return Number(e.replace("i","I"));var r=fi.exec(e);if(!r)return Ei(e)||null;var s=!!r[8],n=parseInt(r[1],10);s&&(n=Pr(n));var a=parseInt(r[2],10)-1,o=r[3],c=parseInt(r[4],10),l=parseInt(r[5],10),u=parseInt(r[6],10),p=r[7];p=p?1e3*parseFloat(p):0;var h,g=Si(e);return g!=null?(h=new Date(Date.UTC(n,a,o,c,l,u,p)),Ye(n)&&h.setUTCFullYear(n),g!==0&&h.setTime(h.getTime()-g)):(h=new Date(n,a,o,c,l,u,p),Ye(n)&&h.setFullYear(n)),h},"parseDate");function Ei(t){var e=mi.exec(t);if(e){var r=parseInt(e[1],10),s=!!e[4];s&&(r=Pr(r));var n=parseInt(e[2],10)-1,a=e[3],o=new Date(r,n,a);return Ye(r)&&o.setFullYear(r),o}}i(Ei,"getDate");function Si(t){if(t.endsWith("+00"))return 0;var e=gi.exec(t.split(" ")[1]);if(e){var r=e[1];if(r==="Z")return 0;var s=r==="-"?-1:1,n=parseInt(e[2],10)*3600+parseInt(e[3]||0,10)*60+parseInt(e[4]||0,10);return n*s*1e3}}i(Si,"timeZoneOffset");function Pr(t){return-(t-1)}i(Pr,"bcYearToNegativeYear");function Ye(t){return t>=0&&t<100}i(Ye,"is0To99")});var Fr=_((Ml,Dr)=>{Dr.exports=Ai;var Ti=Object.prototype.hasOwnProperty;function Ai(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var s in r)Ti.call(r,s)&&(t[s]=r[s])}return t}i(Ai,"extend")});var Ur=_((Dl,Br)=>{"use strict";var bi=Fr();Br.exports=V;function V(t){if(!(this instanceof V))return new V(t);bi(this,qi(t))}i(V,"PostgresInterval");var vi=["seconds","minutes","hours","days","months","years"];V.prototype.toPostgres=function(){var t=vi.filter(this.hasOwnProperty,this);return this.milliseconds&&t.indexOf("seconds")<0&&t.push("seconds"),t.length===0?"0":t.map(function(e){var r=this[e]||0;return e==="seconds"&&this.milliseconds&&(r=(r+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),r+" "+e},this).join(" ")};var wi={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},Ci=["years","months","days"],Ri=["hours","minutes","seconds"];V.prototype.toISOString=V.prototype.toISO=function(){var t=Ci.map(r,this).join(""),e=Ri.map(r,this).join("");return"P"+t+"T"+e;function r(s){var n=this[s]||0;return s==="seconds"&&this.milliseconds&&(n=(n+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),n+wi[s]}};var Je="([+-]?\\d+)",Ni=Je+"\\s+years?",Oi=Je+"\\s+mons?",Ii=Je+"\\s+days?",xi="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",Li=new RegExp([Ni,Oi,Ii,xi].map(function(t){return"("+t+")?"}).join("\\s*")),kr={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},Pi=["hours","minutes","seconds","milliseconds"];function Mi(t){var e=t+"000000".slice(t.length);return parseInt(e,10)/1e3}i(Mi,"parseMilliseconds");function qi(t){if(!t)return{};var e=Li.exec(t),r=e[8]==="-";return Object.keys(kr).reduce(function(s,n){var a=kr[n],o=e[a];return!o||(o=n==="milliseconds"?Mi(o):parseInt(o,10),!o)||(r&&~Pi.indexOf(n)&&(o*=-1),s[n]=o),s},{})}i(qi,"parse")});var Qr=_((kl,Gr)=>{"use strict";Gr.exports=i(function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var r="",s=0;s<e.length;)if(e[s]!=="\\")r+=e[s],++s;else if(/[0-7]{3}/.test(e.substr(s+1,3)))r+=String.fromCharCode(parseInt(e.substr(s+1,3),8)),s+=4;else{for(var n=1;s+n<e.length&&e[s+n]==="\\";)n++;for(var a=0;a<Math.floor(n/2);++a)r+="\\";s+=Math.floor(n/2)*2}return new Buffer(r,"binary")},"parseBytea")});var Kr=_((Ul,zr)=>{var ie=ze(),ae=Ke(),Ae=qr(),jr=Ur(),Wr=Qr();function be(t){return i(function(r){return r===null?r:t(r)},"nullAllowed")}i(be,"allowNull");function Vr(t){return t===null?t:t==="TRUE"||t==="t"||t==="true"||t==="y"||t==="yes"||t==="on"||t==="1"}i(Vr,"parseBool");function Di(t){return t?ie.parse(t,Vr):null}i(Di,"parseBoolArray");function Fi(t){return parseInt(t,10)}i(Fi,"parseBaseTenInt");function Ze(t){return t?ie.parse(t,be(Fi)):null}i(Ze,"parseIntegerArray");function ki(t){return t?ie.parse(t,be(function(e){return $r(e).trim()})):null}i(ki,"parseBigIntegerArray");var Bi=i(function(t){if(!t)return null;var e=ae.create(t,function(r){return r!==null&&(r=rt(r)),r});return e.parse()},"parsePointArray"),Xe=i(function(t){if(!t)return null;var e=ae.create(t,function(r){return r!==null&&(r=parseFloat(r)),r});return e.parse()},"parseFloatArray"),L=i(function(t){if(!t)return null;var e=ae.create(t);return e.parse()},"parseStringArray"),et=i(function(t){if(!t)return null;var e=ae.create(t,function(r){return r!==null&&(r=Ae(r)),r});return e.parse()},"parseDateArray"),Ui=i(function(t){if(!t)return null;var e=ae.create(t,function(r){return r!==null&&(r=jr(r)),r});return e.parse()},"parseIntervalArray"),Gi=i(function(t){return t?ie.parse(t,be(Wr)):null},"parseByteAArray"),tt=i(function(t){return parseInt(t,10)},"parseInteger"),$r=i(function(t){var e=String(t);return/^\d+$/.test(e)?e:t},"parseBigInteger"),Hr=i(function(t){return t?ie.parse(t,be(JSON.parse)):null},"parseJsonArray"),rt=i(function(t){return t[0]!=="("?null:(t=t.substring(1,t.length-1).split(","),{x:parseFloat(t[0]),y:parseFloat(t[1])})},"parsePoint"),Qi=i(function(t){if(t[0]!=="<"&&t[1]!=="(")return null;for(var e="(",r="",s=!1,n=2;n<t.length-1;n++){if(s||(e+=t[n]),t[n]===")"){s=!0;continue}else if(!s)continue;t[n]!==","&&(r+=t[n])}var a=rt(e);return a.radius=parseFloat(r),a},"parseCircle"),Hi=i(function(t){t(20,$r),t(21,tt),t(23,tt),t(26,tt),t(700,parseFloat),t(701,parseFloat),t(16,Vr),t(1082,Ae),t(1114,Ae),t(1184,Ae),t(600,rt),t(651,L),t(718,Qi),t(1e3,Di),t(1001,Gi),t(1005,Ze),t(1007,Ze),t(1028,Ze),t(1016,ki),t(1017,Bi),t(1021,Xe),t(1022,Xe),t(1231,Xe),t(1014,L),t(1015,L),t(1008,L),t(1009,L),t(1040,L),t(1041,L),t(1115,et),t(1182,et),t(1185,et),t(1186,jr),t(1187,Ui),t(17,Wr),t(114,JSON.parse.bind(JSON)),t(3802,JSON.parse.bind(JSON)),t(199,Hr),t(3807,Hr),t(3907,L),t(2951,L),t(791,L),t(1183,L),t(1270,L)},"init");zr.exports={init:Hi}});var Jr=_((Ql,Yr)=>{"use strict";var O=1e6;function ji(t){var e=t.readInt32BE(0),r=t.readUInt32BE(4),s="";e<0&&(e=~e+(r===0),r=~r+1>>>0,s="-");var n="",a,o,c,l,u,p;{if(a=e%O,e=e/O>>>0,o=4294967296*a+r,r=o/O>>>0,c=""+(o-O*r),r===0&&e===0)return s+c+n;for(l="",u=6-c.length,p=0;p<u;p++)l+="0";n=l+c+n}{if(a=e%O,e=e/O>>>0,o=4294967296*a+r,r=o/O>>>0,c=""+(o-O*r),r===0&&e===0)return s+c+n;for(l="",u=6-c.length,p=0;p<u;p++)l+="0";n=l+c+n}{if(a=e%O,e=e/O>>>0,o=4294967296*a+r,r=o/O>>>0,c=""+(o-O*r),r===0&&e===0)return s+c+n;for(l="",u=6-c.length,p=0;p<u;p++)l+="0";n=l+c+n}return a=e%O,o=4294967296*a+r,c=""+o%O,s+c+n}i(ji,"readInt8");Yr.exports=ji});var rs=_((jl,ts)=>{var Wi=Jr(),E=i(function(t,e,r,s,n){r=r||0,s=s||!1,n=n||function(A,N,x){return A*Math.pow(2,x)+N};var a=r>>3,o=i(function(A){return s?~A&255:A},"inv"),c=255,l=8-r%8;e<l&&(c=255<<8-e&255,l=e),r&&(c=c>>r%8);var u=0;r%8+e>=8&&(u=n(0,o(t[a])&c,l));for(var p=e+r>>3,h=a+1;h<p;h++)u=n(u,o(t[h]),8);var g=(e+r)%8;return g>0&&(u=n(u,o(t[p])>>8-g,g)),u},"parseBits"),es=i(function(t,e,r){var s=Math.pow(2,r-1)-1,n=E(t,1),a=E(t,r,1);if(a===0)return 0;var o=1,c=i(function(u,p,h){u===0&&(u=1);for(var g=1;g<=h;g++)o/=2,(p&1<<h-g)>0&&(u+=o);return u},"parsePrecisionBits"),l=E(t,e,r+1,!1,c);return a==Math.pow(2,r+1)-1?l===0?n===0?1/0:-1/0:NaN:(n===0?1:-1)*Math.pow(2,a-s)*l},"parseFloatFromBits"),Vi=i(function(t){return E(t,1)==1?-1*(E(t,15,1,!0)+1):E(t,15,1)},"parseInt16"),Zr=i(function(t){return E(t,1)==1?-1*(E(t,31,1,!0)+1):E(t,31,1)},"parseInt32"),$i=i(function(t){return es(t,23,8)},"parseFloat32"),zi=i(function(t){return es(t,52,11)},"parseFloat64"),Ki=i(function(t){var e=E(t,16,32);if(e==49152)return NaN;for(var r=Math.pow(1e4,E(t,16,16)),s=0,n=[],a=E(t,16),o=0;o<a;o++)s+=E(t,16,64+16*o)*r,r/=1e4;var c=Math.pow(10,E(t,16,48));return(e===0?1:-1)*Math.round(s*c)/c},"parseNumeric"),Xr=i(function(t,e){var r=E(e,1),s=E(e,63,1),n=new Date((r===0?1:-1)*s/1e3+9466848e5);return t||n.setTime(n.getTime()+n.getTimezoneOffset()*6e4),n.usec=s%1e3,n.getMicroSeconds=function(){return this.usec},n.setMicroSeconds=function(a){this.usec=a},n.getUTCMicroSeconds=function(){return this.usec},n},"parseDate"),oe=i(function(t){for(var e=E(t,32),r=E(t,32,32),s=E(t,32,64),n=96,a=[],o=0;o<e;o++)a[o]=E(t,32,n),n+=32,n+=32;var c=i(function(u){var p=E(t,32,n);if(n+=32,p==4294967295)return null;var h;if(u==23||u==20)return h=E(t,p*8,n),n+=p*8,h;if(u==25)return h=t.toString(this.encoding,n>>3,(n+=p<<3)>>3),h;console.log("ERROR: ElementType not implemented: "+u)},"parseElement"),l=i(function(u,p){var h=[],g;if(u.length>1){var A=u.shift();for(g=0;g<A;g++)h[g]=l(u,p);u.unshift(A)}else for(g=0;g<u[0];g++)h[g]=c(p);return h},"parse");return l(a,s)},"parseArray"),Yi=i(function(t){return t.toString("utf8")},"parseText"),Ji=i(function(t){return t===null?null:E(t,8)>0},"parseBool"),Zi=i(function(t){t(20,Wi),t(21,Vi),t(23,Zr),t(26,Zr),t(1700,Ki),t(700,$i),t(701,zi),t(16,Ji),t(1114,Xr.bind(null,!1)),t(1184,Xr.bind(null,!0)),t(1e3,oe),t(1007,oe),t(1016,oe),t(1008,oe),t(1009,oe),t(25,Yi)},"init");ts.exports={init:Zi}});var ns=_((Vl,ss)=>{ss.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var le=_(ue=>{var Xi=Kr(),ea=rs(),ta=Ke(),ra=ns();ue.getTypeParser=sa;ue.setTypeParser=na;ue.arrayParser=ta;ue.builtins=ra;var ce={text:{},binary:{}};function is(t){return String(t)}i(is,"noParse");function sa(t,e){return e=e||"text",ce[e]&&ce[e][t]||is}i(sa,"getTypeParser");function na(t,e,r){typeof e=="function"&&(r=e,e="text"),ce[e][t]=r}i(na,"setTypeParser");Xi.init(function(t,e){ce.text[t]=e});ea.init(function(t,e){ce.binary[t]=e})});var pe=_((Kl,st)=>{"use strict";st.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var $=le(),ia=$.getTypeParser(20,"text"),aa=$.getTypeParser(1016,"text");st.exports.__defineSetter__("parseInt8",function(t){$.setTypeParser(20,"text",t?$.getTypeParser(23,"text"):ia),$.setTypeParser(1016,"text",t?$.getTypeParser(1007,"text"):aa)})});var he=_((Yl,os)=>{"use strict";var oa=pe();function ca(t){var e=t.replace(/\\/g,"\\\\").replace(/"/g,'\\"');return'"'+e+'"'}i(ca,"escapeElement");function as(t){for(var e="{",r=0;r<t.length;r++)if(r>0&&(e=e+","),t[r]===null||typeof t[r]>"u")e=e+"NULL";else if(Array.isArray(t[r]))e=e+as(t[r]);else if(ArrayBuffer.isView(t[r])){var s=t[r];if(!(s instanceof Buffer)){var n=Buffer.from(s.buffer,s.byteOffset,s.byteLength);n.length===s.byteLength?s=n:s=n.slice(s.byteOffset,s.byteOffset+s.byteLength)}e+="\\\\x"+s.toString("hex")}else e+=ca(ve(t[r]));return e=e+"}",e}i(as,"arrayString");var ve=i(function(t,e){if(t==null)return null;if(t instanceof Buffer)return t;if(ArrayBuffer.isView(t)){var r=Buffer.from(t.buffer,t.byteOffset,t.byteLength);return r.length===t.byteLength?r:r.slice(t.byteOffset,t.byteOffset+t.byteLength)}return t instanceof Date?oa.parseInputDatesAsUTC?pa(t):la(t):Array.isArray(t)?as(t):typeof t=="object"?ua(t,e):t.toString()},"prepareValue");function ua(t,e){if(t&&typeof t.toPostgres=="function"){if(e=e||[],e.indexOf(t)!==-1)throw new Error('circular reference detected while preparing "'+t+'" for query');return e.push(t),ve(t.toPostgres(ve),e)}return JSON.stringify(t)}i(ua,"prepareObject");function C(t,e){for(t=""+t;t.length<e;)t="0"+t;return t}i(C,"pad");function la(t){var e=-t.getTimezoneOffset(),r=t.getFullYear(),s=r<1;s&&(r=Math.abs(r)+1);var n=C(r,4)+"-"+C(t.getMonth()+1,2)+"-"+C(t.getDate(),2)+"T"+C(t.getHours(),2)+":"+C(t.getMinutes(),2)+":"+C(t.getSeconds(),2)+"."+C(t.getMilliseconds(),3);return e<0?(n+="-",e*=-1):n+="+",n+=C(Math.floor(e/60),2)+":"+C(e%60,2),s&&(n+=" BC"),n}i(la,"dateToString");function pa(t){var e=t.getUTCFullYear(),r=e<1;r&&(e=Math.abs(e)+1);var s=C(e,4)+"-"+C(t.getUTCMonth()+1,2)+"-"+C(t.getUTCDate(),2)+"T"+C(t.getUTCHours(),2)+":"+C(t.getUTCMinutes(),2)+":"+C(t.getUTCSeconds(),2)+"."+C(t.getUTCMilliseconds(),3);return s+="+00:00",r&&(s+=" BC"),s}i(pa,"dateToStringUTC");function ha(t,e,r){return t=typeof t=="string"?{text:t}:t,e&&(typeof e=="function"?t.callback=e:t.values=e),r&&(t.callback=r),t}i(ha,"normalizeQueryConfig");var _a=i(function(t){return'"'+t.replace(/"/g,'""')+'"'},"escapeIdentifier"),da=i(function(t){for(var e=!1,r="'",s=0;s<t.length;s++){var n=t[s];n==="'"?r+=n+n:n==="\\"?(r+=n+n,e=!0):r+=n}return r+="'",e===!0&&(r=" E"+r),r},"escapeLiteral");os.exports={prepareValue:i(function(e){return ve(e)},"prepareValueWrapper"),normalizeQueryConfig:ha,escapeIdentifier:_a,escapeLiteral:da}});var us=_((Zl,cs)=>{"use strict";var _e=require("crypto");function nt(t){return _e.createHash("md5").update(t,"utf-8").digest("hex")}i(nt,"md5");function fa(t,e,r){var s=nt(e+t),n=nt(Buffer.concat([Buffer.from(s),r]));return"md5"+n}i(fa,"postgresMd5PasswordHash");function ma(t){return _e.createHash("sha256").update(t).digest()}i(ma,"sha256");function ga(t,e){return _e.createHmac("sha256",t).update(e).digest()}i(ga,"hmacSha256");async function ya(t,e,r){return _e.pbkdf2Sync(t,e,r,32,"sha256")}i(ya,"deriveKey");cs.exports={postgresMd5PasswordHash:fa,randomBytes:_e.randomBytes,deriveKey:ya,sha256:ma,hmacSha256:ga,md5:nt}});var _s=_((ep,hs)=>{var ls=require("crypto");hs.exports={postgresMd5PasswordHash:Sa,randomBytes:Ea,deriveKey:ba,sha256:Ta,hmacSha256:Aa,md5:it};var ps=ls.webcrypto||globalThis.crypto,z=ps.subtle,at=new TextEncoder;function Ea(t){return ps.getRandomValues(Buffer.alloc(t))}i(Ea,"randomBytes");async function it(t){try{return ls.createHash("md5").update(t,"utf-8").digest("hex")}catch{let r=typeof t=="string"?at.encode(t):t,s=await z.digest("MD5",r);return Array.from(new Uint8Array(s)).map(n=>n.toString(16).padStart(2,"0")).join("")}}i(it,"md5");async function Sa(t,e,r){var s=await it(e+t),n=await it(Buffer.concat([Buffer.from(s),r]));return"md5"+n}i(Sa,"postgresMd5PasswordHash");async function Ta(t){return await z.digest("SHA-256",t)}i(Ta,"sha256");async function Aa(t,e){let r=await z.importKey("raw",t,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await z.sign("HMAC",r,at.encode(e))}i(Aa,"hmacSha256");async function ba(t,e,r){let s=await z.importKey("raw",at.encode(t),"PBKDF2",!1,["deriveBits"]),n={name:"PBKDF2",hash:"SHA-256",salt:e,iterations:r};return await z.deriveBits(n,s,32*8,["deriveBits"])}i(ba,"deriveKey")});var ct=_((rp,ot)=>{"use strict";var va=parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15;va?ot.exports=us():ot.exports=_s()});var gs=_((sp,ms)=>{"use strict";var H=ct();function wa(t){if(t.indexOf("SCRAM-SHA-256")===-1)throw new Error("SASL: Only mechanism SCRAM-SHA-256 is currently supported");let e=H.randomBytes(18).toString("base64");return{mechanism:"SCRAM-SHA-256",clientNonce:e,response:"n,,n=*,r="+e,message:"SASLInitialResponse"}}i(wa,"startSession");async function Ca(t,e,r){if(t.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(e==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof r!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let s=Oa(r);if(s.nonce.startsWith(t.clientNonce)){if(s.nonce.length===t.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");var n="n=*,r="+t.clientNonce,a="r="+s.nonce+",s="+s.salt+",i="+s.iteration,o="c=biws,r="+s.nonce,c=n+","+a+","+o,l=Buffer.from(s.salt,"base64"),u=await H.deriveKey(e,l,s.iteration),p=await H.hmacSha256(u,"Client Key"),h=await H.sha256(p),g=await H.hmacSha256(h,c),A=xa(Buffer.from(p),Buffer.from(g)).toString("base64"),N=await H.hmacSha256(u,"Server Key"),x=await H.hmacSha256(N,c);t.message="SASLResponse",t.serverSignature=Buffer.from(x).toString("base64"),t.response=o+",p="+A}i(Ca,"continueSession");function Ra(t,e){if(t.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:r}=Ia(e);if(r!==t.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}i(Ra,"finalizeSession");function Na(t){if(typeof t!="string")throw new TypeError("SASL: text must be a string");return t.split("").map((e,r)=>t.charCodeAt(r)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}i(Na,"isPrintableChars");function ds(t){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(t)}i(ds,"isBase64");function fs(t){if(typeof t!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(t.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");let r=e[0],s=e.substring(2);return[r,s]}))}i(fs,"parseAttributePairs");function Oa(t){let e=fs(t),r=e.get("r");if(r){if(!Na(r))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let s=e.get("s");if(s){if(!ds(s))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let n=e.get("i");if(n){if(!/^[1-9][0-9]*$/.test(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let a=parseInt(n,10);return{nonce:r,salt:s,iteration:a}}i(Oa,"parseServerFirstMessage");function Ia(t){let r=fs(t).get("v");if(r){if(!ds(r))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:r}}i(Ia,"parseServerFinalMessage");function xa(t,e){if(!Buffer.isBuffer(t))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(t.length!==e.length)throw new Error("Buffer lengths must match");if(t.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(t.map((r,s)=>t[s]^e[s]))}i(xa,"xorBuffers");ms.exports={startSession:wa,continueSession:Ca,finalizeSession:Ra}});var ut=_((ip,ys)=>{"use strict";var La=le();function we(t){this._types=t||La,this.text={},this.binary={}}i(we,"TypeOverrides");we.prototype.getOverrides=function(t){switch(t){case"text":return this.text;case"binary":return this.binary;default:return{}}};we.prototype.setTypeParser=function(t,e,r){typeof e=="function"&&(r=e,e="text"),this.getOverrides(e)[t]=r};we.prototype.getTypeParser=function(t,e){return e=e||"text",this.getOverrides(e)[t]||this._types.getTypeParser(t,e)};ys.exports=we});var Ss=_((op,Es)=>{"use strict";function lt(t){if(t.charAt(0)==="/"){let c=t.split(" ");return{host:c[0],database:c[1]}}let e={},r,s=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(t)&&(t=encodeURI(t).replace(/\%25(\d\d)/g,"%$1"));try{r=new URL(t,"postgres://base")}catch{r=new URL(t.replace("@/","@___DUMMY___/"),"postgres://base"),s=!0}for(let c of r.searchParams.entries())e[c[0]]=c[1];if(e.user=e.user||decodeURIComponent(r.username),e.password=e.password||decodeURIComponent(r.password),r.protocol=="socket:")return e.host=decodeURI(r.pathname),e.database=r.searchParams.get("db"),e.client_encoding=r.searchParams.get("encoding"),e;let n=s?"":r.hostname;e.host?n&&/^%2f/i.test(n)&&(r.pathname=n+r.pathname):e.host=decodeURIComponent(n),e.port||(e.port=r.port);let a=r.pathname.slice(1)||null;e.database=a?decodeURI(a):null,(e.ssl==="true"||e.ssl==="1")&&(e.ssl=!0),e.ssl==="0"&&(e.ssl=!1),(e.sslcert||e.sslkey||e.sslrootcert||e.sslmode)&&(e.ssl={});let o=e.sslcert||e.sslkey||e.sslrootcert?require("fs"):null;switch(e.sslcert&&(e.ssl.cert=o.readFileSync(e.sslcert).toString()),e.sslkey&&(e.ssl.key=o.readFileSync(e.sslkey).toString()),e.sslrootcert&&(e.ssl.ca=o.readFileSync(e.sslrootcert).toString()),e.sslmode){case"disable":{e.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{e.ssl.rejectUnauthorized=!1;break}}return e}i(lt,"parse");Es.exports=lt;lt.parse=lt});var _t=_((up,bs)=>{"use strict";var Pa=require("dns"),As=pe(),Ts=Ss().parse,R=i(function(t,e,r){return r===void 0?r=process.env["PG"+t.toUpperCase()]:r===!1||(r=process.env[r]),e[t]||r||As[t]},"val"),Ma=i(function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return As.ssl},"readSSLConfigFromEnvironment"),K=i(function(t){return"'"+(""+t).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),P=i(function(t,e,r){var s=e[r];s!=null&&t.push(r+"="+K(s))},"add"),ht=class ht{constructor(e){e=typeof e=="string"?Ts(e):e||{},e.connectionString&&(e=Object.assign({},e,Ts(e.connectionString))),this.user=R("user",e),this.database=R("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(R("port",e),10),this.host=R("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:R("password",e)}),this.binary=R("binary",e),this.options=R("options",e),this.ssl=typeof e.ssl>"u"?Ma():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=R("client_encoding",e),this.replication=R("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=R("application_name",e,"PGAPPNAME"),this.fallback_application_name=R("fallback_application_name",e,!1),this.statement_timeout=R("statement_timeout",e,!1),this.lock_timeout=R("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=R("idle_in_transaction_session_timeout",e,!1),this.query_timeout=R("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){var r=[];P(r,this,"user"),P(r,this,"password"),P(r,this,"port"),P(r,this,"application_name"),P(r,this,"fallback_application_name"),P(r,this,"connect_timeout"),P(r,this,"options");var s=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(P(r,s,"sslmode"),P(r,s,"sslca"),P(r,s,"sslkey"),P(r,s,"sslcert"),P(r,s,"sslrootcert"),this.database&&r.push("dbname="+K(this.database)),this.replication&&r.push("replication="+K(this.replication)),this.host&&r.push("host="+K(this.host)),this.isDomainSocket)return e(null,r.join(" "));this.client_encoding&&r.push("client_encoding="+K(this.client_encoding)),Pa.lookup(this.host,function(n,a){return n?e(n,null):(r.push("hostaddr="+K(a)),e(null,r.join(" ")))})}};i(ht,"ConnectionParameters");var pt=ht;bs.exports=pt});var Cs=_((pp,ws)=>{"use strict";var qa=le(),vs=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,ft=class ft{constructor(e,r){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=r,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(e){var r;e.text?r=vs.exec(e.text):r=vs.exec(e.command),r&&(this.command=r[1],r[3]?(this.oid=parseInt(r[2],10),this.rowCount=parseInt(r[3],10)):r[2]&&(this.rowCount=parseInt(r[2],10)))}_parseRowAsArray(e){for(var r=new Array(e.length),s=0,n=e.length;s<n;s++){var a=e[s];a!==null?r[s]=this._parsers[s](a):r[s]=null}return r}parseRow(e){for(var r={...this._prebuiltEmptyResultObject},s=0,n=e.length;s<n;s++){var a=e[s],o=this.fields[s].name;a!==null?r[o]=this._parsers[s](a):r[o]=null}return r}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));for(var r={},s=0;s<e.length;s++){var n=e[s];r[n.name]=null,this._types?this._parsers[s]=this._types.getTypeParser(n.dataTypeID,n.format||"text"):this._parsers[s]=qa.getTypeParser(n.dataTypeID,n.format||"text")}this._prebuiltEmptyResultObject={...r}}};i(ft,"Result");var dt=ft;ws.exports=dt});var Is=_((_p,Os)=>{"use strict";var{EventEmitter:Da}=require("events"),Rs=Cs(),Ns=he(),gt=class gt extends Da{constructor(e,r,s){super(),e=Ns.normalizeQueryConfig(e,r,s),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new Rs(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new Rs(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let r;if(!this._canceledDueToError){try{r=this._result.parseRow(e.fields)}catch(s){this._canceledDueToError=s;return}this.emit("row",r,this._result),this._accumulateRows&&this._result.addRow(r)}}handleCommandComplete(e,r){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&r.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,r){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(r){process.nextTick(()=>{throw r})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let r=e.parsedStatements[this.name];return this.text&&r&&this.text!==r?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(e):e.query(this.text),null)}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,r){e.execute({portal:this.portal,rows:r}),r?e.flush():e.sync()}prepare(e){this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:Ns.prepareValue})}catch(r){this.handleError(r,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,r){}};i(gt,"Query");var mt=gt;Os.exports=mt});var Vt=_(d=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0});d.NoticeMessage=d.DataRowMessage=d.CommandCompleteMessage=d.ReadyForQueryMessage=d.NotificationResponseMessage=d.BackendKeyDataMessage=d.AuthenticationMD5Password=d.ParameterStatusMessage=d.ParameterDescriptionMessage=d.RowDescriptionMessage=d.Field=d.CopyResponse=d.CopyDataMessage=d.DatabaseError=d.copyDone=d.emptyQuery=d.replicationStart=d.portalSuspended=d.noData=d.closeComplete=d.bindComplete=d.parseComplete=void 0;d.parseComplete={name:"parseComplete",length:5};d.bindComplete={name:"bindComplete",length:5};d.closeComplete={name:"closeComplete",length:5};d.noData={name:"noData",length:5};d.portalSuspended={name:"portalSuspended",length:5};d.replicationStart={name:"replicationStart",length:4};d.emptyQuery={name:"emptyQuery",length:4};d.copyDone={name:"copyDone",length:4};var Lt=class Lt extends Error{constructor(e,r,s){super(e),this.length=r,this.name=s}};i(Lt,"DatabaseError");var yt=Lt;d.DatabaseError=yt;var Pt=class Pt{constructor(e,r){this.length=e,this.chunk=r,this.name="copyData"}};i(Pt,"CopyDataMessage");var Et=Pt;d.CopyDataMessage=Et;var Mt=class Mt{constructor(e,r,s,n){this.length=e,this.name=r,this.binary=s,this.columnTypes=new Array(n)}};i(Mt,"CopyResponse");var St=Mt;d.CopyResponse=St;var qt=class qt{constructor(e,r,s,n,a,o,c){this.name=e,this.tableID=r,this.columnID=s,this.dataTypeID=n,this.dataTypeSize=a,this.dataTypeModifier=o,this.format=c}};i(qt,"Field");var Tt=qt;d.Field=Tt;var Dt=class Dt{constructor(e,r){this.length=e,this.fieldCount=r,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};i(Dt,"RowDescriptionMessage");var At=Dt;d.RowDescriptionMessage=At;var Ft=class Ft{constructor(e,r){this.length=e,this.parameterCount=r,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};i(Ft,"ParameterDescriptionMessage");var bt=Ft;d.ParameterDescriptionMessage=bt;var kt=class kt{constructor(e,r,s){this.length=e,this.parameterName=r,this.parameterValue=s,this.name="parameterStatus"}};i(kt,"ParameterStatusMessage");var vt=kt;d.ParameterStatusMessage=vt;var Bt=class Bt{constructor(e,r){this.length=e,this.salt=r,this.name="authenticationMD5Password"}};i(Bt,"AuthenticationMD5Password");var wt=Bt;d.AuthenticationMD5Password=wt;var Ut=class Ut{constructor(e,r,s){this.length=e,this.processID=r,this.secretKey=s,this.name="backendKeyData"}};i(Ut,"BackendKeyDataMessage");var Ct=Ut;d.BackendKeyDataMessage=Ct;var Gt=class Gt{constructor(e,r,s,n){this.length=e,this.processId=r,this.channel=s,this.payload=n,this.name="notification"}};i(Gt,"NotificationResponseMessage");var Rt=Gt;d.NotificationResponseMessage=Rt;var Qt=class Qt{constructor(e,r){this.length=e,this.status=r,this.name="readyForQuery"}};i(Qt,"ReadyForQueryMessage");var Nt=Qt;d.ReadyForQueryMessage=Nt;var Ht=class Ht{constructor(e,r){this.length=e,this.text=r,this.name="commandComplete"}};i(Ht,"CommandCompleteMessage");var Ot=Ht;d.CommandCompleteMessage=Ot;var jt=class jt{constructor(e,r){this.length=e,this.fields=r,this.name="dataRow",this.fieldCount=r.length}};i(jt,"DataRowMessage");var It=jt;d.DataRowMessage=It;var Wt=class Wt{constructor(e,r){this.length=e,this.message=r,this.name="notice"}};i(Wt,"NoticeMessage");var xt=Wt;d.NoticeMessage=xt});var xs=_(Ce=>{"use strict";Object.defineProperty(Ce,"__esModule",{value:!0});Ce.Writer=void 0;var zt=class zt{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){var r=this.buffer.length-this.offset;if(r<e){var s=this.buffer,n=s.length+(s.length>>1)+e;this.buffer=Buffer.allocUnsafe(n),s.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{var r=Buffer.byteLength(e);this.ensure(r+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=r}return this.buffer[this.offset++]=0,this}addString(e=""){var r=Buffer.byteLength(e);return this.ensure(r),this.buffer.write(e,this.offset),this.offset+=r,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let r=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(r,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){var r=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),r}};i(zt,"Writer");var $t=zt;Ce.Writer=$t});var Ps=_(Ne=>{"use strict";Object.defineProperty(Ne,"__esModule",{value:!0});Ne.serialize=void 0;var Kt=xs(),S=new Kt.Writer,Fa=i(t=>{S.addInt16(3).addInt16(0);for(let s of Object.keys(t))S.addCString(s).addCString(t[s]);S.addCString("client_encoding").addCString("UTF8");var e=S.addCString("").flush(),r=e.length+4;return new Kt.Writer().addInt32(r).add(e).flush()},"startup"),ka=i(()=>{let t=Buffer.allocUnsafe(8);return t.writeInt32BE(8,0),t.writeInt32BE(80877103,4),t},"requestSsl"),Ba=i(t=>S.addCString(t).flush(112),"password"),Ua=i(function(t,e){return S.addCString(t).addInt32(Buffer.byteLength(e)).addString(e),S.flush(112)},"sendSASLInitialResponseMessage"),Ga=i(function(t){return S.addString(t).flush(112)},"sendSCRAMClientFinalMessage"),Qa=i(t=>S.addCString(t).flush(81),"query"),Ls=[],Ha=i(t=>{let e=t.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let r=t.types||Ls;for(var s=r.length,n=S.addCString(e).addCString(t.text).addInt16(s),a=0;a<s;a++)n.addInt32(r[a]);return S.flush(80)},"parse"),Y=new Kt.Writer,ja=i(function(t,e){for(let r=0;r<t.length;r++){let s=e?e(t[r],r):t[r];s==null?(S.addInt16(0),Y.addInt32(-1)):s instanceof Buffer?(S.addInt16(1),Y.addInt32(s.length),Y.add(s)):(S.addInt16(0),Y.addInt32(Buffer.byteLength(s)),Y.addString(s))}},"writeValues"),Wa=i((t={})=>{let e=t.portal||"",r=t.statement||"",s=t.binary||!1,n=t.values||Ls,a=n.length;return S.addCString(e).addCString(r),S.addInt16(a),ja(n,t.valueMapper),S.addInt16(a),S.add(Y.flush()),S.addInt16(s?1:0),S.flush(66)},"bind"),Va=Buffer.from([69,0,0,0,9,0,0,0,0,0]),$a=i(t=>{if(!t||!t.portal&&!t.rows)return Va;let e=t.portal||"",r=t.rows||0,s=Buffer.byteLength(e),n=4+s+1+4,a=Buffer.allocUnsafe(1+n);return a[0]=69,a.writeInt32BE(n,1),a.write(e,5,"utf-8"),a[s+5]=0,a.writeUInt32BE(r,a.length-4),a},"execute"),za=i((t,e)=>{let r=Buffer.allocUnsafe(16);return r.writeInt32BE(16,0),r.writeInt16BE(1234,4),r.writeInt16BE(5678,6),r.writeInt32BE(t,8),r.writeInt32BE(e,12),r},"cancel"),Yt=i((t,e)=>{let s=4+Buffer.byteLength(e)+1,n=Buffer.allocUnsafe(1+s);return n[0]=t,n.writeInt32BE(s,1),n.write(e,5,"utf-8"),n[s]=0,n},"cstringMessage"),Ka=S.addCString("P").flush(68),Ya=S.addCString("S").flush(68),Ja=i(t=>t.name?Yt(68,`${t.type}${t.name||""}`):t.type==="P"?Ka:Ya,"describe"),Za=i(t=>{let e=`${t.type}${t.name||""}`;return Yt(67,e)},"close"),Xa=i(t=>S.add(t).flush(100),"copyData"),eo=i(t=>Yt(102,t),"copyFail"),Re=i(t=>Buffer.from([t,0,0,0,4]),"codeOnlyBuffer"),to=Re(72),ro=Re(83),so=Re(88),no=Re(99),io={startup:Fa,password:Ba,requestSsl:ka,sendSASLInitialResponseMessage:Ua,sendSCRAMClientFinalMessage:Ga,query:Qa,parse:Ha,bind:Wa,execute:$a,describe:Ja,close:Za,flush:()=>to,sync:()=>ro,end:()=>so,copyData:Xa,copyDone:()=>no,copyFail:eo,cancel:za};Ne.serialize=io});var Ms=_(Oe=>{"use strict";Object.defineProperty(Oe,"__esModule",{value:!0});Oe.BufferReader=void 0;var ao=Buffer.allocUnsafe(0),Zt=class Zt{constructor(e=0){this.offset=e,this.buffer=ao,this.encoding="utf-8"}setBuffer(e,r){this.offset=e,this.buffer=r}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}string(e){let r=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,r}cstring(){let e=this.offset,r=e;for(;this.buffer[r++]!==0;);return this.offset=r,this.buffer.toString(this.encoding,e,r-1)}bytes(e){let r=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,r}};i(Zt,"BufferReader");var Jt=Zt;Oe.BufferReader=Jt});var Fs=_(Ie=>{"use strict";Object.defineProperty(Ie,"__esModule",{value:!0});Ie.Parser=void 0;var T=Vt(),oo=Ms(),Xt=1,co=4,qs=Xt+co,Ds=Buffer.allocUnsafe(0),tr=class tr{constructor(e){if(this.buffer=Ds,this.bufferLength=0,this.bufferOffset=0,this.reader=new oo.BufferReader,(e==null?void 0:e.mode)==="binary")throw new Error("Binary mode not supported yet");this.mode=(e==null?void 0:e.mode)||"text"}parse(e,r){this.mergeBuffer(e);let s=this.bufferOffset+this.bufferLength,n=this.bufferOffset;for(;n+qs<=s;){let a=this.buffer[n],o=this.buffer.readUInt32BE(n+Xt),c=Xt+o;if(c+n<=s){let l=this.handlePacket(n+qs,a,o,this.buffer);r(l),n+=c}else break}n===s?(this.buffer=Ds,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=s-n,this.bufferOffset=n)}mergeBuffer(e){if(this.bufferLength>0){let r=this.bufferLength+e.byteLength;if(r+this.bufferOffset>this.buffer.byteLength){let n;if(r<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)n=this.buffer;else{let a=this.buffer.byteLength*2;for(;r>=a;)a*=2;n=Buffer.allocUnsafe(a)}this.buffer.copy(n,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=n,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=r}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,r,s,n){switch(r){case 50:return T.bindComplete;case 49:return T.parseComplete;case 51:return T.closeComplete;case 110:return T.noData;case 115:return T.portalSuspended;case 99:return T.copyDone;case 87:return T.replicationStart;case 73:return T.emptyQuery;case 68:return this.parseDataRowMessage(e,s,n);case 67:return this.parseCommandCompleteMessage(e,s,n);case 90:return this.parseReadyForQueryMessage(e,s,n);case 65:return this.parseNotificationMessage(e,s,n);case 82:return this.parseAuthenticationResponse(e,s,n);case 83:return this.parseParameterStatusMessage(e,s,n);case 75:return this.parseBackendKeyData(e,s,n);case 69:return this.parseErrorMessage(e,s,n,"error");case 78:return this.parseErrorMessage(e,s,n,"notice");case 84:return this.parseRowDescriptionMessage(e,s,n);case 116:return this.parseParameterDescriptionMessage(e,s,n);case 71:return this.parseCopyInMessage(e,s,n);case 72:return this.parseCopyOutMessage(e,s,n);case 100:return this.parseCopyData(e,s,n);default:return new T.DatabaseError("received invalid response: "+r.toString(16),s,"error")}}parseReadyForQueryMessage(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.string(1);return new T.ReadyForQueryMessage(r,n)}parseCommandCompleteMessage(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.cstring();return new T.CommandCompleteMessage(r,n)}parseCopyData(e,r,s){let n=s.slice(e,e+(r-4));return new T.CopyDataMessage(r,n)}parseCopyInMessage(e,r,s){return this.parseCopyMessage(e,r,s,"copyInResponse")}parseCopyOutMessage(e,r,s){return this.parseCopyMessage(e,r,s,"copyOutResponse")}parseCopyMessage(e,r,s,n){this.reader.setBuffer(e,s);let a=this.reader.byte()!==0,o=this.reader.int16(),c=new T.CopyResponse(r,n,a,o);for(let l=0;l<o;l++)c.columnTypes[l]=this.reader.int16();return c}parseNotificationMessage(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.int32(),a=this.reader.cstring(),o=this.reader.cstring();return new T.NotificationResponseMessage(r,n,a,o)}parseRowDescriptionMessage(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.int16(),a=new T.RowDescriptionMessage(r,n);for(let o=0;o<n;o++)a.fields[o]=this.parseField();return a}parseField(){let e=this.reader.cstring(),r=this.reader.int32(),s=this.reader.int16(),n=this.reader.int32(),a=this.reader.int16(),o=this.reader.int32(),c=this.reader.int16()===0?"text":"binary";return new T.Field(e,r,s,n,a,o,c)}parseParameterDescriptionMessage(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.int16(),a=new T.ParameterDescriptionMessage(r,n);for(let o=0;o<n;o++)a.dataTypeIDs[o]=this.reader.int32();return a}parseDataRowMessage(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.int16(),a=new Array(n);for(let o=0;o<n;o++){let c=this.reader.int32();a[o]=c===-1?null:this.reader.string(c)}return new T.DataRowMessage(r,a)}parseParameterStatusMessage(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.cstring(),a=this.reader.cstring();return new T.ParameterStatusMessage(r,n,a)}parseBackendKeyData(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.int32(),a=this.reader.int32();return new T.BackendKeyDataMessage(r,n,a)}parseAuthenticationResponse(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.int32(),a={name:"authenticationOk",length:r};switch(n){case 0:break;case 3:a.length===8&&(a.name="authenticationCleartextPassword");break;case 5:if(a.length===12){a.name="authenticationMD5Password";let c=this.reader.bytes(4);return new T.AuthenticationMD5Password(r,c)}break;case 10:a.name="authenticationSASL",a.mechanisms=[];let o;do o=this.reader.cstring(),o&&a.mechanisms.push(o);while(o);break;case 11:a.name="authenticationSASLContinue",a.data=this.reader.string(r-8);break;case 12:a.name="authenticationSASLFinal",a.data=this.reader.string(r-8);break;default:throw new Error("Unknown authenticationOk message type "+n)}return a}parseErrorMessage(e,r,s,n){this.reader.setBuffer(e,s);let a={},o=this.reader.string(1);for(;o!=="\0";)a[o]=this.reader.cstring(),o=this.reader.string(1);let c=a.M,l=n==="notice"?new T.NoticeMessage(r,c):new T.DatabaseError(c,r,n);return l.severity=a.S,l.code=a.C,l.detail=a.D,l.hint=a.H,l.position=a.P,l.internalPosition=a.p,l.internalQuery=a.q,l.where=a.W,l.schema=a.s,l.table=a.t,l.column=a.c,l.dataType=a.d,l.constraint=a.n,l.file=a.F,l.line=a.L,l.routine=a.R,l}};i(tr,"Parser");var er=tr;Ie.Parser=er});var rr=_(U=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0});U.DatabaseError=U.serialize=U.parse=void 0;var uo=Vt();Object.defineProperty(U,"DatabaseError",{enumerable:!0,get:function(){return uo.DatabaseError}});var lo=Ps();Object.defineProperty(U,"serialize",{enumerable:!0,get:function(){return lo.serialize}});var po=Fs();function ho(t,e){let r=new po.Parser;return t.on("data",s=>r.parse(s,e)),new Promise(s=>t.on("end",()=>s()))}i(ho,"parse");U.parse=ho});var ks={};ci(ks,{default:()=>_o});var _o,Bs=oi(()=>{_o={}});var Us=_((Rp,sr)=>{sr.exports.getStream=i(function(e){let r=require("net");if(typeof r.Socket=="function")return new r.Socket;{let{CloudflareSocket:s}=(Bs(),li(ks));return new s(e)}},"getStream");sr.exports.getSecureStream=i(function(e){var r=require("tls");return r.connect?r.connect(e):(e.socket.startTls(e),e.socket)},"getSecureStream")});var ar=_((Ip,Gs)=>{"use strict";var Op=require("net"),fo=require("events").EventEmitter,{parse:mo,serialize:w}=rr(),{getStream:go,getSecureStream:yo}=Us(),Eo=w.flush(),So=w.sync(),To=w.end(),ir=class ir extends fo{constructor(e){super(),e=e||{},this.stream=e.stream||go(e.ssl),typeof this.stream=="function"&&(this.stream=this.stream(e)),this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;var r=this;this.on("newListener",function(s){s==="message"&&(r._emitMessage=!0)})}connect(e,r){var s=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,r),this.stream.once("connect",function(){s._keepAlive&&s.stream.setKeepAlive(!0,s._keepAliveInitialDelayMillis),s.emit("connect")});let n=i(function(a){s._ending&&(a.code==="ECONNRESET"||a.code==="EPIPE")||s.emit("error",a)},"reportStreamError");if(this.stream.on("error",n),this.stream.on("close",function(){s.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(a){var o=a.toString("utf8");switch(o){case"S":break;case"N":return s.stream.end(),s.emit("error",new Error("The server does not support SSL connections"));default:return s.stream.end(),s.emit("error",new Error("There was an error establishing an SSL connection"))}let c={socket:s.stream};s.ssl!==!0&&(Object.assign(c,s.ssl),"key"in s.ssl&&(c.key=s.ssl.key));var l=require("net");l.isIP&&l.isIP(r)===0&&(c.servername=r);try{s.stream=yo(c)}catch(u){return s.emit("error",u)}s.attachListeners(s.stream),s.stream.on("error",n),s.emit("sslconnect")})}attachListeners(e){mo(e,r=>{var s=r.name==="error"?"errorMessage":r.name;this._emitMessage&&this.emit("message",r),this.emit(s,r)})}requestSsl(){this.stream.write(w.requestSsl())}startup(e){this.stream.write(w.startup(e))}cancel(e,r){this._send(w.cancel(e,r))}password(e){this._send(w.password(e))}sendSASLInitialResponseMessage(e,r){this._send(w.sendSASLInitialResponseMessage(e,r))}sendSCRAMClientFinalMessage(e){this._send(w.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(w.query(e))}parse(e){this._send(w.parse(e))}bind(e){this._send(w.bind(e))}execute(e){this._send(w.execute(e))}flush(){this.stream.writable&&this.stream.write(Eo)}sync(){this._ending=!0,this._send(So)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(To,()=>{this.stream.end()})}close(e){this._send(w.close(e))}describe(e){this._send(w.describe(e))}sendCopyFromChunk(e){this._send(w.copyData(e))}endCopyFrom(){this._send(w.copyDone())}sendCopyFail(e){this._send(w.copyFail(e))}};i(ir,"Connection");var nr=ir;Gs.exports=nr});var Ws=_((Lp,js)=>{"use strict";var{Transform:Ao}=require("stream"),{StringDecoder:bo}=require("string_decoder"),G=Symbol("last"),xe=Symbol("decoder");function vo(t,e,r){let s;if(this.overflow){if(s=this[xe].write(t).split(this.matcher),s.length===1)return r();s.shift(),this.overflow=!1}else this[G]+=this[xe].write(t),s=this[G].split(this.matcher);this[G]=s.pop();for(let n=0;n<s.length;n++)try{Hs(this,this.mapper(s[n]))}catch(a){return r(a)}if(this.overflow=this[G].length>this.maxLength,this.overflow&&!this.skipOverflow){r(new Error("maximum buffer reached"));return}r()}i(vo,"transform");function wo(t){if(this[G]+=this[xe].end(),this[G])try{Hs(this,this.mapper(this[G]))}catch(e){return t(e)}t()}i(wo,"flush");function Hs(t,e){e!==void 0&&t.push(e)}i(Hs,"push");function Qs(t){return t}i(Qs,"noop");function Co(t,e,r){switch(t=t||/\r?\n/,e=e||Qs,r=r||{},arguments.length){case 1:typeof t=="function"?(e=t,t=/\r?\n/):typeof t=="object"&&!(t instanceof RegExp)&&!t[Symbol.split]&&(r=t,t=/\r?\n/);break;case 2:typeof t=="function"?(r=e,e=t,t=/\r?\n/):typeof e=="object"&&(r=e,e=Qs)}r=Object.assign({},r),r.autoDestroy=!0,r.transform=vo,r.flush=wo,r.readableObjectMode=!0;let s=new Ao(r);return s[G]="",s[xe]=new bo("utf8"),s.matcher=t,s.mapper=e,s.maxLength=r.maxLength,s.skipOverflow=r.skipOverflow||!1,s.overflow=!1,s._destroy=function(n,a){this._writableState.errorEmitted=!1,a(n)},s}i(Co,"split");js.exports=Co});var zs=_((Mp,F)=>{"use strict";var Vs=require("path"),Ro=require("stream").Stream,No=Ws(),$s=require("util"),Oo=5432,Le=process.platform==="win32",de=process.stderr,Io=56,xo=7,Lo=61440,Po=32768;function Mo(t){return(t&Lo)==Po}i(Mo,"isRegFile");var J=["host","port","database","user","password"],or=J.length,qo=J[or-1];function cr(){var t=de instanceof Ro&&de.writable===!0;if(t){var e=Array.prototype.slice.call(arguments).concat(`
`);de.write($s.format.apply($s,e))}}i(cr,"warn");Object.defineProperty(F.exports,"isWin",{get:function(){return Le},set:function(t){Le=t}});F.exports.warnTo=function(t){var e=de;return de=t,e};F.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(Le?Vs.join(e.APPDATA||"./","postgresql","pgpass.conf"):Vs.join(e.HOME||"./",".pgpass"));return r};F.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:Le?!0:(e=e||"<unkn>",Mo(t.mode)?t.mode&(Io|xo)?(cr('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(cr('WARNING: password file "%s" is not a plain file',e),!1))};var Do=F.exports.match=function(t,e){return J.slice(0,-1).reduce(function(r,s,n){return n==1&&Number(t[s]||Oo)===Number(e[s])?r&&!0:r&&(e[s]==="*"||e[s]===t[s])},!0)};F.exports.getPassword=function(t,e,r){var s,n=e.pipe(No());function a(l){var u=Fo(l);u&&ko(u)&&Do(t,u)&&(s=u[qo],n.end())}i(a,"onLine");var o=i(function(){e.destroy(),r(s)},"onEnd"),c=i(function(l){e.destroy(),cr("WARNING: error on reading file: %s",l),r(void 0)},"onErr");e.on("error",c),n.on("data",a).on("end",o).on("error",c)};var Fo=F.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",s=0,n=0,a=0,o={},c=!1,l=i(function(p,h,g){var A=t.substring(h,g);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(A=A.replace(/\\([:\\])/g,"$1")),o[J[p]]=A},"addToObj"),u=0;u<t.length-1;u+=1){if(e=t.charAt(u+1),r=t.charAt(u),c=s==or-1,c){l(s,n);break}u>=0&&e==":"&&r!=="\\"&&(l(s,n,u+1),n=u+2,s+=1)}return o=Object.keys(o).length===or?o:null,o},ko=F.exports.isValidEntry=function(t){for(var e={0:function(o){return o.length>0},1:function(o){return o==="*"?!0:(o=Number(o),isFinite(o)&&o>0&&o<9007199254740992&&Math.floor(o)===o)},2:function(o){return o.length>0},3:function(o){return o.length>0},4:function(o){return o.length>0}},r=0;r<J.length;r+=1){var s=e[r],n=t[J[r]]||"",a=s(n);if(!a)return!1}return!0}});var Ys=_((Fp,ur)=>{"use strict";var Dp=require("path"),Ks=require("fs"),Pe=zs();ur.exports=function(t,e){var r=Pe.getFileName();Ks.stat(r,function(s,n){if(s||!Pe.usePgPass(n,r))return e(void 0);var a=Ks.createReadStream(r);Pe.getPassword(t,a,e)})};ur.exports.warnTo=Pe.warnTo});var en=_((kp,Xs)=>{"use strict";var Bo=require("events").EventEmitter,Js=he(),lr=gs(),Uo=ut(),Go=_t(),Zs=Is(),Qo=pe(),Ho=ar(),jo=ct(),pr=class pr extends Bo{constructor(e){super(),this.connectionParameters=new Go(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var r=e||{};this._Promise=r.Promise||global.Promise,this._types=new Uo(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=r.connection||new Ho({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||Qo.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=i(s=>{process.nextTick(()=>{s.handleError(e,this.connection)})},"enqueueError");this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){var r=this,s=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let n=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(n)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{s._ending=!0,s.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?s.connect(this.host+"/.s.PGSQL."+this.port):s.connect(this.port,this.host),s.on("connect",function(){r.ssl?s.requestSsl():s.startup(r.getStartupConf())}),s.on("sslconnect",function(){s.startup(r.getStartupConf())}),this._attachListeners(s),s.once("end",()=>{let n=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(n),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(n):this._handleErrorEvent(n):this._connectionError||this._handleErrorEvent(n)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,s)=>{this._connect(n=>{n?s(n):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(s=>{if(s!==void 0){if(typeof s!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=s}else this.connectionParameters.password=this.password=null;e()}).catch(s=>{r.emit("error",s)});else if(this.password!==null)e();else try{Ys()(this.connectionParameters,n=>{n!==void 0&&(this.connectionParameters.password=this.password=n),e()})}catch(s){this.emit("error",s)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await jo.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=lr.startSession(e.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await lr.continueSession(this.saslSession,this.password,e.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{lr.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(e){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){var e=this.connectionParameters,r={user:e.user,database:e.database},s=e.application_name||e.fallback_application_name;return s&&(r.application_name=s),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){var s=this.connection;this.host&&this.host.indexOf("/")===0?s.connect(this.host+"/.s.PGSQL."+this.port):s.connect(this.port,this.host),s.on("connect",function(){s.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,s){return this._types.setTypeParser(e,r,s)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return Js.escapeIdentifier(e)}escapeLiteral(e){return Js.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,s){var n,a,o,c,l;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(o=e.query_timeout||this.connectionParameters.query_timeout,a=n=e,typeof r=="function"&&(n.callback=n.callback||r)):(o=this.connectionParameters.query_timeout,n=new Zs(e,r,s),n.callback||(a=new this._Promise((u,p)=>{n.callback=(h,g)=>h?p(h):u(g)}).catch(u=>{throw Error.captureStackTrace(u),u}))),o&&(l=n.callback,c=setTimeout(()=>{var u=new Error("Query read timeout");process.nextTick(()=>{n.handleError(u,this.connection)}),l(u),n.callback=()=>{};var p=this.queryQueue.indexOf(n);p>-1&&this.queryQueue.splice(p,1),this._pulseQueryQueue()},o),n.callback=(u,p)=>{clearTimeout(c),l(u,p)}),this.binary&&!n.binary&&(n.binary=!0),n._result&&!n._result._types&&(n._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"),this.connection)}),a):(this.queryQueue.push(n),this._pulseQueryQueue(),a):(process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),a)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};i(pr,"Client");var Me=pr;Me.Query=Zs;Xs.exports=Me});var nn=_((Up,sn)=>{"use strict";var Wo=require("events").EventEmitter,tn=i(function(){},"NOOP"),rn=i((t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},"removeWhere"),dr=class dr{constructor(e,r,s){this.client=e,this.idleListener=r,this.timeoutId=s}};i(dr,"IdleItem");var hr=dr,fr=class fr{constructor(e){this.callback=e}};i(fr,"PendingItem");var Z=fr;function Vo(){throw new Error("Release called on client which has already been released to the pool.")}i(Vo,"throwOnDoubleRelease");function qe(t,e){if(e)return{callback:e,result:void 0};let r,s,n=i(function(o,c){o?r(o):s(c)},"cb"),a=new t(function(o,c){s=o,r=c}).catch(o=>{throw Error.captureStackTrace(o),o});return{callback:n,result:a}}i(qe,"promisify");function $o(t,e){return i(function r(s){s.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",s)}),t._remove(e),t.emit("error",s,e)},"idleListener")}i($o,"makeIdleListener");var mr=class mr extends Wo{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||gr().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let s=r.client;s.ref&&s.ref();let n=r.idleListener;return this._acquireClient(s,e,n,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e){let r=rn(this._idle,s=>s.client===e);r!==void 0&&clearTimeout(r.timeoutId),this._clients=this._clients.filter(s=>s!==e),e.end(),this.emit("remove",e)}connect(e){if(this.ending){let n=new Error("Cannot use a pool after calling end on the pool");return e?e(n):this.Promise.reject(n)}let r=qe(this.Promise,e),s=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Z(r.callback)),s;let n=i((c,l,u)=>{clearTimeout(o),r.callback(c,l,u)},"queueCallback"),a=new Z(n),o=setTimeout(()=>{rn(this._pendingQueue,c=>c.callback===n),a.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(a),s}return this.newClient(new Z(r.callback)),s}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let s=$o(this,r);this.log("checking client timeout");let n,a=!1;this.options.connectionTimeoutMillis&&(n=setTimeout(()=>{this.log("ending client due to timeout"),a=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(o=>{if(n&&clearTimeout(n),r.on("error",s),o)this.log("client failed to connect",o),this._clients=this._clients.filter(c=>c!==r),a&&(o.message="Connection terminated due to connection timeout"),this._pulseQueue(),e.timedOut||e.callback(o,void 0,tn);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let c=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(u=>u.client===r)!==-1&&this._acquireClient(r,new Z((u,p,h)=>h()),s,!1)},this.options.maxLifetimeSeconds*1e3);c.unref(),r.once("end",()=>clearTimeout(c))}return this._acquireClient(r,e,s,!0)}})}_acquireClient(e,r,s,n){n&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,s),e.removeListener("error",s),r.timedOut?n&&this.options.verify?this.options.verify(e,e.release):e.release():n&&this.options.verify?this.options.verify(e,a=>{if(a)return e.release(a),r.callback(a,void 0,tn);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let s=!1;return n=>{s&&Vo(),s=!0,this._release(e,r,n)}}_release(e,r,s){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",s,e),s||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses){e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e),this._pulseQueue();return}if(this._expired.has(e)){this.log("remove expired client"),this._expired.delete(e),this._remove(e),this._pulseQueue();return}let a;this.options.idleTimeoutMillis&&(a=setTimeout(()=>{this.log("remove idle client"),this._remove(e)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&a.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new hr(e,r,a)),this._pulseQueue()}query(e,r,s){if(typeof e=="function"){let a=qe(this.Promise,e);return setImmediate(function(){return a.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),a.result}typeof r=="function"&&(s=r,r=void 0);let n=qe(this.Promise,s);return s=n.callback,this.connect((a,o)=>{if(a)return s(a);let c=!1,l=i(u=>{c||(c=!0,o.release(u),s(u))},"onError");o.once("error",l),this.log("dispatching query");try{o.query(e,r,(u,p)=>{if(this.log("query dispatched"),o.removeListener("error",l),!c)return c=!0,o.release(u),u?s(u):s(void 0,p)})}catch(u){return o.release(u),s(u)}}),n.result}end(e){if(this.log("ending"),this.ending){let s=new Error("Called end on pool more than once");return e?e(s):this.Promise.reject(s)}this.ending=!0;let r=qe(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};i(mr,"Pool");var _r=mr;sn.exports=_r});var cn=_((Qp,on)=>{"use strict";var an=require("events").EventEmitter,zo=require("util"),yr=he(),X=on.exports=function(t,e,r){an.call(this),t=yr.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(s){s==="row"&&(this._emitRowEvents=!0)}.bind(this))};zo.inherits(X,an);var Ko={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};X.prototype.handleError=function(t){var e=this.native.pq.resultErrorFields();if(e)for(var r in e){var s=Ko[r]||r;t[s]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};X.prototype.then=function(t,e){return this._getPromise().then(t,e)};X.prototype.catch=function(t){return this._getPromise().catch(t)};X.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};X.prototype.submit=function(t){this.state="running";var e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;var r=i(function(a,o,c){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),a)return e.handleError(a);e._emitRowEvents&&(c.length>1?o.forEach((l,u)=>{l.forEach(p=>{e.emit("row",p,c[u])})}):o.forEach(function(l){e.emit("row",l,c)})),e.state="end",e.emit("end",c),e.callback&&e.callback(null,c)},"after");if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var s=(this.values||[]).map(yr.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let a=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(a)}return t.native.execute(this.name,s,r)}return t.native.prepare(this.name,this.text,s.length,function(a){return a?r(a):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,s,r))})}else if(this.values){if(!Array.isArray(this.values)){let a=new Error("Query values must be an array");return r(a)}var n=this.values.map(yr.prepareValue);t.native.query(this.text,n,r)}else t.native.query(this.text,r)}});var _n=_((jp,hn)=>{"use strict";var un;try{un=require("pg-native")}catch(t){throw t}var Yo=ut(),ln=require("events").EventEmitter,Jo=require("util"),Zo=_t(),pn=cn(),I=hn.exports=function(t){ln.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new Yo(t.types),this.native=new un({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var e=this.connectionParameters=new Zo(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};I.Query=pn;Jo.inherits(I,ln);I.prototype._errorAllQueries=function(t){let e=i(r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})},"enqueueError");this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};I.prototype._connect=function(t){var e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,s){if(e.connectionParameters.nativeConnectionString&&(s=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(s,function(n){if(n)return e.native.end(),t(n);e._connected=!0,e.native.on("error",function(a){e._queryable=!1,e._errorAllQueries(a),e.emit("error",a)}),e.native.on("notification",function(a){e.emit("notification",{channel:a.relname,payload:a.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};I.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(s=>{s?r(s):e()})})};I.prototype.query=function(t,e,r){var s,n,a,o,c;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")a=t.query_timeout||this.connectionParameters.query_timeout,n=s=t,typeof e=="function"&&(t.callback=e);else if(a=this.connectionParameters.query_timeout,s=new pn(t,e,r),!s.callback){let l,u;n=new this._Promise((p,h)=>{l=p,u=h}).catch(p=>{throw Error.captureStackTrace(p),p}),s.callback=(p,h)=>p?u(p):l(h)}return a&&(c=s.callback,o=setTimeout(()=>{var l=new Error("Query read timeout");process.nextTick(()=>{s.handleError(l,this.connection)}),c(l),s.callback=()=>{};var u=this._queryQueue.indexOf(s);u>-1&&this._queryQueue.splice(u,1),this._pulseQueryQueue()},a),s.callback=(l,u)=>{clearTimeout(o),c(l,u)}),this._queryable?this._ending?(s.native=this.native,process.nextTick(()=>{s.handleError(new Error("Client was closed and is not queryable"))}),n):(this._queryQueue.push(s),this._pulseQueryQueue(),n):(s.native=this.native,process.nextTick(()=>{s.handleError(new Error("Client has encountered a connection error and is not queryable"))}),n)};I.prototype.end=function(t){var e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));var r;return t||(r=new this._Promise(function(s,n){t=i(a=>a?n(a):s(),"cb")})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};I.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};I.prototype._pulseQueryQueue=function(t){if(this._connected&&!this._hasActiveQuery()){var e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);var r=this;e.once("_done",function(){r._pulseQueryQueue()})}};I.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};I.prototype.ref=function(){};I.prototype.unref=function(){};I.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};I.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Er=_((Vp,dn)=>{"use strict";dn.exports=_n()});var gr=_(($p,fe)=>{"use strict";var Xo=en(),ec=pe(),tc=ar(),rc=nn(),{DatabaseError:sc}=rr(),{escapeIdentifier:nc,escapeLiteral:ic}=he(),ac=i(t=>{var e;return e=class extends rc{constructor(s){super(s,t)}},i(e,"BoundPool"),e},"poolFactory"),Sr=i(function(t){this.defaults=ec,this.Client=t,this.Query=this.Client.Query,this.Pool=ac(this.Client),this._pools=[],this.Connection=tc,this.types=le(),this.DatabaseError=sc,this.escapeIdentifier=nc,this.escapeLiteral=ic},"PG");typeof process.env.NODE_PG_FORCE_NATIVE<"u"?fe.exports=new Sr(Er()):(fe.exports=new Sr(Xo),Object.defineProperty(fe.exports,"native",{configurable:!0,enumerable:!1,get(){var t=null;try{t=new Sr(Er())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(fe.exports,"native",{value:t}),t}}))});var mn=_((Kp,fn)=>{"use strict";var ee=require("fs"),oc=gr(),cc="The server does not support SSL connections",uc="28000",lc=i((t,e)=>{let r=t.sslType;if(!r||r==="disable"||r==="allow")return!1;if(["require","prefer"].includes(r)&&!t.certAuthority)return{rejectUnauthorized:!1};let s={checkServerIdentity(n,a){e.info("Certificate",{hostname:n,cert:{subject:a.subject,issuer:a.issuer,valid_from:a.valid_from,valid_to:a.valid_to}})}};return ee.existsSync(t.certAuthority)&&(s.ca=ee.readFileSync(t.certAuthority).toString()),ee.existsSync(t.clientCert)&&(s.cert=ee.readFileSync(t.clientCert).toString()),ee.existsSync(t.clientPrivateKey)&&(s.key=ee.readFileSync(t.clientPrivateKey).toString()),s},"getSslOptions"),pc=i(t=>({Off:"disable",TRUST_ALL_CERTIFICATES:"allow",TRUST_CUSTOM_CA_SIGNED_CERTIFICATES:"prefer",TRUST_SERVER_CLIENT_CERTIFICATES:"verify-full"})[t]||t,"mapSslType"),hc=i(async(t,e,r)=>{let s=!1;if(t.ssh){let{options:o}=await e.openTunnel({sshAuthMethod:t.ssh_method==="privateKey"?"IDENTITY_FILE":"USER_PASSWORD",sshTunnelHostname:t.ssh_host,sshTunnelPort:t.ssh_port,sshTunnelUsername:t.ssh_user,sshTunnelPassword:t.ssh_password,sshTunnelIdentityFile:t.ssh_key_file,sshTunnelPassphrase:t.ssh_key_passphrase,host:t.host,port:t.port});t={...t,...o},s=!0}t=Object.assign({},t,{sslType:pc(t.sslType)});let n={host:t.host,user:t.userName,password:t.userPassword,port:t.port,keepAlive:!0,ssl:lc(t,r),connectionTimeoutMillis:Number(t.queryRequestTimeout)||6e4,query_timeout:Number(t.queryRequestTimeout)||6e4,statement_timeout:Number(t.queryRequestTimeout)||6e4,database:t.database||t.maintenanceDatabase,application_name:"Hackolade",idleTimeoutMillis:Number(t.queryRequestTimeout)||1e4,sslType:t.sslType,max:4};return{client:await Tr(n,r),isSshTunnel:s}},"createClient"),_c=i((t,e,r)=>{var s;if(r.message===cc&&t.sslType==="prefer")return e.info("Retry connection without SSL (SSL mode 'prefer')"),e.error(r),Tr({...t,isRetry:!0,ssl:!1},e);if(((s=r.code)==null?void 0:s.toString())===uc&&t.sslType==="allow")return e.info("Retry connection with SSL (SSL mode 'allow')"),e.error(r),Tr({...t,isRetry:!0,ssl:{rejectUnauthorized:!1}},e);throw r},"retryOnSslError"),Tr=i((t,e)=>{let r=new oc.Pool(t);return r.connect().then(s=>(s.release(),r)).catch(async s=>{if(await r.end(),t.isRetry)throw s;return _c(t,e,s)})},"createConnectionPool");fn.exports={createClient:hc}});var Ar=_((Jp,Sn)=>{"use strict";var gn=i(t=>`
        SELECT indexname,
               index_method,
               index_unique,
               number_of_keys,
               where_expression,
               array_agg(attname
                         ORDER BY ord)::text[] AS columns,
               array_agg(coll
                         ORDER BY ord) AS collations,
               array_agg(opclass
                         ORDER BY ord) AS opclasses,
               array_agg(expression
                         ORDER BY ord) AS expressions,
               array_agg(ascending
                         ORDER BY ord) AS ascendings,
               array_agg(nulls_first
                         ORDER BY ord) AS nulls_first,
                reloptions AS storage_parameters,
                tablespace_name
        FROM
            (SELECT ct.oid AS table_oid,
                    c.relname AS indexname,
                    m.amname AS index_method,
                    indexes.indisunique AS index_unique,
                    indexes.ord,
                    attribute.attname,
                     c.reloptions,
                     tablespace_t.spcname AS tablespace_name,
                    indexes.${t===11?"indnatts":"indnkeyatts"} AS number_of_keys,
                    pg_catalog.pg_get_expr(indpred, indrelid) AS where_expression,
                    CASE
                        WHEN collation_namespace.nspname is not null THEN format('%I.%I',collation_namespace.nspname,collation_t.collname)
                    END AS coll,
                    CASE
                        WHEN opclass_t.opcname is not null THEN format('%I.%I',opclas_namespace.nspname,opclass_t.opcname)
                    END AS opclass,
                    CASE
                        WHEN indexes.ord > 0 THEN pg_catalog.pg_index_column_has_property(indexes.indexrelid, indexes.ord, 'asc')
                    END AS ascending,
                    CASE
                        WHEN indexes.ord > 0 THEN pg_catalog.pg_index_column_has_property(indexes.indexrelid, indexes.ord, 'nulls_first')
                    END AS nulls_first,
                    pg_catalog.pg_get_indexdef(indexes.indexrelid, ord, false) AS expression
             FROM
                 (SELECT *,
                         generate_series(1,array_length(i.indkey,1)) AS ord,
                         unnest(i.indkey) AS key,
                         unnest(i.indcollation) AS coll,
                         unnest(i.indclass) AS class,
                         unnest(i.indoption) AS option
                  FROM pg_catalog.pg_index i) indexes
             JOIN pg_catalog.pg_class c ON (c.oid=indexes.indexrelid)
             JOIN pg_catalog.pg_class ct ON (ct.oid=indexes.indrelid)
             JOIN pg_catalog.pg_am m ON (m.oid=c.relam)
             LEFT JOIN pg_catalog.pg_attribute attribute ON (attribute.attrelid=indexes.indrelid
                                                  AND attribute.attnum=indexes.key)
             LEFT JOIN pg_catalog.pg_collation collation_t ON (collation_t.oid=indexes.coll)
             LEFT JOIN pg_catalog.pg_namespace collation_namespace ON (collation_namespace.oid=collation_t.collnamespace)
             LEFT JOIN pg_catalog.pg_opclass opclass_t ON (opclass_t.oid=indexes.class)
             LEFT JOIN pg_catalog.pg_namespace opclas_namespace ON (opclas_namespace.oid=opclass_t.opcnamespace)
             LEFT JOIN pg_catalog.pg_tablespace tablespace_t ON (tablespace_t.oid = c.reltablespace)) s2
        WHERE table_oid = $1
        GROUP BY indexname,
                 index_method,
                 index_unique,
                 reloptions,
                 number_of_keys,
                 where_expression,
                 tablespace_name;
        `,"getGET_TABLE_INDEXES"),yn=i(t=>`
        SELECT obj_description(oid, 'pg_proc') AS description,
            proname AS function_name,
            provolatile AS volatility,
            proparallel AS parallel,
            proisstrict AS strict,
            proretset AS returns_set,
            proleakproof AS leak_proof,
            procost AS estimated_cost,
            prorows AS estimated_rows,
            prosrc AS body,
            ${t===10?"CASE WHEN proiswindow is true THEN 'w' ELSE '' END AS kind":"prokind AS kind"}
        FROM pg_catalog.pg_proc WHERE pronamespace = $1;`,"getGET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL"),En={PING:"SELECT schema_name FROM information_schema.schemata LIMIT 1;",GET_VERSION:"SELECT version()",GET_VERSION_AS_NUM:"SHOW server_version_num;",GET_SCHEMA_NAMES:"SELECT schema_name FROM information_schema.schemata;",GET_TABLE_NAMES:`
        SELECT tables.table_name, tables.table_type FROM information_schema.tables AS tables
        INNER JOIN 
        (SELECT
                pg_class.relname AS table_name,
                 pg_namespace.nspname AS table_schema
        FROM pg_catalog.pg_class AS pg_class
        INNER JOIN pg_catalog.pg_namespace AS pg_namespace 
                ON (pg_namespace.oid = pg_class.relnamespace)
        WHERE pg_class.relispartition = false
                AND pg_class.relkind = ANY('{"r","v","t","m","p"}'))
        AS catalog_table_data
        ON (catalog_table_data.table_name = tables.table_name AND catalog_table_data.table_schema = tables.table_schema)
	LEFT JOIN (SELECT relname AS child_name FROM pg_catalog.pg_inherits AS inherit
		LEFT JOIN pg_catalog.pg_class AS child ON (child.oid = inherit.inhrelid)) AS inherited_tables
	ON (inherited_tables.child_name = tables.table_name)
	WHERE inherited_tables.child_name IS NULL
        AND tables.table_schema = $1;`,GET_NAMESPACE_OID:"SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = $1",GET_TABLE_LEVEL_DATA:`
        SELECT pc.oid, pc.relpersistence, pc.reloptions, pt.spcname, pg_get_expr(pc.relpartbound, pc.oid) AS partition_expr
            FROM pg_catalog.pg_class AS pc 
            LEFT JOIN pg_catalog.pg_tablespace AS pt 
            ON pc.reltablespace = pt.oid
            WHERE pc.relname = $1 AND pc.relnamespace = $2;`,GET_TABLE_TOAST_OPTIONS:`
        SELECT reloptions AS toast_options
        FROM pg_catalog.pg_class
        WHERE oid =
                (SELECT reltoastrelid
                 FROM pg_catalog.pg_class
                 WHERE relname=$1 AND relnamespace = $2
                 LIMIT 1)`,GET_TABLE_PARTITION_DATA:`
        SELECT partstrat as partition_method,
	            partattrs::int2[] as partition_attributes_positions,
	            pg_catalog.pg_get_expr(partexprs, partrelid) AS expressions
            FROM pg_catalog.pg_partitioned_table
            WHERE partrelid = $1;`,GET_TABLE_COLUMNS:`
        SELECT * FROM information_schema.columns
            WHERE table_name = $1 AND table_schema = $2
            ORDER BY ordinal_position`,GET_TABLE_COLUMNS_ADDITIONAL_DATA:`
        SELECT pg_attribute.attname AS name,
            pg_attribute.attndims AS number_of_array_dimensions,
            pg_description.description,
            pg_attribute.atttypmod AS attribute_mode
        FROM pg_catalog.pg_attribute AS pg_attribute
        LEFT JOIN pg_catalog.pg_description AS pg_description ON (pg_description.objsubid=pg_attribute.attnum
                                                               AND pg_description.objoid = pg_attribute.attrelid)
        WHERE pg_attribute.attrelid = $1;`,GET_DESCRIPTION_BY_OID:"SELECT obj_description($1)",GET_ROWS_COUNT:t=>`SELECT COUNT(*) AS quantity FROM ${t};`,GET_SAMPLED_DATA:(t,e)=>`SELECT ${e} FROM ${t} LIMIT $1;`,GET_INHERITS_PARENT_TABLE_NAME:`
        SELECT pc.relname AS parent_table_name FROM pg_catalog.pg_inherits AS pi
	        INNER JOIN pg_catalog.pg_class AS pc
	        ON pc.oid = pi.inhparent
	        WHERE pi.inhrelid = $1;`,GET_TABLE_CONSTRAINTS:`
        SELECT pcon.conname AS constraint_name, 
	            pcon.contype AS constraint_type,
	            pcon.connoinherit AS no_inherit,
	            pcon.conkey AS constraint_keys,
	            pg_catalog.pg_get_expr(pcon.conbin, pcon.conrelid) AS expression,
	            obj_description(pcon.oid, 'pg_constraint') AS description,
	            pc.reloptions AS storage_parameters,
	            pt.spcname AS tablespace
	        FROM pg_catalog.pg_constraint AS pcon
	        LEFT JOIN pg_catalog.pg_class AS pc
	        ON pcon.conindid = pc.oid
	        LEFT JOIN pg_catalog.pg_tablespace AS pt
	        ON pc.reltablespace = pt.oid
	        WHERE pcon.conrelid = $1;`,GET_TABLE_INDEXES:gn(),GET_TABLE_INDEXES_V_10:gn(10),GET_TABLE_FOREIGN_KEYS:`
        SELECT pcon.conname AS relationship_name, 
                pcon.conkey AS table_columns_positions,
                pcon.confdeltype AS relationship_on_delete,
                pcon.confupdtype AS relationship_on_update,
                pcon.confmatchtype AS relationship_match,
                pc_foreign_table.relname AS foreign_table_name, 
                ARRAY(
                    SELECT column_name::text FROM unnest(pcon.confkey) AS column_position 
                    JOIN information_schema.columns ON (ordinal_position = column_position)
                    WHERE table_name = pc_foreign_table.relname AND table_schema = foreign_table_namespace.nspname)::text[] AS foreign_columns,
                foreign_table_namespace.nspname AS foreign_table_schema
            FROM pg_catalog.pg_constraint AS pcon
            LEFT JOIN pg_catalog.pg_class AS pc ON pcon.conindid = pc.oid
            LEFT JOIN pg_catalog.pg_tablespace AS pt ON pc.reltablespace = pt.oid
            LEFT JOIN pg_catalog.pg_class AS pc_foreign_table ON (pcon.confrelid = pc_foreign_table.oid)
            JOIN pg_catalog.pg_namespace AS foreign_table_namespace ON (pc_foreign_table.relnamespace = foreign_table_namespace.oid)
            WHERE pcon.conrelid = $1 AND pcon.contype = 'f';`,GET_VIEW_DATA:"SELECT * FROM information_schema.views WHERE table_name = $1 AND table_schema = $2;",GET_VIEW_SELECT_STMT_FALLBACK:"SELECT definition FROM pg_views WHERE viewname = $1 AND schemaname = $2;",GET_VIEW_OPTIONS:`
        SELECT oid, 
            reloptions AS view_options,
            relpersistence AS persistence,
            obj_description(oid, 'pg_class') AS description
        FROM pg_catalog.pg_class 
        WHERE relname = $1 AND relnamespace = $2;`,GET_FUNCTIONS_WITH_PROCEDURES:`
        SELECT specific_name,
            routine_name AS name,
            routine_type,
            routine_definition,
            external_language,
            security_type,
            type_udt_name AS return_data_type
	    FROM information_schema.routines
	    WHERE specific_schema=$1;`,GET_FUNCTIONS_WITH_PROCEDURES_ARGS:`
        SELECT parameter_name,
            parameter_mode,
            parameter_default,
            data_type,
            udt_name
        FROM information_schema.parameters
        WHERE specific_name = $1
        ORDER BY ordinal_position;`,GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL:yn(),GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL_V_10:yn(10),GET_USER_DEFINED_TYPES:`
        SELECT pg_type.typrelid AS pg_class_oid,
            pg_type.typname AS name,
            pg_type.typtype AS type,
            pg_catalog.array_agg(pg_enum.enumlabel)::text[] AS enum_values,
            range_subtype_type.typname AS range_subtype,
            range_collation.collname AS range_collation_name,
            range_opclass.opcname AS range_opclass_name,
            range_canonical_proc.proname AS range_canonical_proc,
            range_diff_proc.proname AS range_diff_proc
        FROM pg_catalog.pg_type AS pg_type
        LEFT JOIN pg_catalog.pg_class AS pg_class ON (pg_class.oid = pg_type.typrelid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace ON (pg_namespace.oid = pg_type.typnamespace)
        LEFT JOIN pg_catalog.pg_enum AS pg_enum ON (pg_enum.enumtypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_range AS pg_range ON (pg_range.rngtypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_type AS range_subtype_type ON (range_subtype_type.oid = pg_range.rngsubtype)
        LEFT JOIN pg_catalog.pg_collation AS range_collation ON (range_collation.oid = pg_range.rngcollation)
        LEFT JOIN pg_catalog.pg_opclass AS range_opclass ON (range_opclass.oid = pg_range.rngsubopc)
        LEFT JOIN pg_catalog.pg_proc AS range_canonical_proc ON (range_canonical_proc.oid = pg_range.rngcanonical)
        LEFT JOIN pg_catalog.pg_proc AS range_diff_proc ON (range_diff_proc.oid = pg_range.rngsubdiff)
        WHERE pg_namespace.nspname = $1
         AND ((pg_type.typtype = 'c'
               AND pg_class.relkind = 'c')
              OR pg_type.typtype = 'e'
              OR pg_type.typtype = 'r')
        GROUP BY pg_class_oid,
              pg_type.typname,
              pg_type.typtype,
              pg_class.oid,
              range_subtype,
              range_collation_name,
              range_opclass_name,
              range_canonical_proc,
              range_diff_proc;`,GET_COMPOSITE_TYPE_COLUMNS:`
        SELECT pg_attribute.attname AS column_name,
           pg_type.typname AS data_type,
           pg_get_expr(pg_attrdef.adbin, pg_attrdef.adrelid) AS columns_default,
           pg_attribute.attnotnull AS not_null,
           pg_collation.collname AS collation_name,
           pg_attribute.attndims AS number_of_array_dimensions,
           pg_attribute.atttypmod AS character_maximum_length
        FROM pg_catalog.pg_attribute AS pg_attribute
        LEFT JOIN pg_catalog.pg_type AS pg_type ON (pg_type.oid = pg_attribute.atttypid)
        LEFT JOIN pg_catalog.pg_attrdef AS pg_attrdef ON (pg_attrdef.adrelid = pg_attribute.attrelid
                                                          AND pg_attrdef.adnum = pg_attribute.attnum)
        LEFT JOIN pg_catalog.pg_collation AS pg_collation ON (pg_collation.oid = pg_attribute.attcollation)
        WHERE pg_attribute.attrelid = $1`,GET_DB_NAME:"SELECT current_database();",GET_DB_ENCODING:"SHOW SERVER_ENCODING;",GET_DB_COLLATE_NAME:"SELECT default_collate_name FROM information_schema.character_sets;",GET_DOMAIN_TYPES:"SELECT * FROM information_schema.domains WHERE domain_schema = $1",GET_DOMAIN_TYPES_CONSTRAINTS:`
        SELECT pg_type.typname AS type_name,
        	pg_type.typnotnull AS not_null,
        	pg_constraint.conname AS constraint_name,
        	pg_catalog.pg_get_expr(pg_constraint.conbin, pg_constraint.conrelid) AS expression
        FROM pg_catalog.pg_type AS pg_type
        LEFT JOIN pg_catalog.pg_constraint AS pg_constraint ON (pg_constraint.contypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace ON (pg_namespace.oid = pg_type.typnamespace)
        WHERE pg_type.typname = $1 AND pg_namespace.nspname = $2 AND pg_constraint.contype = 'c';`,GET_DATABASES:"SELECT datname AS database_name FROM pg_catalog.pg_database WHERE datistemplate != TRUE AND datallowconn = TRUE;",GET_TRIGGERS:`
        SELECT trigger_name,
                array_agg(event_manipulation::text) AS trigger_events,
                event_object_schema,
                event_object_table,
                action_orientation,
                action_timing,
                action_reference_old_table,
                action_reference_new_table,
                action_condition,
                action_statement
        FROM
            -- This is information_schema.triggers view but without permitions
            (SELECT (current_database())::information_schema.sql_identifier AS trigger_catalog,
                    (n.nspname)::information_schema.sql_identifier AS trigger_schema,
                    (t.tgname)::information_schema.sql_identifier AS trigger_name,
                    (em.text)::information_schema.character_data AS event_manipulation,
                    (current_database())::information_schema.sql_identifier AS event_object_catalog,
                    (n.nspname)::information_schema.sql_identifier AS event_object_schema,
                    (c.relname)::information_schema.sql_identifier AS event_object_table,
                    (rank() OVER (PARTITION BY (n.nspname)::information_schema.sql_identifier,
                                               (c.relname)::information_schema.sql_identifier,
                                               em.num, ((t.tgtype)::integer & 1), ((t.tgtype)::integer & 66)
                                  ORDER BY t.tgname))::information_schema.cardinal_number AS action_order,
                    (regexp_match(pg_get_triggerdef(t.oid), '.{35,} WHEN ((.+)) EXECUTE FUNCTION'::text))[1]::information_schema.character_data AS action_condition,
                    (SUBSTRING(pg_get_triggerdef(t.oid)
                               FROM (POSITION(('EXECUTE FUNCTION'::text) IN (SUBSTRING(pg_get_triggerdef(t.oid)
                                                                                       FROM 48))) + 47)))::information_schema.character_data AS action_statement,
                    (CASE ((t.tgtype)::integer & 1)
                         WHEN 1 THEN 'ROW'::text
                         ELSE 'STATEMENT'::text
                     END)::information_schema.character_data AS action_orientation,
                    (CASE ((t.tgtype)::integer & 66)
                         WHEN 2 THEN 'BEFORE'::text
                         WHEN 64 THEN 'INSTEAD OF'::text
                         ELSE 'AFTER'::text
                     END)::information_schema.character_data AS action_timing,
                    (t.tgoldtable)::information_schema.sql_identifier AS action_reference_old_table,
                    (t.tgnewtable)::information_schema.sql_identifier AS action_reference_new_table,
                    (NULL::timestamp with time zone)::information_schema.time_stamp AS created
                FROM pg_namespace n,
                        pg_class c,
                        pg_trigger t, (VALUES (4,'INSERT'::text), (8,'DELETE'::text), (16,'UPDATE'::text)) em(num, text)
                WHERE ((n.oid = c.relnamespace)
                        AND (c.oid = t.tgrelid)
                        AND (((t.tgtype)::integer & em.num) <> 0)
                        AND (NOT t.tgisinternal)
                        AND (NOT pg_is_other_temp_schema(n.oid)))) AS tmp_views
        WHERE event_object_schema = $1 AND event_object_table = $2
        GROUP BY
                trigger_schema,
                trigger_name,
                event_object_schema,
                event_object_table,
                action_orientation,
                action_timing,
                action_reference_old_table,
                action_reference_new_table,
                action_condition,
                action_statement;`,GET_TRIGGERS_ADDITIONAL_DATA:`
        SELECT
                pg_catalog.obj_description(pg_trigger.oid, 'pg_trigger') AS description,
        	pg_trigger.tgname AS trigger_name,
        	pg_proc.proname AS function_name,
        	CASE WHEN pg_trigger.tgconstraint != 0 THEN true ELSE false END AS "constraint",
        	array_agg(pg_attribute.attname)::text[] AS update_attributes,
        	tgdeferrable AS "deferrable",
        	tginitdeferred AS deferred,
                pg_class_referenced.relname AS referenced_table_name,
                pg_namespace_referenced.nspname AS referenced_table_schema
        FROM pg_catalog.pg_trigger as pg_trigger
        LEFT JOIN pg_catalog.pg_proc AS pg_proc 
        	ON (pg_trigger.tgfoid = pg_proc.oid)
        LEFT JOIN pg_catalog.pg_attribute AS pg_attribute
        	ON (pg_attribute.attnum = ANY(pg_trigger.tgattr::int2[]) AND pg_trigger.tgrelid = pg_attribute.attrelid)
        INNER JOIN pg_catalog.pg_class AS pg_class
        	ON (pg_class.oid = pg_trigger.tgrelid)
        INNER JOIN pg_catalog.pg_namespace AS pg_namespace
        	ON (pg_class.relnamespace = pg_namespace.oid)
        LEFT JOIN pg_catalog.pg_class AS pg_class_referenced
                ON(pg_class_referenced.oid = pg_trigger.tgconstrrelid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace_referenced
                ON(pg_namespace_referenced.oid = pg_class_referenced.relnamespace)
        WHERE pg_class.relnamespace = $1 AND pg_class.oid = $2
        GROUP BY 
        	trigger_name,
        	function_name,
        	"constraint",
        	"deferrable",
        	deferred,
                description,
                referenced_table_name,
                referenced_table_schema;`,GET_PARTITIONS:`
        SELECT
        	inher_child.relname AS child_name,
        	inher_parent.relname AS parent_name,
                CASE WHEN inher_parent.relkind = 'p' THEN TRUE ELSE FALSE END AS is_parent_partitioned
        FROM pg_inherits
        LEFT JOIN pg_class AS inher_child ON (inher_child.oid = pg_inherits.inhrelid)
        LEFT JOIN pg_class AS inher_parent ON (inher_parent.oid = pg_inherits.inhparent)
        WHERE inher_parent.relnamespace = $1;`},dc=i(t=>(Object.entries(En).find(([r,s])=>t===s)||[])[0]||"Custom query","getQueryName");Sn.exports={getQueryName:dc,...En}});var An=_((Xp,Tn)=>{"use strict";var fc=Ar(),j=null,De=null;Tn.exports={initializeClient(t,e){j=t,De=e,j.on("error",r=>e.error(r))},isClientInitialized(){return!!j},releaseClient(){return j?new Promise(t=>{j.end(()=>{j=null,t()})}):Promise.resolve()},async query(t,e,r=!1){let s=fc.getQueryName(t);De.info("Execute query",{queryName:s,params:e});let n=Date.now(),a=await j.query(t,e),o=Date.now()-n;De.info("Query executed",{queryName:s,params:e,duration:o,rowsCount:a.rowCount});let c=a.rows||[];return r?c[0]:c},async queryTolerant(t,e,r=!1){try{return await this.query(t,e,r)}catch(s){return s.query=t,s.params=e,De.error(s),null}}}});var wn=_((eh,vn)=>{"use strict";var bn=i(t=>{let e=t.reduce((s,n)=>n.properties?{...s,[n.name]:{...n,...bn(n.properties)}}:{...s,[n.name]:n},{}),r=Object.entries(e).filter(([s,n])=>n.required).map(([s])=>s);return{properties:e,required:r}},"getJsonSchema");vn.exports={getJsonSchema:bn}});var br=_((rh,Cn)=>{"use strict";var Q=null,mc=i(t=>{Q=t.require("lodash")},"setDependencies"),me={column_default:"default",is_nullable:{keyword:"required",values:{YES:!1,NO:!0}},not_null:"required",data_type:"type",numeric_precision:"precision",numeric_scale:"scale",datetime_precision:"timePrecision",attribute_mode:{keyword:"timePrecision",check:(t,e)=>e!==-1&&wc(t.data_type)},interval_type:"intervalOptions",collation_name:"collationRule",column_name:"name",number_of_array_dimensions:"numberOfArrayDimensions",udt_name:"udt_name",character_maximum_length:"length",description:"description",domain_name:"domain_name"},gc=i((t,e,r)=>{var s;return(s=me[e])!=null&&s.check?me[e].check(t,r)?r:"":Q.get(me,`${e}.values.${r}`,r)},"getColumnValue"),yc=i(t=>e=>Q.chain(e).toPairs().map(([r,s])=>{var n;return[((n=me[r])==null?void 0:n.keyword)||me[r],gc(e,r,s)]}).filter(([r,s])=>r&&!Q.isNil(s)).fromPairs().thru(Ec(t)).value(),"mapColumnData"),Ec=i(t=>e=>({...e,...Sc(t,e)}),"setColumnType"),Sc=i((t,e)=>e.type==="ARRAY"?Tc(t,e):e.type==="USER-DEFINED"?Fe(t,e.udt_name):e.domain_name?Fe(t,e.domain_name):Fe(t,e.type),"getType"),Tc=i((t,e)=>({...Fe(t,e.udt_name.slice(1)),array_type:Q.fill(Array(e.numberOfArrayDimensions),"")}),"getArrayType"),Fe=i((t,e)=>{switch(e){case"bigint":case"bigserial":case"smallint":case"integer":case"numeric":case"real":case"double precision":case"smallserial":case"serial":case"money":return{type:"numeric",mode:e};case"int8":return{type:"numeric",mode:"bigint"};case"int2":return{type:"numeric",mode:"smallint"};case"int4":return{type:"numeric",mode:"integer"};case"float4":return{type:"numeric",mode:"real"};case"float8":return{type:"numeric",mode:"double precision"};case"bit":case"char":case"text":case"tsvector":case"tsquery":return{type:"char",mode:e};case"bit varying":return{type:"char",mode:"varbit"};case"character":return{type:"char",mode:"char"};case"character varying":return{type:"char",mode:"varchar"};case"bpchar":return{type:"char",mode:"char"};case"point":case"line":case"lseg":case"box":case"path":case"polygon":case"circle":case"box2d":case"box3d":case"geometry":case"geometry_dump":case"geography":return{type:"geometry",mode:e};case"bytea":return{type:"binary",mode:e};case"inet":case"cidr":case"macaddr":case"macaddr8":return{type:"inet",mode:e};case"date":case"time":case"timestamp":case"interval":return{type:"datetime",mode:e};case"timestamptz":case"timestamp with time zone":return{type:"datetime",mode:"timestamp",timezone:"WITH TIME ZONE"};case"timestamp without time zone":return{type:"datetime",mode:"timestamp",timezone:"WITHOUT TIME ZONE"};case"timetz":case"time with time zone":return{type:"datetime",mode:"time",timezone:"WITH TIME ZONE"};case"time without time zone":return{type:"datetime",mode:"time",timezone:"WITHOUT TIME ZONE"};case"json":case"jsonb":return{type:"json",mode:e,subtype:"object"};case"int4range":case"int8range":case"numrange":case"daterange":case"tsrange":case"tstzrange":return{type:"range",mode:e};case"int4multirange":case"int8multirange":case"nummultirange":case"tsmultirange":case"tstzmultirange":case"datemultirange":return{type:"multirange",mode:e};case"uuid":case"xml":case"boolean":return{type:e};case"bool":return{type:"boolean"};case"oid":case"regclass":case"regcollation":case"regconfig":case"regdictionary":case"regnamespace":case"regoper":case"regoperator":case"regproc":case"regprocedure":case"regrole":case"regtype":return{type:"oid",mode:e};default:return Q.some(t,{name:e})?{$ref:`#/definitions/${e}`}:{type:"char",mode:"varchar"}}},"mapType"),Ac=i((t,e)=>{let r=Q.first(e)||{};return t.map(s=>{if(s.type!=="json")return s;let n=r[s.name],a=bc(n),o=vc(a);return{...s,subtype:o}})},"setSubtypeFromSampledJsonValues"),bc=i(t=>{try{return JSON.parse(t)}catch{return{}}},"safeParse"),vc=i(t=>{if(Array.isArray(t))return"array";let e=typeof t;return e==="undefined"?"object":e},"getParsedJsonValueType"),wc=i(t=>Q.includes(["timestamp with time zone","timestamp without time zone","time with time zone","time without time zone"],t),"canHaveTimePrecision");Cn.exports={setDependencies:mc,mapColumnData:yc,setSubtypeFromSampledJsonValues:Ac}});var ge=_((nh,Rn)=>{"use strict";var Cc=["ALL","ANALYSE","ANALYZE","AND","ANY","ARRAY","ASC","ASYMMETRIC","AUTHORIZATION","BINARY","BOTH","CASE","CAST","CHECK","COLLATE","COLUMN","CONCURRENTLY","CONSTRAINT","CREATE","CROSS","CURRENT_CATALOG","CURRENT_DATE","CURRENT_ROLE","CURRENT_SCHEMA","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_USER","DEFAULT","DEFERRABLE","DESC","DISTINCT","DO","ELSE","END","EXCEPT","FALSE","FOR","FOREIGN","FREEZE","FROM","FULL","GRANT","GROUP","HAVING","ILIKE","IN","INITIALLY","INTERSECT","INTO","IS","ISNULL","JOIN","LATERAL","LEADING","LEFT","LIKE","LIMIT","LOCALTIME","LOCALTIMESTAMP","NATURAL","NOT","NULL","OFFSET","ON","ONLY","OR","ORDER","OUTER","OVERLAPS","PLACING","PRIMARY","REFERENCES","RETURNING","RIGHT","SELECT","SESSION_USER","SIMILAR","SOME","SYMMETRIC","TABLE","TABLESAMPLE","THEN","TO","TRAILING","TRUE","UNION","UNIQUE","USER","USING","VARIADIC","VERBOSE","WHEN","WHERE","WINDOW","WITH"],te=null,Rc=i(t=>{te=t.require("lodash")},"setDependencies"),Nc=i(t=>te.chain(t).toPairs().reject(([e,r])=>te.isNil(r)).fromPairs().value(),"clearEmptyPropertiesInObject"),Oc=i(t=>e=>{var r;return(r=te.find(t,{ordinal_position:e}))==null?void 0:r.column_name},"getColumnNameByPosition"),Ic=i(t=>/\s|\W/.test(t)||te.includes(Cc,te.toUpper(t))?`"${t}"`:t,"wrapInQuotes");Rn.exports={clearEmptyPropertiesInObject:Nc,setDependencies:Rc,getColumnNameByPosition:Oc,wrapInQuotes:Ic}});var In=_((ah,On)=>{"use strict";var{getColumnNameByPosition:xc}=ge(),vr=null,Lc=i(t=>{vr=t.require("lodash")},"setDependencies"),Nn=i(t=>{switch(t){case"a":return"NO ACTION";case"r":return"RESTRICT";case"c":return"CASCADE";case"n":return"SET NULL";case"d":return"SET DEFAULT";default:return""}},"prepareDeleteAndUpdate"),Pc=i(t=>{switch(t){case"f":return"FULL";case"s":return"SIMPLE";case"p":return"PARTIAL";default:return""}},"prepareMatch"),Mc=i((t,e,r,s)=>vr.map(t,n=>({relationshipName:n.relationship_name,dbName:n.foreign_table_schema,parentCollection:n.foreign_table_name,parentField:n.foreign_columns,childDbName:r,childCollection:e,childField:vr.map(n.table_columns_positions,xc(s)),relationshipType:"Foreign Key",relationshipInfo:{relationshipOnDelete:Nn(n.relationship_on_delete),relationshipOnUpdate:Nn(n.relationship_on_update),relationshipMatch:Pc(n.relationship_match)}})),"prepareForeignKeys");On.exports={setDependencies:Lc,prepareForeignKeys:Mc}});var Pn=_((ch,Ln)=>{"use strict";var ke=null,qc=i(t=>{ke=t.require("lodash")},"setDependencies"),xn=i(t=>ke.map(t,e=>({argumentMode:e.parameter_mode,argumentName:e.parameter_name,argumentType:Dc(e.data_type,e.udt_name),defaultExpression:e.parameter_default})),"mapFunctionArgs"),Dc=i((t,e)=>t==="USER-DEFINED"?e:t==="ARRAY"?e.slice(1)+"[]":t,"getArgType"),Fc=i(t=>{switch(t){case"i":return"IMMUTABLE";case"s":return"STABLE";case"v":default:return"VOLATILE"}},"getVolatility"),kc=i(t=>{switch(t){case"s":return"SAFE";case"r":return"RESTICTED";case"u":return"UNSAFE";default:return""}},"getParallel"),Bc=i(t=>t?"STRICT":"CALLED ON NULL INPUT","getNullArgs"),Uc=i((t,e,r)=>({name:t.name,functionDescription:r==null?void 0:r.description,functionArguments:xn(e),functionReturnsSetOf:r==null?void 0:r.returns_set,functionReturnType:t.return_data_type,functionLanguage:ke.toLower(t.external_language),functionBody:t.routine_definition??(r==null?void 0:r.body),functionWindow:(r==null?void 0:r.kind)==="w",functionVolatility:Fc(r==null?void 0:r.volatility),functionLeakProof:r==null?void 0:r.leak_proof,functionNullArgs:Bc(r==null?void 0:r.strict),functionSqlSecurity:t.security_type,functionParallel:kc(t.parallel),functionExecutionCost:t.estimated_cost,functionExecutionRows:t.estimated_rows}),"mapFunctionData"),Gc=i((t,e,r)=>({name:t.name,description:r==null?void 0:r.description,language:ke.toLower(t.external_language),inputArgs:xn(e),body:t.routine_definition}),"mapProcedureData");Ln.exports={setDependencies:qc,mapFunctionData:Uc,mapProcedureData:Gc}});var kn=_((lh,Fn)=>{"use strict";var{clearEmptyPropertiesInObject:ye,getColumnNameByPosition:Be}=ge(),y=null,Qc=i(t=>{y=t.require("lodash")},"setDependencies"),qn=i((t,e)=>{if(!t&&!e)return null;let r=Mn(t),s=Mn(e==null?void 0:e.toast_options),n=r.fillfactor,a=r.parallel_workers,o=r.autovacuum_enabled,c=ye({vacuum_index_cleanup:r.vacuum_index_cleanup,vacuum_truncate:r.vacuum_truncate,autovacuum_vacuum_threshold:r.autovacuum_vacuum_threshold,autovacuum_vacuum_scale_factor:r.autovacuum_vacuum_scale_factor,autovacuum_vacuum_insert_threshold:r.autovacuum_vacuum_insert_threshold,autovacuum_vacuum_insert_scale_factor:r.autovacuum_vacuum_insert_scale_factor,autovacuum_analyze_threshold:r.autovacuum_analyze_threshold,autovacuum_analyze_scale_factor:r.autovacuum_analyze_scale_factor,autovacuum_vacuum_cost_delay:r.autovacuum_vacuum_cost_delay,autovacuum_vacuum_cost_limit:r.autovacuum_vacuum_cost_limit,autovacuum_freeze_min_age:r.autovacuum_freeze_min_age,autovacuum_freeze_max_age:r.autovacuum_freeze_max_age,autovacuum_freeze_table_age:r.autovacuum_freeze_table_age,autovacuum_multixact_freeze_min_age:r.autovacuum_multixact_freeze_min_age,autovacuum_multixact_freeze_max_age:r.autovacuum_multixact_freeze_max_age,autovacuum_multixact_freeze_table_age:r.autovacuum_multixact_freeze_table_age,log_autovacuum_min_duration:r.log_autovacuum_min_duration}),l=r.user_catalog_table,u=s.autovacuum_enabled,p=ye({toast_tuple_target:r.toast_tuple_target,toast_vacuum_index_cleanup:s.vacuum_index_cleanup,toast_vacuum_truncate:s.vacuum_truncate,toast_autovacuum_vacuum_threshold:s.autovacuum_vacuum_threshold,toast_autovacuum_vacuum_scale_factor:s.autovacuum_vacuum_scale_factor,toast_autovacuum_vacuum_insert_threshold:s.autovacuum_vacuum_insert_threshold,toast_autovacuum_vacuum_insert_scale_factor:s.autovacuum_vacuum_insert_scale_factor,toast_autovacuum_vacuum_cost_delay:s.autovacuum_vacuum_cost_delay,toast_autovacuum_vacuum_cost_limit:s.autovacuum_vacuum_cost_limit,toast_autovacuum_freeze_min_age:s.autovacuum_freeze_min_age,toast_autovacuum_freeze_max_age:s.autovacuum_freeze_max_age,toast_autovacuum_freeze_table_age:s.autovacuum_freeze_table_age,toast_autovacuum_multixact_freeze_min_age:s.autovacuum_multixact_freeze_min_age,toast_autovacuum_multixact_freeze_max_age:s.autovacuum_multixact_freeze_max_age,toast_autovacuum_multixact_freeze_table_age:s.autovacuum_multixact_freeze_table_age,toast_log_autovacuum_min_duration:s.log_autovacuum_min_duration}),h={fillfactor:n,parallel_workers:a,autovacuum_enabled:o,autovacuum:y.isEmpty(c)?null:c,toast_autovacuum_enabled:u,toast:y.isEmpty(p)?null:p,user_catalog_table:l};return ye(h)},"prepareStorageParameters"),Hc=i((t,e)=>{if(!t)return null;let r=jc(t),s=y.some(t.partition_attributes_positions,o=>o===0),n=s?"partitioning_expression":"compositePartitionKey",a=s?Wc(t,e):y.map(t.partition_attributes_positions,Be(e));return[{partitionMethod:r,partitionBy:s?"expression":"keys",[n]:a}]},"prepareTablePartition"),jc=i(t=>{switch(t.partition_method){case"h":return"HASH";case"l":return"LIST";case"r":return"RANGE";default:return""}},"getPartitionMethod"),Wc=i((t,e)=>{let r=0,s=y.split(t.expressions,",");return y.chain(t.partition_attributes_positions).map(n=>{if(n===0){let a=s[r];return r++,a}return Be(e)(n)}).join(",").value()},"getPartitionExpression"),Dn=i(t=>y.split(t,"="),"splitByEqualitySymbol"),Vc=i(t=>y.find(t,{type:"json"}),"checkHaveJsonTypes"),$c=i((t,e)=>{if(e.active==="absolute")return Number(e.absolute.value);let r=Math.ceil(t*e.relative.value/100);return Math.min(r,e.maxValue)},"getSampleDocSize"),zc=i((t,e)=>y.reduce(t,(r,s)=>{switch(s.constraint_type){case"c":return{...r,chkConstr:[...r.chkConstr,Jc(s)]};case"p":return{...r,primaryKey:[...r.primaryKey,Kc(s,e)]};case"u":return{...r,uniqueKey:[...r.uniqueKey,Yc(s,e)]};default:return r}},{chkConstr:[],uniqueKey:[],primaryKey:[]}),"prepareTableConstraints"),Kc=i((t,e)=>({constraintName:t.constraint_name,compositePrimaryKey:y.map(t.constraint_keys,Be(e)),indexStorageParameters:y.join(t.storage_parameters,","),indexTablespace:t.tablespace}),"getPrimaryKeyConstraint"),Yc=i((t,e)=>({constraintName:t.constraint_name,compositeUniqueKey:y.map(t.constraint_keys,Be(e)),indexStorageParameters:y.join(t.storage_parameters,","),indexTablespace:t.tablespace,indexComment:t.description}),"getUniqueKeyConstraint"),Jc=i(t=>({chkConstrName:t.constraint_name,constrExpression:t.expression,noInherit:t.no_inherit,constrDescription:t.description}),"getCheckConstraint"),Zc=i(t=>y.map(t,e=>{let r=Xc(e),s=y.slice(r,0,e.number_of_keys),n=y.chain(r).slice(e.number_of_keys).map(o=>y.pick(o,"name")).value(),a={indxName:e.indexname,index_method:e.index_method,unique:e.index_unique??!1,index_tablespace_name:e.tablespace_name||"",index_storage_parameter:tu(e.storage_parameters),where:e.where_expression||"",include:n,columns:e.index_method==="btree"?s:y.map(s,o=>y.omit(o,"sortOrder","nullsOrder"))};return ye(a)}),"prepareTableIndexes"),Xc=i(t=>y.chain(t.columns).map((e,r)=>{if(!e)return;let s=y.get(t,`ascendings.${r}`,!1)?"ASC":"DESC",n=eu(y.get(t,`nulls_first.${r}`)),a=y.get(t,`opclasses.${r}`,""),o=y.get(t,`collations.${r}`,"");return{name:e,sortOrder:s,nullsOrder:n,opclass:a,collation:o}}).compact().value(),"mapIndexColumns"),eu=i(t=>y.isNil(t)?"":t?"NULLS FIRST":"NULLS LAST","getNullsOrder"),tu=i(t=>{if(!t)return null;let e=y.fromPairs(y.map(t,s=>Dn(s))),r={index_fillfactor:e.fillfactor,deduplicate_items:e.deduplicate_items,index_buffering:e.index_buffering,fastupdate:e.fastupdate,gin_pending_list_limit:e.gin_pending_list_limit,pages_per_range:e.pages_per_range,autosummarize:e.autosummarize};return ye(r)},"getIndexStorageParameters"),ru=i((t,e)=>{let r=(t==null?void 0:t.relpersistence)==="t",s=(t==null?void 0:t.relpersistence)==="u",n=qn(t==null?void 0:t.reloptions,e),a=t==null?void 0:t.spcname,o=t.partition_expr;return{temporary:r,unlogged:s,storage_parameter:n,table_tablespace_name:a,partitionBounds:o}},"prepareTableLevelData"),su=i(t=>{switch(nu(t)){case"number":case"boolean":return JSON.parse(t);case"string":default:return t}},"convertValueToType"),nu=i(t=>{try{let e=typeof JSON.parse(t);return e==="object"?"string":e}catch{return"string"}},"getTypeOfValue"),Mn=i(t=>y.chain(t).map(Dn).map(([e,r])=>[e,su(r)]).fromPairs().value()||{},"prepareOptions"),iu=i((t,e)=>y.map(e,({parent_table_name:r})=>({parentTable:[t,r]})),"prepareTableInheritance");Fn.exports={prepareStorageParameters:qn,prepareTablePartition:Hc,setDependencies:Qc,checkHaveJsonTypes:Vc,prepareTableConstraints:zc,prepareTableLevelData:ru,prepareTableIndexes:Zc,getSampleDocSize:$c,prepareTableInheritance:iu}});var Un=_((hh,Bn)=>{"use strict";var{mapColumnData:au}=br(),M=null,ou=i(t=>{M=t.require("lodash")},"setDependencies"),cu=i((t,e)=>M.chain(t).map(r=>{switch(r.type){case"e":return uu(r);case"r":return lu(r);case"c":return pu(r);default:return null}}).compact().concat(M.map(e,_u)).value(),"getUserDefinedTypes"),uu=i(t=>({name:t.name,type:"enum",enum:t.enum_values||[]}),"getEnumType"),lu=i(t=>({name:t.name,type:"range_udt",rangeSubtype:t.range_subtype||"",operatorClass:t.range_opclass_name||"",collation:t.range_collation_name||"",canonicalFunction:t.range_canonical_proc||"",subtypeDiffFunction:t.range_diff_proc||""}),"getRangeType"),pu=i(t=>{let e=M.map(t.columns,au([]));return{name:t.name,type:"composite",properties:e}},"getCompositeType"),hu=i(t=>t.type==="c","isTypeComposite"),_u=i(t=>{var e;return{name:t.domain_name,type:"domain",underlyingType:M.flow(fu(t),mu(t),gu(t),yu(t))(du(t)),collation:t.collation_name||"",default:t.domain_default||"",required:(e=M.first(t.constraints))==null?void 0:e.not_null,checkConstraints:M.map(t.constraints,Eu)}},"mapDomainType"),du=i(t=>t.data_type==="USER-DEFINED"?t.udt_name:t.data_type,"getUnderlyingType"),fu=i(t=>e=>t.character_maximum_length?`${e}(${t.character_maximum_length})`:e,"setLength"),mu=i(t=>e=>e!=="numeric"?e:M.isNumber(t.numeric_precision)&&M.isNumber(t.numeric_scale)?`${e}(${t.numeric_precision},${t.numeric_scale})`:M.isNumber(t.numeric_precision)?`${e}(${t.numeric_precision})`:e,"setPrecisionAndScale"),gu=i(t=>e=>t.interval_type?`${e} ${t.interval_type}`:e,"setIntervalType"),yu=i(t=>e=>M.isNumber(t.interval_precision)?`${e}(${t.interval_precision})`:e,"setIntervalPrecision"),Eu=i(t=>({name:t.constraint_name,expression:t.expression}),"mapDomainConstraint");Bn.exports={setDependencies:ou,getUserDefinedTypes:cu,isTypeComposite:hu}});var Qn=_((dh,Gn)=>{"use strict";var{clearEmptyPropertiesInObject:Su,wrapInQuotes:Tu}=ge(),k=null,Au=i(t=>{k=t.require("lodash")},"setDependencies"),wr=" (v)",bu=i(t=>t==="VIEW","isViewByTableType"),vu=i(t=>k.endsWith(t,wr),"isViewByName"),wu=i(t=>t.slice(0,-wr.length),"removeViewNameSuffix"),Cu=i(t=>`${t}${wr}`,"setViewSuffix"),Ru=i((t,e,r={})=>{let s=k.trim((e==null?void 0:e.view_definition)||r.definition||"");return s?`CREATE VIEW ${Tu(t)} AS ${s}`:""},"generateCreateViewScript"),Nu=i((t,e,r)=>{let s={withCheckOption:(t==null?void 0:t.check_option)!=="NONE"||k.isNil(t==null?void 0:t.check_option),checkTestingScope:Ou(t==null?void 0:t.check_option),viewOptions:k.fromPairs(k.map(e==null?void 0:e.view_options,xu)),temporary:(e==null?void 0:e.persistence)==="t",recursive:Iu(t),description:e==null?void 0:e.description,triggers:r};return Su(s)},"prepareViewData"),Ou=i(t=>t==="NONE"?"":t,"getCheckTestingScope"),Iu=i(t=>k.startsWith(k.trim(t==null?void 0:t.view_definition),"WITH RECURSIVE"),"isViewRecursive"),xu=i(t=>k.split(t,"="),"splitByEqualitySymbol");Gn.exports={setDependencies:Au,isViewByTableType:bu,isViewByName:vu,removeViewNameSuffix:wu,generateCreateViewScript:Ru,setViewSuffix:Cu,prepareViewData:Nu}});var jn=_((mh,Hn)=>{"use strict";var Ue=null,Lu=i(t=>{Ue=t.require("lodash")},"setDependencies"),Pu=i((t,e)=>Ue.chain(t).map(r=>({...r,...Ue.find(e,{trigger_name:r.trigger_name})||{}})).map(Mu).value(),"getTriggers"),Mu=i(t=>{var e;return{name:t.trigger_name,triggerDescription:t.description,triggerConstraint:t.constraint,triggerTable:`${t.event_object_schema}.${t.event_object_table}`,triggerReferencedTable:t.referenced_table_name?[t.referenced_table_schema,t.referenced_table_name]:[],triggerType:t.action_timing,triggerEvents:qu(t),triggerUpdateColumns:(e=t.update_attributes)==null?void 0:e.filter(Boolean),triggerDeferrable:t.deferrable,triggerTimeConstraintCheck:t.deferred?"INITIALLY DEFERRED":"INITIALLY IMMEDIATE",triggerReferencing:!!t.action_reference_old_table||!!t.action_reference_new_table,triggerBeforeImageTransitionRelation:t.action_reference_old_table||"",triggerAfterImageTransitionRelation:t.action_reference_new_table||"",triggerEachRowStatement:t.action_orientation==="ROW"?"FOR EACH ROW":"FOR EACH STATEMENT",triggerCondition:t.action_condition,triggerFunction:Du(t.action_statement)}},"getTrigger"),qu=i(t=>Ue.map(t.trigger_events,e=>({triggerEvent:e})),"getTriggerEvents"),Du=i(t=>{var e,r,s;return((s=(r=(e=/EXECUTE (?:FUNCTION|PROCEDURE)(?<function>[\s\S]*)/.exec(t))==null?void 0:e.groups)==null?void 0:r.function)==null?void 0:s.trim())||""},"getFunctionFromTrigger");Hn.exports={setDependencies:Lu,getTriggers:Pu}});var $n=_((yh,Vn)=>{"use strict";var Fu=i((t,e)=>[ku,Bu].reduce(({attributes:r,entityLevel:s},n)=>n(r,s),{attributes:t,entityLevel:e}),"reorganizeConstraints"),ku=i((t,e)=>{var a,o,c;if(((c=(o=(a=e.primaryKey)==null?void 0:a[0])==null?void 0:o.compositePrimaryKey)==null?void 0:c.length)!==1)return{attributes:t,entityLevel:e};let s=e.primaryKey[0],n=s.compositePrimaryKey[0];return{attributes:Uu(t,n,s),entityLevel:ju(e)}},"reorganizePrimaryKeys"),Bu=i((t,e)=>(e.uniqueKey||[]).reduce(({attributes:r,entityLevel:s},n)=>{if(!(n.compositeUniqueKey.length===1))return{attributes:r,entityLevel:s};let o=n.compositeUniqueKey[0];return{attributes:Qu(r,o,n),entityLevel:Wu(s,n)}},{attributes:t,entityLevel:e}),"reorganizeUniqueKeys"),Uu=i((t,e,r)=>t.map(s=>s.name!==e?s:Gu(s,r)),"setAttributesPrimaryKeyData"),Gu=i((t,e)=>({...t,primaryKey:!0,primaryKeyOptions:Wn(e)}),"setPrimaryKeyData"),Qu=i((t,e,r)=>t.map(s=>s.name!==e?s:Hu(s,r)),"setAttributesUniqueKeyData"),Hu=i((t,e)=>({...t,unique:!0,uniqueKeyOptions:Wn(e)}),"setUniqueKeyData"),Wn=i(t=>[{constraintName:t.constraintName,indexInclude:t.indexInclude,indexStorageParameters:t.indexStorageParameters,indexTablespace:t.indexTablespace,indexComment:t.indexComment}],"getOptions"),ju=i(t=>({...t,primaryKey:[]}),"clearPrimaryKeys"),Wu=i((t,e)=>{let r=t.uniqueKey.filter(s=>s.constraintName!==e.constraintName);return{...t,uniqueKey:r}},"filterUniqueKeys");Vn.exports={reorganizeConstraints:Fu}});var Zn=_((Th,Jn)=>{"use strict";var{createClient:Vu}=mn(),f=An(),{getJsonSchema:zn}=wn(),{setDependencies:$u,mapColumnData:zu,setSubtypeFromSampledJsonValues:Ku}=br(),{setDependencies:Yu,clearEmptyPropertiesInObject:Kn}=ge(),{setDependencies:Ju,prepareForeignKeys:Zu}=In(),{setDependencies:Xu,mapFunctionData:el,mapProcedureData:tl}=Pn(),{setDependencies:rl,prepareTablePartition:sl,checkHaveJsonTypes:nl,prepareTableConstraints:il,getSampleDocSize:al,prepareTableLevelData:ol,prepareTableIndexes:cl,prepareTableInheritance:Sh}=kn(),{setDependencies:ul,getUserDefinedTypes:ll,isTypeComposite:pl}=Un(),{setDependencies:hl,isViewByTableType:_l,isViewByName:dl,removeViewNameSuffix:fl,generateCreateViewScript:ml,setViewSuffix:gl,prepareViewData:yl}=Qn(),{setDependencies:El,getTriggers:Yn}=jn(),m=Ar(),{reorganizeConstraints:Sl}=$n(),Cr=!1,b=null,q=null,Rr=14;Jn.exports={setDependencies(t){b=t.require("lodash"),Yu(t),rl(t),$u(t),Ju(t),hl(t),Xu(t),ul(t),El(t)},async connect(t,e,r){f.isClientInitialized()&&await this.disconnect(e);let{client:s,iSshTunnel:n}=await Vu(t,e,r);f.initializeClient(s,r),Cr=n,q=r,Rr=await this._getServerVersion()},async disconnect(t){Cr&&(await t.closeConsumer(),Cr=!1),await f.releaseClient()},pingDb(){return f.query(m.PING)},applyScript(t){return f.query(t)},async getDatabaseNames(){return b.map(await f.query(m.GET_DATABASES),"database_name")},async logVersion(){let t=await f.queryTolerant(m.GET_VERSION,[],!0),e=(t==null?void 0:t.version)||"Version not retrieved";q.info(`YugabyteDB version: ${e}`)},async getAllSchemasNames(){return(await f.query(m.GET_SCHEMA_NAMES)).map(({schema_name:e})=>e).filter(e=>!Tl(e))},async getTablesNames(t){let e=await f.query(m.GET_TABLE_NAMES,[t]),r=["FOREIGN TABLE"];return e.filter(({table_type:s})=>!b.includes(r,s)).map(({table_name:s,table_type:n})=>_l(n)?gl(s):s)},async getDbLevelData(){var s,n,a;q.progress("Get database data");let t=(s=await f.queryTolerant(m.GET_DB_NAME,[],!0))==null?void 0:s.current_database,e=(n=await f.queryTolerant(m.GET_DB_ENCODING,[],!0))==null?void 0:n.server_encoding,r=(a=await f.queryTolerant(m.GET_DB_COLLATE_NAME,[],!0))==null?void 0:a.default_collate_name;return Kn({database_name:t,encoding:e,LC_COLLATE:r,LC_CTYPE:r})},async retrieveEntitiesData(t,e,r,s=!1){let n=await this._retrieveUserDefinedTypes(t),a=await f.queryTolerant(m.GET_NAMESPACE_OID,[t],!0),o=a==null?void 0:a.oid,c=s?await f.queryTolerant(m.GET_PARTITIONS,[o]):[],[l,u]=b.partition(e,dl),p=u.flatMap(A=>[{tableName:A},...b.filter(c,{parent_name:A}).map(({child_name:N,is_parent_partitioned:x})=>({isParentPartitioned:x,tableName:N}))]),h=await re(b.uniq(p),b.bind(this._retrieveSingleTableData,this,r,o,t,n));return{views:await re(l,b.bind(this._retrieveSingleViewData,this,o,t)),tables:h,modelDefinitions:zn(n)}},async retrieveSchemaLevelData(t){var l;q.progress("Get Functions and Procedures",t);let e=(l=await f.queryTolerant(m.GET_NAMESPACE_OID,[t],!0))==null?void 0:l.oid,r=await f.queryTolerant(m.GET_FUNCTIONS_WITH_PROCEDURES,[t]),s=await f.queryTolerant(bl(Rr),[e]),[n,a]=b.partition(b.filter(r,"routine_type"),{routine_type:"FUNCTION"}),o=await re(n,async u=>{let p=await f.queryTolerant(m.GET_FUNCTIONS_WITH_PROCEDURES_ARGS,[u.specific_name]),h=b.find(s,{function_name:u.name});return el(u,p,h)}),c=await re(a,async u=>{let p=await f.queryTolerant(m.GET_FUNCTIONS_WITH_PROCEDURES_ARGS,[u.specific_name]),h=b.find(s,{function_name:u.name});return tl(u,p,h)});return{functions:o,procedures:c}},async _retrieveUserDefinedTypes(t){q.progress("Get User-Defined Types",t);let e=await f.queryTolerant(m.GET_USER_DEFINED_TYPES,[t]),r=await f.queryTolerant(m.GET_DOMAIN_TYPES,[t]),s=await re(e,async a=>pl(a)?{...a,columns:await f.queryTolerant(m.GET_COMPOSITE_TYPE_COLUMNS,[a.pg_class_oid])}:a),n=await re(r,async a=>({...a,constraints:await f.queryTolerant(m.GET_DOMAIN_TYPES_CONSTRAINTS,[a.domain_name,t])}));return ll(s,n)},async _retrieveSingleTableData(t,e,r,s,{tableName:n,isParentPartitioned:a}){q.progress("Get table data",r,n);let o=await f.queryTolerant(m.GET_TABLE_LEVEL_DATA,[n,e],!0),c=o==null?void 0:o.oid,l=await f.queryTolerant(m.GET_TABLE_TOAST_OPTIONS,[n,e],!0),u=await f.queryTolerant(m.GET_TABLE_PARTITION_DATA,[c],!0),p=await this._getTableColumns(n,r,c),h=await f.queryTolerant(m.GET_DESCRIPTION_BY_OID,[c],!0),g=await f.queryTolerant(m.GET_TABLE_CONSTRAINTS,[c]),A=await f.queryTolerant(Al(Rr),[c]),N=await f.queryTolerant(m.GET_TABLE_FOREIGN_KEYS,[c]),x=await f.queryTolerant(m.GET_TRIGGERS,[r,n]),B=await f.queryTolerant(m.GET_TRIGGERS_ADDITIONAL_DATA,[e,c]),se=sl(u,p),Qe=ol(o,l),He=vl(h),je=il(g,p),We=cl(A),Ee=Zu(N,n,r,p),D=Yn(x,B),Xn={partitioning:se,description:He,triggers:D,Indxs:We,...Qe,...je},ei=Kn(Xn),ne=p.map(zu(s)),ti=nl(ne),Ve=[];ti&&(Ve=await this._getDocuments(r,n,ne,t),ne=Ku(ne,Ve));let{attributes:ri,entityLevel:si}=Sl(ne,ei);return{name:n,entityLevel:si,jsonSchema:zn(ri),documents:Ve,relationships:Ee}},async _getTableColumns(t,e,r){q.progress("Get columns",e,t);let s=await f.query(m.GET_TABLE_COLUMNS,[t,e]),n=await f.queryTolerant(m.GET_TABLE_COLUMNS_ADDITIONAL_DATA,[r]);return b.map(s,(a,o)=>({...a,...b.find(n,{name:a.column_name})||{}}))},async _getDocuments(t,e,r,s){var l;q.progress("Sampling table",t,e);let n=`${t}.${e}`,a=((l=await f.queryTolerant(m.GET_ROWS_COUNT(n),[],!0))==null?void 0:l.quantity)||0,o=al(a,s),c=b.chain(r).filter(({type:u})=>b.includes(["json","jsonb"],u)).map("name").join(", ").value();return await f.queryTolerant(m.GET_SAMPLED_DATA(n,c),[o])},async _retrieveSingleViewData(t,e,r){q.progress("Get view data",e,r),r=fl(r);let s=await f.query(m.GET_VIEW_DATA,[r,e],!0),n=!(s!=null&&s.view_definition)&&await f.queryTolerant(m.GET_VIEW_SELECT_STMT_FALLBACK,[r,e],!0),a=await f.queryTolerant(m.GET_VIEW_OPTIONS,[r,t],!0),o=await f.queryTolerant(m.GET_TRIGGERS,[e,r]),c=await f.queryTolerant(m.GET_TRIGGERS_ADDITIONAL_DATA,[t,a==null?void 0:a.oid]),l=Yn(o,c),u=ml(r,s,n),p=yl(s,a,l);return u?{name:r,data:p,ddl:{script:u,type:"postgres"}}:(q.info("View select statement was not retrieved",{schemaName:e,viewName:r}),{name:r,data:p,jsonSchema:{properties:[]}})},async _getServerVersion(){let t=await f.queryTolerant(m.GET_VERSION_AS_NUM,[],!0),e=b.toNumber(t==null?void 0:t.server_version_num);return e>=1e5&&e<11e4?10:e>=11e4&&e<12e4?11:e>=12e4&&e<13e4?12:e>=13e4&&e<14e4?13:(e>=14e4&&e<15e4,14)}};var Tl=i(t=>!!(b.startsWith(t,"pg_")||b.includes(["information_schema"],t)),"isSystemSchema"),Al=i(t=>t===10?m.GET_TABLE_INDEXES_V_10:m.GET_TABLE_INDEXES,"getGetIndexesQuery"),bl=i(t=>t===10?m.GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL_V_10:m.GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL,"getGetFunctionsAdditionalDataQuery"),vl=i(t=>t==null?void 0:t.obj_description,"getDescriptionFromResult"),re=i((t,e)=>Promise.all(b.map(t,e)),"mapPromises")});var{createLogger:Ge}=Ir(),v=Zn();module.exports={async disconnect(t,e,r,s){let n=s.require("@hackolade/ssh-service");await v.disconnect(n),r()},async testConnection(t,e,r,s){let n=s.require("@hackolade/ssh-service");try{Nr("Test connection",t,e);let a=Ge({title:"Test connection instance log",hiddenKeys:t.hiddenKeys,logger:e});v.setDependencies(s),await v.connect(t,n,a),await v.pingDb(),await v.logVersion(),r()}catch(a){e.log("error",W(a),"Test connection instance log"),r(W(a))}finally{await v.disconnect(n)}},async getDatabases(t,e,r,s){try{Nr("Get databases",t,e);let n=s.require("@hackolade/ssh-service"),a=Ge({title:"Get DB names",hiddenKeys:t.hiddenKeys,logger:e});v.setDependencies(s),await v.connect(t,n,a),await v.logVersion();let o=await v.getDatabaseNames();return e.log("info",o,"All databases list",t.hiddenKeys),r(null,o)}catch(n){return e.log("error",n),r(W(n))}},getDocumentKinds:function(t,e,r){r(null,[])},async getDbCollectionsNames(t,e,r,s){let n=s.require("@hackolade/ssh-service");try{Nr("Get DB table names",t,e);let a=Ge({title:"Get DB collections names",hiddenKeys:t.hiddenKeys,logger:e});v.setDependencies(s),await v.connect(t,n,a),await v.logVersion();let c=await(await v.getAllSchemasNames()).reduce(async(l,u)=>{let p=await l;try{let h=await v.getTablesNames(u);return p.concat({dbName:u,dbCollections:h,isEmpty:h.length===0})}catch(h){return a.info(`Error reading database "${u}"`),a.error(h),p.concat({dbName:u,dbCollections:[],isEmpty:!0,status:!0})}},Promise.resolve([]));r(null,c)}catch(a){e.log("error",W(a),"Get DB collections names"),r(W(a)),await v.disconnect(n)}},async getDbCollectionsData(t,e,r,s){let n=s.require("@hackolade/ssh-service");try{e.log("info",t,"Retrieve tables data:",t.hiddenKeys);let a=Ge({title:"Get DB collections data log",hiddenKeys:t.hiddenKeys,logger:e});a.progress("Start reverse engineering...");let o=t.collectionData.collections,c=t.collectionData.dataBaseNames,l=await v.getDbLevelData(),{packages:u,relationships:p}=await Promise.all(c.map(async h=>{let{tables:g,views:A,modelDefinitions:N}=await v.retrieveEntitiesData(h,o[h],t.recordSamplingSettings,t.includePartitions),{functions:x,procedures:B,triggers:se}=await v.retrieveSchemaLevelData(h);return a.progress("Schema reversed successfully",h),{schemaName:h,tables:g,views:A,functions:x,procedures:B,modelDefinitions:N,triggers:se}})).then(h=>{let g=h.flatMap(({tables:N})=>N.map(x=>x.relationships)).flat();return{packages:h.flatMap(({schemaName:N,tables:x,views:B,functions:se,procedures:Qe,triggers:He,modelDefinitions:je})=>{let We={UDFs:se,Procedures:Qe,triggers:He},Ee=x.map(D=>({dbName:N,collectionName:D.name,documents:D.documents,views:[],emptyBucket:!1,entityLevel:D.entityLevel,validation:{jsonSchema:D.jsonSchema},bucketInfo:We,modelDefinitions:je})).sort(D=>s.require("lodash").isEmpty([])?-1:1);if(B!=null&&B.length){let D={dbName:N,views:B,emptyBucket:!1};return[...Ee,D]}return Ee}),relationships:g}}).then(({packages:h,relationships:g})=>({packages:wl(h),relationships:g}));r(null,u,l,p)}catch(a){e.log("error",W(a),"Retrieve tables data"),r(W(a))}finally{await v.disconnect(n)}}};var W=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError"),Nr=i((t,e,r)=>{r.clear(),r.log("info",e,"connectionInfo",e.hiddenKeys)},"logInfo"),wl=i(t=>t.sort((e,r)=>!e.collectionName&&!r.collectionName?0:e.collectionName?r.collectionName?e.collectionName.localeCompare(r.collectionName):-1:1),"orderPackages");
