"use strict";var Tt=Object.defineProperty;var Uc=Object.getOwnPropertyDescriptor;var Kc=Object.getOwnPropertyNames;var Gc=Object.prototype.hasOwnProperty;var i=(t,e)=>Tt(t,"name",{value:e,configurable:!0});var Vc=(t,e)=>()=>(t&&(e=t(t=0)),e);var A=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Hc=(t,e)=>{for(var r in e)Tt(t,r,{get:e[r],enumerable:!0})},Qc=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Kc(e))!Gc.call(t,s)&&s!==r&&Tt(t,s,{get:()=>e[s],enumerable:!(n=Uc(e,s))||n.enumerable});return t};var Yc=t=>Qc(Tt({},"__esModule",{value:!0}),t);var jt=A((bg,ys)=>{"use strict";var Wc=i(({title:t,logger:e,hiddenKeys:r})=>({info(n,s={}){e.log("info",{message:n,...s},t,r)},progress(n,s="",a=""){e.progress({message:n,containerName:s,entityName:a})},error(n){e.log("error",jc(n),t)}}),"createLogger"),jc=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError");ys.exports={createLogger:Wc}});var Xt=A(Es=>{"use strict";Es.parse=function(t,e){return new zt(t,e).parse()};var St=class St{constructor(e,r){this.source=e,this.transform=r||zc,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return e==="\\"?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var r;(this.recorded.length>0||e)&&(r=this.recorded.join(""),r==="NULL"&&!e&&(r=null),r!==null&&(r=this.transform(r)),this.entries.push(r),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var e=this.nextCharacter();if(e.value==="=")break}}parse(e){var r,n,s;for(this.consumeDimensions();!this.isEof();)if(r=this.nextCharacter(),r.value==="{"&&!s)this.dimension++,this.dimension>1&&(n=new St(this.source.substr(this.position-1),this.transform),this.entries.push(n.parse(!0)),this.position+=n.position-2);else if(r.value==="}"&&!s){if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else r.value==='"'&&!r.escaped?(s&&this.newEntry(!0),s=!s):r.value===","&&!s?this.newEntry():this.record(r.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};i(St,"ArrayParser");var zt=St;function zc(t){return t}i(zc,"identity")});var Jt=A((Rg,Ts)=>{var Xc=Xt();Ts.exports={create:function(t,e){return{parse:function(){return Xc.parse(t,e)}}}}});var Cs=A((wg,As)=>{"use strict";var Jc=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,Zc=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,eu=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,tu=/^-?infinity$/;As.exports=i(function(e){if(tu.test(e))return Number(e.replace("i","I"));var r=Jc.exec(e);if(!r)return ru(e)||null;var n=!!r[8],s=parseInt(r[1],10);n&&(s=Ss(s));var a=parseInt(r[2],10)-1,o=r[3],c=parseInt(r[4],10),u=parseInt(r[5],10),l=parseInt(r[6],10),m=r[7];m=m?1e3*parseFloat(m):0;var p,d=nu(e);return d!=null?(p=new Date(Date.UTC(s,a,o,c,u,l,m)),Zt(s)&&p.setUTCFullYear(s),d!==0&&p.setTime(p.getTime()-d)):(p=new Date(s,a,o,c,u,l,m),Zt(s)&&p.setFullYear(s)),p},"parseDate");function ru(t){var e=Zc.exec(t);if(e){var r=parseInt(e[1],10),n=!!e[4];n&&(r=Ss(r));var s=parseInt(e[2],10)-1,a=e[3],o=new Date(r,s,a);return Zt(r)&&o.setFullYear(r),o}}i(ru,"getDate");function nu(t){if(t.endsWith("+00"))return 0;var e=eu.exec(t.split(" ")[1]);if(e){var r=e[1];if(r==="Z")return 0;var n=r==="-"?-1:1,s=parseInt(e[2],10)*3600+parseInt(e[3]||0,10)*60+parseInt(e[4]||0,10);return s*n*1e3}}i(nu,"timeZoneOffset");function Ss(t){return-(t-1)}i(Ss,"bcYearToNegativeYear");function Zt(t){return t>=0&&t<100}i(Zt,"is0To99")});var bs=A((Dg,Ns)=>{Ns.exports=iu;var su=Object.prototype.hasOwnProperty;function iu(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)su.call(r,n)&&(t[n]=r[n])}return t}i(iu,"extend")});var Is=A((xg,Os)=>{"use strict";var au=bs();Os.exports=Ge;function Ge(t){if(!(this instanceof Ge))return new Ge(t);au(this,yu(t))}i(Ge,"PostgresInterval");var ou=["seconds","minutes","hours","days","months","years"];Ge.prototype.toPostgres=function(){var t=ou.filter(this.hasOwnProperty,this);return this.milliseconds&&t.indexOf("seconds")<0&&t.push("seconds"),t.length===0?"0":t.map(function(e){var r=this[e]||0;return e==="seconds"&&this.milliseconds&&(r=(r+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),r+" "+e},this).join(" ")};var cu={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},uu=["years","months","days"],lu=["hours","minutes","seconds"];Ge.prototype.toISOString=Ge.prototype.toISO=function(){var t=uu.map(r,this).join(""),e=lu.map(r,this).join("");return"P"+t+"T"+e;function r(n){var s=this[n]||0;return n==="seconds"&&this.milliseconds&&(s=(s+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),s+cu[n]}};var er="([+-]?\\d+)",pu=er+"\\s+years?",mu=er+"\\s+mons?",du=er+"\\s+days?",fu="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",hu=new RegExp([pu,mu,du,fu].map(function(t){return"("+t+")?"}).join("\\s*")),vs={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},gu=["hours","minutes","seconds","milliseconds"];function _u(t){var e=t+"000000".slice(t.length);return parseInt(e,10)/1e3}i(_u,"parseMilliseconds");function yu(t){if(!t)return{};var e=hu.exec(t),r=e[8]==="-";return Object.keys(vs).reduce(function(n,s){var a=vs[s],o=e[a];return!o||(o=s==="milliseconds"?_u(o):parseInt(o,10),!o)||(r&&~gu.indexOf(s)&&(o*=-1),n[s]=o),n},{})}i(yu,"parse")});var ws=A((qg,Rs)=>{"use strict";Rs.exports=i(function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var r="",n=0;n<e.length;)if(e[n]!=="\\")r+=e[n],++n;else if(/[0-7]{3}/.test(e.substr(n+1,3)))r+=String.fromCharCode(parseInt(e.substr(n+1,3),8)),n+=4;else{for(var s=1;n+s<e.length&&e[n+s]==="\\";)s++;for(var a=0;a<Math.floor(s/2);++a)r+="\\";n+=Math.floor(s/2)*2}return new Buffer(r,"binary")},"parseBytea")});var Fs=A((kg,qs)=>{var st=Xt(),it=Jt(),At=Cs(),Ds=Is(),Ls=ws();function Ct(t){return i(function(r){return r===null?r:t(r)},"nullAllowed")}i(Ct,"allowNull");function xs(t){return t===null?t:t==="TRUE"||t==="t"||t==="true"||t==="y"||t==="yes"||t==="on"||t==="1"}i(xs,"parseBool");function Eu(t){return t?st.parse(t,xs):null}i(Eu,"parseBoolArray");function Tu(t){return parseInt(t,10)}i(Tu,"parseBaseTenInt");function tr(t){return t?st.parse(t,Ct(Tu)):null}i(tr,"parseIntegerArray");function Su(t){return t?st.parse(t,Ct(function(e){return Ms(e).trim()})):null}i(Su,"parseBigIntegerArray");var Au=i(function(t){if(!t)return null;var e=it.create(t,function(r){return r!==null&&(r=ir(r)),r});return e.parse()},"parsePointArray"),rr=i(function(t){if(!t)return null;var e=it.create(t,function(r){return r!==null&&(r=parseFloat(r)),r});return e.parse()},"parseFloatArray"),ge=i(function(t){if(!t)return null;var e=it.create(t);return e.parse()},"parseStringArray"),nr=i(function(t){if(!t)return null;var e=it.create(t,function(r){return r!==null&&(r=At(r)),r});return e.parse()},"parseDateArray"),Cu=i(function(t){if(!t)return null;var e=it.create(t,function(r){return r!==null&&(r=Ds(r)),r});return e.parse()},"parseIntervalArray"),Nu=i(function(t){return t?st.parse(t,Ct(Ls)):null},"parseByteAArray"),sr=i(function(t){return parseInt(t,10)},"parseInteger"),Ms=i(function(t){var e=String(t);return/^\d+$/.test(e)?e:t},"parseBigInteger"),Ps=i(function(t){return t?st.parse(t,Ct(JSON.parse)):null},"parseJsonArray"),ir=i(function(t){return t[0]!=="("?null:(t=t.substring(1,t.length-1).split(","),{x:parseFloat(t[0]),y:parseFloat(t[1])})},"parsePoint"),bu=i(function(t){if(t[0]!=="<"&&t[1]!=="(")return null;for(var e="(",r="",n=!1,s=2;s<t.length-1;s++){if(n||(e+=t[s]),t[s]===")"){n=!0;continue}else if(!n)continue;t[s]!==","&&(r+=t[s])}var a=ir(e);return a.radius=parseFloat(r),a},"parseCircle"),vu=i(function(t){t(20,Ms),t(21,sr),t(23,sr),t(26,sr),t(700,parseFloat),t(701,parseFloat),t(16,xs),t(1082,At),t(1114,At),t(1184,At),t(600,ir),t(651,ge),t(718,bu),t(1e3,Eu),t(1001,Nu),t(1005,tr),t(1007,tr),t(1028,tr),t(1016,Su),t(1017,Au),t(1021,rr),t(1022,rr),t(1231,rr),t(1014,ge),t(1015,ge),t(1008,ge),t(1009,ge),t(1040,ge),t(1041,ge),t(1115,nr),t(1182,nr),t(1185,nr),t(1186,Ds),t(1187,Cu),t(17,Ls),t(114,JSON.parse.bind(JSON)),t(3802,JSON.parse.bind(JSON)),t(199,Ps),t(3807,Ps),t(3907,ge),t(2951,ge),t(791,ge),t(1183,ge),t(1270,ge)},"init");qs.exports={init:vu}});var $s=A((Bg,ks)=>{"use strict";var pe=1e6;function Ou(t){var e=t.readInt32BE(0),r=t.readUInt32BE(4),n="";e<0&&(e=~e+(r===0),r=~r+1>>>0,n="-");var s="",a,o,c,u,l,m;{if(a=e%pe,e=e/pe>>>0,o=4294967296*a+r,r=o/pe>>>0,c=""+(o-pe*r),r===0&&e===0)return n+c+s;for(u="",l=6-c.length,m=0;m<l;m++)u+="0";s=u+c+s}{if(a=e%pe,e=e/pe>>>0,o=4294967296*a+r,r=o/pe>>>0,c=""+(o-pe*r),r===0&&e===0)return n+c+s;for(u="",l=6-c.length,m=0;m<l;m++)u+="0";s=u+c+s}{if(a=e%pe,e=e/pe>>>0,o=4294967296*a+r,r=o/pe>>>0,c=""+(o-pe*r),r===0&&e===0)return n+c+s;for(u="",l=6-c.length,m=0;m<l;m++)u+="0";s=u+c+s}return a=e%pe,o=4294967296*a+r,c=""+o%pe,n+c+s}i(Ou,"readInt8");ks.exports=Ou});var Vs=A((Kg,Gs)=>{var Iu=$s(),Y=i(function(t,e,r,n,s){r=r||0,n=n||!1,s=s||function(f,y,g){return f*Math.pow(2,g)+y};var a=r>>3,o=i(function(f){return n?~f&255:f},"inv"),c=255,u=8-r%8;e<u&&(c=255<<8-e&255,u=e),r&&(c=c>>r%8);var l=0;r%8+e>=8&&(l=s(0,o(t[a])&c,u));for(var m=e+r>>3,p=a+1;p<m;p++)l=s(l,o(t[p]),8);var d=(e+r)%8;return d>0&&(l=s(l,o(t[m])>>8-d,d)),l},"parseBits"),Ks=i(function(t,e,r){var n=Math.pow(2,r-1)-1,s=Y(t,1),a=Y(t,r,1);if(a===0)return 0;var o=1,c=i(function(l,m,p){l===0&&(l=1);for(var d=1;d<=p;d++)o/=2,(m&1<<p-d)>0&&(l+=o);return l},"parsePrecisionBits"),u=Y(t,e,r+1,!1,c);return a==Math.pow(2,r+1)-1?u===0?s===0?1/0:-1/0:NaN:(s===0?1:-1)*Math.pow(2,a-n)*u},"parseFloatFromBits"),Ru=i(function(t){return Y(t,1)==1?-1*(Y(t,15,1,!0)+1):Y(t,15,1)},"parseInt16"),Bs=i(function(t){return Y(t,1)==1?-1*(Y(t,31,1,!0)+1):Y(t,31,1)},"parseInt32"),wu=i(function(t){return Ks(t,23,8)},"parseFloat32"),Pu=i(function(t){return Ks(t,52,11)},"parseFloat64"),Du=i(function(t){var e=Y(t,16,32);if(e==49152)return NaN;for(var r=Math.pow(1e4,Y(t,16,16)),n=0,s=[],a=Y(t,16),o=0;o<a;o++)n+=Y(t,16,64+16*o)*r,r/=1e4;var c=Math.pow(10,Y(t,16,48));return(e===0?1:-1)*Math.round(n*c)/c},"parseNumeric"),Us=i(function(t,e){var r=Y(e,1),n=Y(e,63,1),s=new Date((r===0?1:-1)*n/1e3+9466848e5);return t||s.setTime(s.getTime()+s.getTimezoneOffset()*6e4),s.usec=n%1e3,s.getMicroSeconds=function(){return this.usec},s.setMicroSeconds=function(a){this.usec=a},s.getUTCMicroSeconds=function(){return this.usec},s},"parseDate"),at=i(function(t){for(var e=Y(t,32),r=Y(t,32,32),n=Y(t,32,64),s=96,a=[],o=0;o<e;o++)a[o]=Y(t,32,s),s+=32,s+=32;var c=i(function(l){var m=Y(t,32,s);if(s+=32,m==4294967295)return null;var p;if(l==23||l==20)return p=Y(t,m*8,s),s+=m*8,p;if(l==25)return p=t.toString(this.encoding,s>>3,(s+=m<<3)>>3),p;console.log("ERROR: ElementType not implemented: "+l)},"parseElement"),u=i(function(l,m){var p=[],d;if(l.length>1){var f=l.shift();for(d=0;d<f;d++)p[d]=u(l,m);l.unshift(f)}else for(d=0;d<l[0];d++)p[d]=c(m);return p},"parse");return u(a,n)},"parseArray"),Lu=i(function(t){return t.toString("utf8")},"parseText"),xu=i(function(t){return t===null?null:Y(t,8)>0},"parseBool"),Mu=i(function(t){t(20,Iu),t(21,Ru),t(23,Bs),t(26,Bs),t(1700,Du),t(700,wu),t(701,Pu),t(16,xu),t(1114,Us.bind(null,!1)),t(1184,Us.bind(null,!0)),t(1e3,at),t(1007,at),t(1016,at),t(1008,at),t(1009,at),t(25,Lu)},"init");Gs.exports={init:Mu}});var Qs=A((Vg,Hs)=>{Hs.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var ut=A(ct=>{var qu=Fs(),Fu=Vs(),ku=Jt(),$u=Qs();ct.getTypeParser=Bu;ct.setTypeParser=Uu;ct.arrayParser=ku;ct.builtins=$u;var ot={text:{},binary:{}};function Ys(t){return String(t)}i(Ys,"noParse");function Bu(t,e){return e=e||"text",ot[e]&&ot[e][t]||Ys}i(Bu,"getTypeParser");function Uu(t,e,r){typeof e=="function"&&(r=e,e="text"),ot[e][t]=r}i(Uu,"setTypeParser");qu.init(function(t,e){ot.text[t]=e});Fu.init(function(t,e){ot.binary[t]=e})});var lt=A((Yg,ar)=>{"use strict";ar.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var Ve=ut(),Ku=Ve.getTypeParser(20,"text"),Gu=Ve.getTypeParser(1016,"text");ar.exports.__defineSetter__("parseInt8",function(t){Ve.setTypeParser(20,"text",t?Ve.getTypeParser(23,"text"):Ku),Ve.setTypeParser(1016,"text",t?Ve.getTypeParser(1007,"text"):Gu)})});var pt=A((Wg,js)=>{"use strict";var Vu=lt();function Hu(t){var e=t.replace(/\\/g,"\\\\").replace(/"/g,'\\"');return'"'+e+'"'}i(Hu,"escapeElement");function Ws(t){for(var e="{",r=0;r<t.length;r++)if(r>0&&(e=e+","),t[r]===null||typeof t[r]>"u")e=e+"NULL";else if(Array.isArray(t[r]))e=e+Ws(t[r]);else if(ArrayBuffer.isView(t[r])){var n=t[r];if(!(n instanceof Buffer)){var s=Buffer.from(n.buffer,n.byteOffset,n.byteLength);s.length===n.byteLength?n=s:n=s.slice(n.byteOffset,n.byteOffset+n.byteLength)}e+="\\\\x"+n.toString("hex")}else e+=Hu(Nt(t[r]));return e=e+"}",e}i(Ws,"arrayString");var Nt=i(function(t,e){if(t==null)return null;if(t instanceof Buffer)return t;if(ArrayBuffer.isView(t)){var r=Buffer.from(t.buffer,t.byteOffset,t.byteLength);return r.length===t.byteLength?r:r.slice(t.byteOffset,t.byteOffset+t.byteLength)}return t instanceof Date?Vu.parseInputDatesAsUTC?Wu(t):Yu(t):Array.isArray(t)?Ws(t):typeof t=="object"?Qu(t,e):t.toString()},"prepareValue");function Qu(t,e){if(t&&typeof t.toPostgres=="function"){if(e=e||[],e.indexOf(t)!==-1)throw new Error('circular reference detected while preparing "'+t+'" for query');return e.push(t),Nt(t.toPostgres(Nt),e)}return JSON.stringify(t)}i(Qu,"prepareObject");function ce(t,e){for(t=""+t;t.length<e;)t="0"+t;return t}i(ce,"pad");function Yu(t){var e=-t.getTimezoneOffset(),r=t.getFullYear(),n=r<1;n&&(r=Math.abs(r)+1);var s=ce(r,4)+"-"+ce(t.getMonth()+1,2)+"-"+ce(t.getDate(),2)+"T"+ce(t.getHours(),2)+":"+ce(t.getMinutes(),2)+":"+ce(t.getSeconds(),2)+"."+ce(t.getMilliseconds(),3);return e<0?(s+="-",e*=-1):s+="+",s+=ce(Math.floor(e/60),2)+":"+ce(e%60,2),n&&(s+=" BC"),s}i(Yu,"dateToString");function Wu(t){var e=t.getUTCFullYear(),r=e<1;r&&(e=Math.abs(e)+1);var n=ce(e,4)+"-"+ce(t.getUTCMonth()+1,2)+"-"+ce(t.getUTCDate(),2)+"T"+ce(t.getUTCHours(),2)+":"+ce(t.getUTCMinutes(),2)+":"+ce(t.getUTCSeconds(),2)+"."+ce(t.getUTCMilliseconds(),3);return n+="+00:00",r&&(n+=" BC"),n}i(Wu,"dateToStringUTC");function ju(t,e,r){return t=typeof t=="string"?{text:t}:t,e&&(typeof e=="function"?t.callback=e:t.values=e),r&&(t.callback=r),t}i(ju,"normalizeQueryConfig");var zu=i(function(t){return'"'+t.replace(/"/g,'""')+'"'},"escapeIdentifier"),Xu=i(function(t){for(var e=!1,r="'",n=0;n<t.length;n++){var s=t[n];s==="'"?r+=s+s:s==="\\"?(r+=s+s,e=!0):r+=s}return r+="'",e===!0&&(r=" E"+r),r},"escapeLiteral");js.exports={prepareValue:i(function(e){return Nt(e)},"prepareValueWrapper"),normalizeQueryConfig:ju,escapeIdentifier:zu,escapeLiteral:Xu}});var Xs=A((zg,zs)=>{"use strict";var mt=require("crypto");function or(t){return mt.createHash("md5").update(t,"utf-8").digest("hex")}i(or,"md5");function Ju(t,e,r){var n=or(e+t),s=or(Buffer.concat([Buffer.from(n),r]));return"md5"+s}i(Ju,"postgresMd5PasswordHash");function Zu(t){return mt.createHash("sha256").update(t).digest()}i(Zu,"sha256");function el(t,e){return mt.createHmac("sha256",t).update(e).digest()}i(el,"hmacSha256");async function tl(t,e,r){return mt.pbkdf2Sync(t,e,r,32,"sha256")}i(tl,"deriveKey");zs.exports={postgresMd5PasswordHash:Ju,randomBytes:mt.randomBytes,deriveKey:tl,sha256:Zu,hmacSha256:el,md5:or}});var ti=A((Jg,ei)=>{var Js=require("crypto");ei.exports={postgresMd5PasswordHash:nl,randomBytes:rl,deriveKey:al,sha256:sl,hmacSha256:il,md5:cr};var Zs=Js.webcrypto||globalThis.crypto,He=Zs.subtle,ur=new TextEncoder;function rl(t){return Zs.getRandomValues(Buffer.alloc(t))}i(rl,"randomBytes");async function cr(t){try{return Js.createHash("md5").update(t,"utf-8").digest("hex")}catch{let r=typeof t=="string"?ur.encode(t):t,n=await He.digest("MD5",r);return Array.from(new Uint8Array(n)).map(s=>s.toString(16).padStart(2,"0")).join("")}}i(cr,"md5");async function nl(t,e,r){var n=await cr(e+t),s=await cr(Buffer.concat([Buffer.from(n),r]));return"md5"+s}i(nl,"postgresMd5PasswordHash");async function sl(t){return await He.digest("SHA-256",t)}i(sl,"sha256");async function il(t,e){let r=await He.importKey("raw",t,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await He.sign("HMAC",r,ur.encode(e))}i(il,"hmacSha256");async function al(t,e,r){let n=await He.importKey("raw",ur.encode(t),"PBKDF2",!1,["deriveBits"]),s={name:"PBKDF2",hash:"SHA-256",salt:e,iterations:r};return await He.deriveBits(s,n,32*8,["deriveBits"])}i(al,"deriveKey")});var pr=A((e_,lr)=>{"use strict";var ol=parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15;ol?lr.exports=Xs():lr.exports=ti()});var ii=A((t_,si)=>{"use strict";var $e=pr();function cl(t){if(t.indexOf("SCRAM-SHA-256")===-1)throw new Error("SASL: Only mechanism SCRAM-SHA-256 is currently supported");let e=$e.randomBytes(18).toString("base64");return{mechanism:"SCRAM-SHA-256",clientNonce:e,response:"n,,n=*,r="+e,message:"SASLInitialResponse"}}i(cl,"startSession");async function ul(t,e,r){if(t.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(e==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof r!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let n=ml(r);if(n.nonce.startsWith(t.clientNonce)){if(n.nonce.length===t.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");var s="n=*,r="+t.clientNonce,a="r="+n.nonce+",s="+n.salt+",i="+n.iteration,o="c=biws,r="+n.nonce,c=s+","+a+","+o,u=Buffer.from(n.salt,"base64"),l=await $e.deriveKey(e,u,n.iteration),m=await $e.hmacSha256(l,"Client Key"),p=await $e.sha256(m),d=await $e.hmacSha256(p,c),f=fl(Buffer.from(m),Buffer.from(d)).toString("base64"),y=await $e.hmacSha256(l,"Server Key"),g=await $e.hmacSha256(y,c);t.message="SASLResponse",t.serverSignature=Buffer.from(g).toString("base64"),t.response=o+",p="+f}i(ul,"continueSession");function ll(t,e){if(t.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:r}=dl(e);if(r!==t.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}i(ll,"finalizeSession");function pl(t){if(typeof t!="string")throw new TypeError("SASL: text must be a string");return t.split("").map((e,r)=>t.charCodeAt(r)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}i(pl,"isPrintableChars");function ri(t){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(t)}i(ri,"isBase64");function ni(t){if(typeof t!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(t.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");let r=e[0],n=e.substring(2);return[r,n]}))}i(ni,"parseAttributePairs");function ml(t){let e=ni(t),r=e.get("r");if(r){if(!pl(r))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let n=e.get("s");if(n){if(!ri(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let s=e.get("i");if(s){if(!/^[1-9][0-9]*$/.test(s))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let a=parseInt(s,10);return{nonce:r,salt:n,iteration:a}}i(ml,"parseServerFirstMessage");function dl(t){let r=ni(t).get("v");if(r){if(!ri(r))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:r}}i(dl,"parseServerFinalMessage");function fl(t,e){if(!Buffer.isBuffer(t))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(t.length!==e.length)throw new Error("Buffer lengths must match");if(t.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(t.map((r,n)=>t[n]^e[n]))}i(fl,"xorBuffers");si.exports={startSession:cl,continueSession:ul,finalizeSession:ll}});var mr=A((n_,ai)=>{"use strict";var hl=ut();function bt(t){this._types=t||hl,this.text={},this.binary={}}i(bt,"TypeOverrides");bt.prototype.getOverrides=function(t){switch(t){case"text":return this.text;case"binary":return this.binary;default:return{}}};bt.prototype.setTypeParser=function(t,e,r){typeof e=="function"&&(r=e,e="text"),this.getOverrides(e)[t]=r};bt.prototype.getTypeParser=function(t,e){return e=e||"text",this.getOverrides(e)[t]||this._types.getTypeParser(t,e)};ai.exports=bt});var ci=A((i_,oi)=>{"use strict";function dr(t){if(t.charAt(0)==="/"){let c=t.split(" ");return{host:c[0],database:c[1]}}let e={},r,n=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(t)&&(t=encodeURI(t).replace(/\%25(\d\d)/g,"%$1"));try{r=new URL(t,"postgres://base")}catch{r=new URL(t.replace("@/","@___DUMMY___/"),"postgres://base"),n=!0}for(let c of r.searchParams.entries())e[c[0]]=c[1];if(e.user=e.user||decodeURIComponent(r.username),e.password=e.password||decodeURIComponent(r.password),r.protocol=="socket:")return e.host=decodeURI(r.pathname),e.database=r.searchParams.get("db"),e.client_encoding=r.searchParams.get("encoding"),e;let s=n?"":r.hostname;e.host?s&&/^%2f/i.test(s)&&(r.pathname=s+r.pathname):e.host=decodeURIComponent(s),e.port||(e.port=r.port);let a=r.pathname.slice(1)||null;e.database=a?decodeURI(a):null,(e.ssl==="true"||e.ssl==="1")&&(e.ssl=!0),e.ssl==="0"&&(e.ssl=!1),(e.sslcert||e.sslkey||e.sslrootcert||e.sslmode)&&(e.ssl={});let o=e.sslcert||e.sslkey||e.sslrootcert?require("fs"):null;switch(e.sslcert&&(e.ssl.cert=o.readFileSync(e.sslcert).toString()),e.sslkey&&(e.ssl.key=o.readFileSync(e.sslkey).toString()),e.sslrootcert&&(e.ssl.ca=o.readFileSync(e.sslrootcert).toString()),e.sslmode){case"disable":{e.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{e.ssl.rejectUnauthorized=!1;break}}return e}i(dr,"parse");oi.exports=dr;dr.parse=dr});var gr=A((o_,pi)=>{"use strict";var gl=require("dns"),li=lt(),ui=ci().parse,le=i(function(t,e,r){return r===void 0?r=process.env["PG"+t.toUpperCase()]:r===!1||(r=process.env[r]),e[t]||r||li[t]},"val"),_l=i(function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return li.ssl},"readSSLConfigFromEnvironment"),Qe=i(function(t){return"'"+(""+t).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),_e=i(function(t,e,r){var n=e[r];n!=null&&t.push(r+"="+Qe(n))},"add"),hr=class hr{constructor(e){e=typeof e=="string"?ui(e):e||{},e.connectionString&&(e=Object.assign({},e,ui(e.connectionString))),this.user=le("user",e),this.database=le("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(le("port",e),10),this.host=le("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:le("password",e)}),this.binary=le("binary",e),this.options=le("options",e),this.ssl=typeof e.ssl>"u"?_l():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=le("client_encoding",e),this.replication=le("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=le("application_name",e,"PGAPPNAME"),this.fallback_application_name=le("fallback_application_name",e,!1),this.statement_timeout=le("statement_timeout",e,!1),this.lock_timeout=le("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=le("idle_in_transaction_session_timeout",e,!1),this.query_timeout=le("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){var r=[];_e(r,this,"user"),_e(r,this,"password"),_e(r,this,"port"),_e(r,this,"application_name"),_e(r,this,"fallback_application_name"),_e(r,this,"connect_timeout"),_e(r,this,"options");var n=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(_e(r,n,"sslmode"),_e(r,n,"sslca"),_e(r,n,"sslkey"),_e(r,n,"sslcert"),_e(r,n,"sslrootcert"),this.database&&r.push("dbname="+Qe(this.database)),this.replication&&r.push("replication="+Qe(this.replication)),this.host&&r.push("host="+Qe(this.host)),this.isDomainSocket)return e(null,r.join(" "));this.client_encoding&&r.push("client_encoding="+Qe(this.client_encoding)),gl.lookup(this.host,function(s,a){return s?e(s,null):(r.push("hostaddr="+Qe(a)),e(null,r.join(" ")))})}};i(hr,"ConnectionParameters");var fr=hr;pi.exports=fr});var fi=A((u_,di)=>{"use strict";var yl=ut(),mi=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,yr=class yr{constructor(e,r){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=r,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(e){var r;e.text?r=mi.exec(e.text):r=mi.exec(e.command),r&&(this.command=r[1],r[3]?(this.oid=parseInt(r[2],10),this.rowCount=parseInt(r[3],10)):r[2]&&(this.rowCount=parseInt(r[2],10)))}_parseRowAsArray(e){for(var r=new Array(e.length),n=0,s=e.length;n<s;n++){var a=e[n];a!==null?r[n]=this._parsers[n](a):r[n]=null}return r}parseRow(e){for(var r={...this._prebuiltEmptyResultObject},n=0,s=e.length;n<s;n++){var a=e[n],o=this.fields[n].name;a!==null?r[o]=this._parsers[n](a):r[o]=null}return r}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));for(var r={},n=0;n<e.length;n++){var s=e[n];r[s.name]=null,this._types?this._parsers[n]=this._types.getTypeParser(s.dataTypeID,s.format||"text"):this._parsers[n]=yl.getTypeParser(s.dataTypeID,s.format||"text")}this._prebuiltEmptyResultObject={...r}}};i(yr,"Result");var _r=yr;di.exports=_r});var yi=A((p_,_i)=>{"use strict";var{EventEmitter:El}=require("events"),hi=fi(),gi=pt(),Tr=class Tr extends El{constructor(e,r,n){super(),e=gi.normalizeQueryConfig(e,r,n),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new hi(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new hi(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let r;if(!this._canceledDueToError){try{r=this._result.parseRow(e.fields)}catch(n){this._canceledDueToError=n;return}this.emit("row",r,this._result),this._accumulateRows&&this._result.addRow(r)}}handleCommandComplete(e,r){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&r.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,r){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(r){process.nextTick(()=>{throw r})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let r=e.parsedStatements[this.name];return this.text&&r&&this.text!==r?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(e):e.query(this.text),null)}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,r){e.execute({portal:this.portal,rows:r}),r?e.flush():e.sync()}prepare(e){this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:gi.prepareValue})}catch(r){this.handleError(r,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,r){}};i(Tr,"Query");var Er=Tr;_i.exports=Er});var jr=A(D=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0});D.NoticeMessage=D.DataRowMessage=D.CommandCompleteMessage=D.ReadyForQueryMessage=D.NotificationResponseMessage=D.BackendKeyDataMessage=D.AuthenticationMD5Password=D.ParameterStatusMessage=D.ParameterDescriptionMessage=D.RowDescriptionMessage=D.Field=D.CopyResponse=D.CopyDataMessage=D.DatabaseError=D.copyDone=D.emptyQuery=D.replicationStart=D.portalSuspended=D.noData=D.closeComplete=D.bindComplete=D.parseComplete=void 0;D.parseComplete={name:"parseComplete",length:5};D.bindComplete={name:"bindComplete",length:5};D.closeComplete={name:"closeComplete",length:5};D.noData={name:"noData",length:5};D.portalSuspended={name:"portalSuspended",length:5};D.replicationStart={name:"replicationStart",length:4};D.emptyQuery={name:"emptyQuery",length:4};D.copyDone={name:"copyDone",length:4};var Mr=class Mr extends Error{constructor(e,r,n){super(e),this.length=r,this.name=n}};i(Mr,"DatabaseError");var Sr=Mr;D.DatabaseError=Sr;var qr=class qr{constructor(e,r){this.length=e,this.chunk=r,this.name="copyData"}};i(qr,"CopyDataMessage");var Ar=qr;D.CopyDataMessage=Ar;var Fr=class Fr{constructor(e,r,n,s){this.length=e,this.name=r,this.binary=n,this.columnTypes=new Array(s)}};i(Fr,"CopyResponse");var Cr=Fr;D.CopyResponse=Cr;var kr=class kr{constructor(e,r,n,s,a,o,c){this.name=e,this.tableID=r,this.columnID=n,this.dataTypeID=s,this.dataTypeSize=a,this.dataTypeModifier=o,this.format=c}};i(kr,"Field");var Nr=kr;D.Field=Nr;var $r=class $r{constructor(e,r){this.length=e,this.fieldCount=r,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};i($r,"RowDescriptionMessage");var br=$r;D.RowDescriptionMessage=br;var Br=class Br{constructor(e,r){this.length=e,this.parameterCount=r,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};i(Br,"ParameterDescriptionMessage");var vr=Br;D.ParameterDescriptionMessage=vr;var Ur=class Ur{constructor(e,r,n){this.length=e,this.parameterName=r,this.parameterValue=n,this.name="parameterStatus"}};i(Ur,"ParameterStatusMessage");var Or=Ur;D.ParameterStatusMessage=Or;var Kr=class Kr{constructor(e,r){this.length=e,this.salt=r,this.name="authenticationMD5Password"}};i(Kr,"AuthenticationMD5Password");var Ir=Kr;D.AuthenticationMD5Password=Ir;var Gr=class Gr{constructor(e,r,n){this.length=e,this.processID=r,this.secretKey=n,this.name="backendKeyData"}};i(Gr,"BackendKeyDataMessage");var Rr=Gr;D.BackendKeyDataMessage=Rr;var Vr=class Vr{constructor(e,r,n,s){this.length=e,this.processId=r,this.channel=n,this.payload=s,this.name="notification"}};i(Vr,"NotificationResponseMessage");var wr=Vr;D.NotificationResponseMessage=wr;var Hr=class Hr{constructor(e,r){this.length=e,this.status=r,this.name="readyForQuery"}};i(Hr,"ReadyForQueryMessage");var Pr=Hr;D.ReadyForQueryMessage=Pr;var Qr=class Qr{constructor(e,r){this.length=e,this.text=r,this.name="commandComplete"}};i(Qr,"CommandCompleteMessage");var Dr=Qr;D.CommandCompleteMessage=Dr;var Yr=class Yr{constructor(e,r){this.length=e,this.fields=r,this.name="dataRow",this.fieldCount=r.length}};i(Yr,"DataRowMessage");var Lr=Yr;D.DataRowMessage=Lr;var Wr=class Wr{constructor(e,r){this.length=e,this.message=r,this.name="notice"}};i(Wr,"NoticeMessage");var xr=Wr;D.NoticeMessage=xr});var Ei=A(vt=>{"use strict";Object.defineProperty(vt,"__esModule",{value:!0});vt.Writer=void 0;var Xr=class Xr{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){var r=this.buffer.length-this.offset;if(r<e){var n=this.buffer,s=n.length+(n.length>>1)+e;this.buffer=Buffer.allocUnsafe(s),n.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{var r=Buffer.byteLength(e);this.ensure(r+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=r}return this.buffer[this.offset++]=0,this}addString(e=""){var r=Buffer.byteLength(e);return this.ensure(r),this.buffer.write(e,this.offset),this.offset+=r,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let r=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(r,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){var r=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),r}};i(Xr,"Writer");var zr=Xr;vt.Writer=zr});var Si=A(It=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});It.serialize=void 0;var Jr=Ei(),W=new Jr.Writer,Tl=i(t=>{W.addInt16(3).addInt16(0);for(let n of Object.keys(t))W.addCString(n).addCString(t[n]);W.addCString("client_encoding").addCString("UTF8");var e=W.addCString("").flush(),r=e.length+4;return new Jr.Writer().addInt32(r).add(e).flush()},"startup"),Sl=i(()=>{let t=Buffer.allocUnsafe(8);return t.writeInt32BE(8,0),t.writeInt32BE(80877103,4),t},"requestSsl"),Al=i(t=>W.addCString(t).flush(112),"password"),Cl=i(function(t,e){return W.addCString(t).addInt32(Buffer.byteLength(e)).addString(e),W.flush(112)},"sendSASLInitialResponseMessage"),Nl=i(function(t){return W.addString(t).flush(112)},"sendSCRAMClientFinalMessage"),bl=i(t=>W.addCString(t).flush(81),"query"),Ti=[],vl=i(t=>{let e=t.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let r=t.types||Ti;for(var n=r.length,s=W.addCString(e).addCString(t.text).addInt16(n),a=0;a<n;a++)s.addInt32(r[a]);return W.flush(80)},"parse"),Ye=new Jr.Writer,Ol=i(function(t,e){for(let r=0;r<t.length;r++){let n=e?e(t[r],r):t[r];n==null?(W.addInt16(0),Ye.addInt32(-1)):n instanceof Buffer?(W.addInt16(1),Ye.addInt32(n.length),Ye.add(n)):(W.addInt16(0),Ye.addInt32(Buffer.byteLength(n)),Ye.addString(n))}},"writeValues"),Il=i((t={})=>{let e=t.portal||"",r=t.statement||"",n=t.binary||!1,s=t.values||Ti,a=s.length;return W.addCString(e).addCString(r),W.addInt16(a),Ol(s,t.valueMapper),W.addInt16(a),W.add(Ye.flush()),W.addInt16(n?1:0),W.flush(66)},"bind"),Rl=Buffer.from([69,0,0,0,9,0,0,0,0,0]),wl=i(t=>{if(!t||!t.portal&&!t.rows)return Rl;let e=t.portal||"",r=t.rows||0,n=Buffer.byteLength(e),s=4+n+1+4,a=Buffer.allocUnsafe(1+s);return a[0]=69,a.writeInt32BE(s,1),a.write(e,5,"utf-8"),a[n+5]=0,a.writeUInt32BE(r,a.length-4),a},"execute"),Pl=i((t,e)=>{let r=Buffer.allocUnsafe(16);return r.writeInt32BE(16,0),r.writeInt16BE(1234,4),r.writeInt16BE(5678,6),r.writeInt32BE(t,8),r.writeInt32BE(e,12),r},"cancel"),Zr=i((t,e)=>{let n=4+Buffer.byteLength(e)+1,s=Buffer.allocUnsafe(1+n);return s[0]=t,s.writeInt32BE(n,1),s.write(e,5,"utf-8"),s[n]=0,s},"cstringMessage"),Dl=W.addCString("P").flush(68),Ll=W.addCString("S").flush(68),xl=i(t=>t.name?Zr(68,`${t.type}${t.name||""}`):t.type==="P"?Dl:Ll,"describe"),Ml=i(t=>{let e=`${t.type}${t.name||""}`;return Zr(67,e)},"close"),ql=i(t=>W.add(t).flush(100),"copyData"),Fl=i(t=>Zr(102,t),"copyFail"),Ot=i(t=>Buffer.from([t,0,0,0,4]),"codeOnlyBuffer"),kl=Ot(72),$l=Ot(83),Bl=Ot(88),Ul=Ot(99),Kl={startup:Tl,password:Al,requestSsl:Sl,sendSASLInitialResponseMessage:Cl,sendSCRAMClientFinalMessage:Nl,query:bl,parse:vl,bind:Il,execute:wl,describe:xl,close:Ml,flush:()=>kl,sync:()=>$l,end:()=>Bl,copyData:ql,copyDone:()=>Ul,copyFail:Fl,cancel:Pl};It.serialize=Kl});var Ai=A(Rt=>{"use strict";Object.defineProperty(Rt,"__esModule",{value:!0});Rt.BufferReader=void 0;var Gl=Buffer.allocUnsafe(0),tn=class tn{constructor(e=0){this.offset=e,this.buffer=Gl,this.encoding="utf-8"}setBuffer(e,r){this.offset=e,this.buffer=r}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}string(e){let r=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,r}cstring(){let e=this.offset,r=e;for(;this.buffer[r++]!==0;);return this.offset=r,this.buffer.toString(this.encoding,e,r-1)}bytes(e){let r=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,r}};i(tn,"BufferReader");var en=tn;Rt.BufferReader=en});var bi=A(wt=>{"use strict";Object.defineProperty(wt,"__esModule",{value:!0});wt.Parser=void 0;var j=jr(),Vl=Ai(),rn=1,Hl=4,Ci=rn+Hl,Ni=Buffer.allocUnsafe(0),sn=class sn{constructor(e){if(this.buffer=Ni,this.bufferLength=0,this.bufferOffset=0,this.reader=new Vl.BufferReader,(e==null?void 0:e.mode)==="binary")throw new Error("Binary mode not supported yet");this.mode=(e==null?void 0:e.mode)||"text"}parse(e,r){this.mergeBuffer(e);let n=this.bufferOffset+this.bufferLength,s=this.bufferOffset;for(;s+Ci<=n;){let a=this.buffer[s],o=this.buffer.readUInt32BE(s+rn),c=rn+o;if(c+s<=n){let u=this.handlePacket(s+Ci,a,o,this.buffer);r(u),s+=c}else break}s===n?(this.buffer=Ni,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=n-s,this.bufferOffset=s)}mergeBuffer(e){if(this.bufferLength>0){let r=this.bufferLength+e.byteLength;if(r+this.bufferOffset>this.buffer.byteLength){let s;if(r<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)s=this.buffer;else{let a=this.buffer.byteLength*2;for(;r>=a;)a*=2;s=Buffer.allocUnsafe(a)}this.buffer.copy(s,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=s,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=r}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,r,n,s){switch(r){case 50:return j.bindComplete;case 49:return j.parseComplete;case 51:return j.closeComplete;case 110:return j.noData;case 115:return j.portalSuspended;case 99:return j.copyDone;case 87:return j.replicationStart;case 73:return j.emptyQuery;case 68:return this.parseDataRowMessage(e,n,s);case 67:return this.parseCommandCompleteMessage(e,n,s);case 90:return this.parseReadyForQueryMessage(e,n,s);case 65:return this.parseNotificationMessage(e,n,s);case 82:return this.parseAuthenticationResponse(e,n,s);case 83:return this.parseParameterStatusMessage(e,n,s);case 75:return this.parseBackendKeyData(e,n,s);case 69:return this.parseErrorMessage(e,n,s,"error");case 78:return this.parseErrorMessage(e,n,s,"notice");case 84:return this.parseRowDescriptionMessage(e,n,s);case 116:return this.parseParameterDescriptionMessage(e,n,s);case 71:return this.parseCopyInMessage(e,n,s);case 72:return this.parseCopyOutMessage(e,n,s);case 100:return this.parseCopyData(e,n,s);default:return new j.DatabaseError("received invalid response: "+r.toString(16),n,"error")}}parseReadyForQueryMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.string(1);return new j.ReadyForQueryMessage(r,s)}parseCommandCompleteMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.cstring();return new j.CommandCompleteMessage(r,s)}parseCopyData(e,r,n){let s=n.slice(e,e+(r-4));return new j.CopyDataMessage(r,s)}parseCopyInMessage(e,r,n){return this.parseCopyMessage(e,r,n,"copyInResponse")}parseCopyOutMessage(e,r,n){return this.parseCopyMessage(e,r,n,"copyOutResponse")}parseCopyMessage(e,r,n,s){this.reader.setBuffer(e,n);let a=this.reader.byte()!==0,o=this.reader.int16(),c=new j.CopyResponse(r,s,a,o);for(let u=0;u<o;u++)c.columnTypes[u]=this.reader.int16();return c}parseNotificationMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),a=this.reader.cstring(),o=this.reader.cstring();return new j.NotificationResponseMessage(r,s,a,o)}parseRowDescriptionMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),a=new j.RowDescriptionMessage(r,s);for(let o=0;o<s;o++)a.fields[o]=this.parseField();return a}parseField(){let e=this.reader.cstring(),r=this.reader.int32(),n=this.reader.int16(),s=this.reader.int32(),a=this.reader.int16(),o=this.reader.int32(),c=this.reader.int16()===0?"text":"binary";return new j.Field(e,r,n,s,a,o,c)}parseParameterDescriptionMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),a=new j.ParameterDescriptionMessage(r,s);for(let o=0;o<s;o++)a.dataTypeIDs[o]=this.reader.int32();return a}parseDataRowMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),a=new Array(s);for(let o=0;o<s;o++){let c=this.reader.int32();a[o]=c===-1?null:this.reader.string(c)}return new j.DataRowMessage(r,a)}parseParameterStatusMessage(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.cstring(),a=this.reader.cstring();return new j.ParameterStatusMessage(r,s,a)}parseBackendKeyData(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),a=this.reader.int32();return new j.BackendKeyDataMessage(r,s,a)}parseAuthenticationResponse(e,r,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),a={name:"authenticationOk",length:r};switch(s){case 0:break;case 3:a.length===8&&(a.name="authenticationCleartextPassword");break;case 5:if(a.length===12){a.name="authenticationMD5Password";let c=this.reader.bytes(4);return new j.AuthenticationMD5Password(r,c)}break;case 10:a.name="authenticationSASL",a.mechanisms=[];let o;do o=this.reader.cstring(),o&&a.mechanisms.push(o);while(o);break;case 11:a.name="authenticationSASLContinue",a.data=this.reader.string(r-8);break;case 12:a.name="authenticationSASLFinal",a.data=this.reader.string(r-8);break;default:throw new Error("Unknown authenticationOk message type "+s)}return a}parseErrorMessage(e,r,n,s){this.reader.setBuffer(e,n);let a={},o=this.reader.string(1);for(;o!=="\0";)a[o]=this.reader.cstring(),o=this.reader.string(1);let c=a.M,u=s==="notice"?new j.NoticeMessage(r,c):new j.DatabaseError(c,r,s);return u.severity=a.S,u.code=a.C,u.detail=a.D,u.hint=a.H,u.position=a.P,u.internalPosition=a.p,u.internalQuery=a.q,u.where=a.W,u.schema=a.s,u.table=a.t,u.column=a.c,u.dataType=a.d,u.constraint=a.n,u.file=a.F,u.line=a.L,u.routine=a.R,u}};i(sn,"Parser");var nn=sn;wt.Parser=nn});var an=A(De=>{"use strict";Object.defineProperty(De,"__esModule",{value:!0});De.DatabaseError=De.serialize=De.parse=void 0;var Ql=jr();Object.defineProperty(De,"DatabaseError",{enumerable:!0,get:function(){return Ql.DatabaseError}});var Yl=Si();Object.defineProperty(De,"serialize",{enumerable:!0,get:function(){return Yl.serialize}});var Wl=bi();function jl(t,e){let r=new Wl.Parser;return t.on("data",n=>r.parse(n,e)),new Promise(n=>t.on("end",()=>n()))}i(jl,"parse");De.parse=jl});var vi={};Hc(vi,{default:()=>zl});var zl,Oi=Vc(()=>{zl={}});var Ii=A((b_,on)=>{on.exports.getStream=i(function(e){let r=require("net");if(typeof r.Socket=="function")return new r.Socket;{let{CloudflareSocket:n}=(Oi(),Yc(vi));return new n(e)}},"getStream");on.exports.getSecureStream=i(function(e){var r=require("tls");return r.connect?r.connect(e):(e.socket.startTls(e),e.socket)},"getSecureStream")});var ln=A((I_,Ri)=>{"use strict";var O_=require("net"),Xl=require("events").EventEmitter,{parse:Jl,serialize:re}=an(),{getStream:Zl,getSecureStream:ep}=Ii(),tp=re.flush(),rp=re.sync(),np=re.end(),un=class un extends Xl{constructor(e){super(),e=e||{},this.stream=e.stream||Zl(e.ssl),typeof this.stream=="function"&&(this.stream=this.stream(e)),this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;var r=this;this.on("newListener",function(n){n==="message"&&(r._emitMessage=!0)})}connect(e,r){var n=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,r),this.stream.once("connect",function(){n._keepAlive&&n.stream.setKeepAlive(!0,n._keepAliveInitialDelayMillis),n.emit("connect")});let s=i(function(a){n._ending&&(a.code==="ECONNRESET"||a.code==="EPIPE")||n.emit("error",a)},"reportStreamError");if(this.stream.on("error",s),this.stream.on("close",function(){n.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(a){var o=a.toString("utf8");switch(o){case"S":break;case"N":return n.stream.end(),n.emit("error",new Error("The server does not support SSL connections"));default:return n.stream.end(),n.emit("error",new Error("There was an error establishing an SSL connection"))}let c={socket:n.stream};n.ssl!==!0&&(Object.assign(c,n.ssl),"key"in n.ssl&&(c.key=n.ssl.key));var u=require("net");u.isIP&&u.isIP(r)===0&&(c.servername=r);try{n.stream=ep(c)}catch(l){return n.emit("error",l)}n.attachListeners(n.stream),n.stream.on("error",s),n.emit("sslconnect")})}attachListeners(e){Jl(e,r=>{var n=r.name==="error"?"errorMessage":r.name;this._emitMessage&&this.emit("message",r),this.emit(n,r)})}requestSsl(){this.stream.write(re.requestSsl())}startup(e){this.stream.write(re.startup(e))}cancel(e,r){this._send(re.cancel(e,r))}password(e){this._send(re.password(e))}sendSASLInitialResponseMessage(e,r){this._send(re.sendSASLInitialResponseMessage(e,r))}sendSCRAMClientFinalMessage(e){this._send(re.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(re.query(e))}parse(e){this._send(re.parse(e))}bind(e){this._send(re.bind(e))}execute(e){this._send(re.execute(e))}flush(){this.stream.writable&&this.stream.write(tp)}sync(){this._ending=!0,this._send(rp)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(np,()=>{this.stream.end()})}close(e){this._send(re.close(e))}describe(e){this._send(re.describe(e))}sendCopyFromChunk(e){this._send(re.copyData(e))}endCopyFrom(){this._send(re.copyDone())}sendCopyFail(e){this._send(re.copyFail(e))}};i(un,"Connection");var cn=un;Ri.exports=cn});var Li=A((w_,Di)=>{"use strict";var{Transform:sp}=require("stream"),{StringDecoder:ip}=require("string_decoder"),Le=Symbol("last"),Pt=Symbol("decoder");function ap(t,e,r){let n;if(this.overflow){if(n=this[Pt].write(t).split(this.matcher),n.length===1)return r();n.shift(),this.overflow=!1}else this[Le]+=this[Pt].write(t),n=this[Le].split(this.matcher);this[Le]=n.pop();for(let s=0;s<n.length;s++)try{Pi(this,this.mapper(n[s]))}catch(a){return r(a)}if(this.overflow=this[Le].length>this.maxLength,this.overflow&&!this.skipOverflow){r(new Error("maximum buffer reached"));return}r()}i(ap,"transform");function op(t){if(this[Le]+=this[Pt].end(),this[Le])try{Pi(this,this.mapper(this[Le]))}catch(e){return t(e)}t()}i(op,"flush");function Pi(t,e){e!==void 0&&t.push(e)}i(Pi,"push");function wi(t){return t}i(wi,"noop");function cp(t,e,r){switch(t=t||/\r?\n/,e=e||wi,r=r||{},arguments.length){case 1:typeof t=="function"?(e=t,t=/\r?\n/):typeof t=="object"&&!(t instanceof RegExp)&&!t[Symbol.split]&&(r=t,t=/\r?\n/);break;case 2:typeof t=="function"?(r=e,e=t,t=/\r?\n/):typeof e=="object"&&(r=e,e=wi)}r=Object.assign({},r),r.autoDestroy=!0,r.transform=ap,r.flush=op,r.readableObjectMode=!0;let n=new sp(r);return n[Le]="",n[Pt]=new ip("utf8"),n.matcher=t,n.mapper=e,n.maxLength=r.maxLength,n.skipOverflow=r.skipOverflow||!1,n.overflow=!1,n._destroy=function(s,a){this._writableState.errorEmitted=!1,a(s)},n}i(cp,"split");Di.exports=cp});var qi=A((D_,Ie)=>{"use strict";var xi=require("path"),up=require("stream").Stream,lp=Li(),Mi=require("util"),pp=5432,Dt=process.platform==="win32",dt=process.stderr,mp=56,dp=7,fp=61440,hp=32768;function gp(t){return(t&fp)==hp}i(gp,"isRegFile");var We=["host","port","database","user","password"],pn=We.length,_p=We[pn-1];function mn(){var t=dt instanceof up&&dt.writable===!0;if(t){var e=Array.prototype.slice.call(arguments).concat(`
`);dt.write(Mi.format.apply(Mi,e))}}i(mn,"warn");Object.defineProperty(Ie.exports,"isWin",{get:function(){return Dt},set:function(t){Dt=t}});Ie.exports.warnTo=function(t){var e=dt;return dt=t,e};Ie.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(Dt?xi.join(e.APPDATA||"./","postgresql","pgpass.conf"):xi.join(e.HOME||"./",".pgpass"));return r};Ie.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:Dt?!0:(e=e||"<unkn>",gp(t.mode)?t.mode&(mp|dp)?(mn('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(mn('WARNING: password file "%s" is not a plain file',e),!1))};var yp=Ie.exports.match=function(t,e){return We.slice(0,-1).reduce(function(r,n,s){return s==1&&Number(t[n]||pp)===Number(e[n])?r&&!0:r&&(e[n]==="*"||e[n]===t[n])},!0)};Ie.exports.getPassword=function(t,e,r){var n,s=e.pipe(lp());function a(u){var l=Ep(u);l&&Tp(l)&&yp(t,l)&&(n=l[_p],s.end())}i(a,"onLine");var o=i(function(){e.destroy(),r(n)},"onEnd"),c=i(function(u){e.destroy(),mn("WARNING: error on reading file: %s",u),r(void 0)},"onErr");e.on("error",c),s.on("data",a).on("end",o).on("error",c)};var Ep=Ie.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",n=0,s=0,a=0,o={},c=!1,u=i(function(m,p,d){var f=t.substring(p,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),o[We[m]]=f},"addToObj"),l=0;l<t.length-1;l+=1){if(e=t.charAt(l+1),r=t.charAt(l),c=n==pn-1,c){u(n,s);break}l>=0&&e==":"&&r!=="\\"&&(u(n,s,l+1),s=l+2,n+=1)}return o=Object.keys(o).length===pn?o:null,o},Tp=Ie.exports.isValidEntry=function(t){for(var e={0:function(o){return o.length>0},1:function(o){return o==="*"?!0:(o=Number(o),isFinite(o)&&o>0&&o<9007199254740992&&Math.floor(o)===o)},2:function(o){return o.length>0},3:function(o){return o.length>0},4:function(o){return o.length>0}},r=0;r<We.length;r+=1){var n=e[r],s=t[We[r]]||"",a=n(s);if(!a)return!1}return!0}});var ki=A((M_,dn)=>{"use strict";var x_=require("path"),Fi=require("fs"),Lt=qi();dn.exports=function(t,e){var r=Lt.getFileName();Fi.stat(r,function(n,s){if(n||!Lt.usePgPass(s,r))return e(void 0);var a=Fi.createReadStream(r);Lt.getPassword(t,a,e)})};dn.exports.warnTo=Lt.warnTo});var Ki=A((q_,Ui)=>{"use strict";var Sp=require("events").EventEmitter,$i=pt(),fn=ii(),Ap=mr(),Cp=gr(),Bi=yi(),Np=lt(),bp=ln(),vp=pr(),hn=class hn extends Sp{constructor(e){super(),this.connectionParameters=new Cp(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var r=e||{};this._Promise=r.Promise||global.Promise,this._types=new Ap(r.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=r.connection||new bp({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||Np.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=i(n=>{process.nextTick(()=>{n.handleError(e,this.connection)})},"enqueueError");this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){var r=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let s=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(s)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){r.ssl?n.requestSsl():n.startup(r.getStartupConf())}),n.on("sslconnect",function(){n.startup(r.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let s=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(s),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(s):this._handleErrorEvent(s):this._connectionError||this._handleErrorEvent(s)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,n)=>{this._connect(s=>{s?n(s):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{r.emit("error",n)});else if(this.password!==null)e();else try{ki()(this.connectionParameters,s=>{s!==void 0&&(this.connectionParameters.password=this.password=s),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let r=await vp.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)}catch(r){this.emit("error",r)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=fn.startSession(e.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(r){this.connection.emit("error",r)}})}async _handleAuthSASLContinue(e){try{await fn.continueSession(this.saslSession,this.password,e.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(r){this.connection.emit("error",r)}}_handleAuthSASLFinal(e){try{fn.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(r){this.connection.emit("error",r)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(e){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){var e=this.connectionParameters,r={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(r.application_name=n),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){var n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,n){return this._types.setTypeParser(e,r,n)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return $i.escapeIdentifier(e)}escapeLiteral(e){return $i.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,n){var s,a,o,c,u;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(o=e.query_timeout||this.connectionParameters.query_timeout,a=s=e,typeof r=="function"&&(s.callback=s.callback||r)):(o=this.connectionParameters.query_timeout,s=new Bi(e,r,n),s.callback||(a=new this._Promise((l,m)=>{s.callback=(p,d)=>p?m(p):l(d)}).catch(l=>{throw Error.captureStackTrace(l),l}))),o&&(u=s.callback,c=setTimeout(()=>{var l=new Error("Query read timeout");process.nextTick(()=>{s.handleError(l,this.connection)}),u(l),s.callback=()=>{};var m=this.queryQueue.indexOf(s);m>-1&&this.queryQueue.splice(m,1),this._pulseQueryQueue()},o),s.callback=(l,m)=>{clearTimeout(c),u(l,m)}),this.binary&&!s.binary&&(s.binary=!0),s._result&&!s._result._types&&(s._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{s.handleError(new Error("Client was closed and is not queryable"),this.connection)}),a):(this.queryQueue.push(s),this._pulseQueryQueue(),a):(process.nextTick(()=>{s.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),a)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};i(hn,"Client");var xt=hn;xt.Query=Bi;Ui.exports=xt});var Qi=A((k_,Hi)=>{"use strict";var Op=require("events").EventEmitter,Gi=i(function(){},"NOOP"),Vi=i((t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},"removeWhere"),yn=class yn{constructor(e,r,n){this.client=e,this.idleListener=r,this.timeoutId=n}};i(yn,"IdleItem");var gn=yn,En=class En{constructor(e){this.callback=e}};i(En,"PendingItem");var je=En;function Ip(){throw new Error("Release called on client which has already been released to the pool.")}i(Ip,"throwOnDoubleRelease");function Mt(t,e){if(e)return{callback:e,result:void 0};let r,n,s=i(function(o,c){o?r(o):n(c)},"cb"),a=new t(function(o,c){n=o,r=c}).catch(o=>{throw Error.captureStackTrace(o),o});return{callback:s,result:a}}i(Mt,"promisify");function Rp(t,e){return i(function r(n){n.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",n)}),t._remove(e),t.emit("error",n,e)},"idleListener")}i(Rp,"makeIdleListener");var Tn=class Tn extends Op{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||Sn().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let n=r.client;n.ref&&n.ref();let s=r.idleListener;return this._acquireClient(n,e,s,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e){let r=Vi(this._idle,n=>n.client===e);r!==void 0&&clearTimeout(r.timeoutId),this._clients=this._clients.filter(n=>n!==e),e.end(),this.emit("remove",e)}connect(e){if(this.ending){let s=new Error("Cannot use a pool after calling end on the pool");return e?e(s):this.Promise.reject(s)}let r=Mt(this.Promise,e),n=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new je(r.callback)),n;let s=i((c,u,l)=>{clearTimeout(o),r.callback(c,u,l)},"queueCallback"),a=new je(s),o=setTimeout(()=>{Vi(this._pendingQueue,c=>c.callback===s),a.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(a),n}return this.newClient(new je(r.callback)),n}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let n=Rp(this,r);this.log("checking client timeout");let s,a=!1;this.options.connectionTimeoutMillis&&(s=setTimeout(()=>{this.log("ending client due to timeout"),a=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(o=>{if(s&&clearTimeout(s),r.on("error",n),o)this.log("client failed to connect",o),this._clients=this._clients.filter(c=>c!==r),a&&(o.message="Connection terminated due to connection timeout"),this._pulseQueue(),e.timedOut||e.callback(o,void 0,Gi);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let c=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(l=>l.client===r)!==-1&&this._acquireClient(r,new je((l,m,p)=>p()),n,!1)},this.options.maxLifetimeSeconds*1e3);c.unref(),r.once("end",()=>clearTimeout(c))}return this._acquireClient(r,e,n,!0)}})}_acquireClient(e,r,n,s){s&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),r.timedOut?s&&this.options.verify?this.options.verify(e,e.release):e.release():s&&this.options.verify?this.options.verify(e,a=>{if(a)return e.release(a),r.callback(a,void 0,Gi);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let n=!1;return s=>{n&&Ip(),n=!0,this._release(e,r,s)}}_release(e,r,n){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses){e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e),this._pulseQueue();return}if(this._expired.has(e)){this.log("remove expired client"),this._expired.delete(e),this._remove(e),this._pulseQueue();return}let a;this.options.idleTimeoutMillis&&(a=setTimeout(()=>{this.log("remove idle client"),this._remove(e)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&a.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new gn(e,r,a)),this._pulseQueue()}query(e,r,n){if(typeof e=="function"){let a=Mt(this.Promise,e);return setImmediate(function(){return a.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),a.result}typeof r=="function"&&(n=r,r=void 0);let s=Mt(this.Promise,n);return n=s.callback,this.connect((a,o)=>{if(a)return n(a);let c=!1,u=i(l=>{c||(c=!0,o.release(l),n(l))},"onError");o.once("error",u),this.log("dispatching query");try{o.query(e,r,(l,m)=>{if(this.log("query dispatched"),o.removeListener("error",u),!c)return c=!0,o.release(l),l?n(l):n(void 0,m)})}catch(l){return o.release(l),n(l)}}),s.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let r=Mt(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};i(Tn,"Pool");var _n=Tn;Hi.exports=_n});var ji=A((B_,Wi)=>{"use strict";var Yi=require("events").EventEmitter,wp=require("util"),An=pt(),ze=Wi.exports=function(t,e,r){Yi.call(this),t=An.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};wp.inherits(ze,Yi);var Pp={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};ze.prototype.handleError=function(t){var e=this.native.pq.resultErrorFields();if(e)for(var r in e){var n=Pp[r]||r;t[n]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};ze.prototype.then=function(t,e){return this._getPromise().then(t,e)};ze.prototype.catch=function(t){return this._getPromise().catch(t)};ze.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};ze.prototype.submit=function(t){this.state="running";var e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;var r=i(function(a,o,c){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),a)return e.handleError(a);e._emitRowEvents&&(c.length>1?o.forEach((u,l)=>{u.forEach(m=>{e.emit("row",m,c[l])})}):o.forEach(function(u){e.emit("row",u,c)})),e.state="end",e.emit("end",c),e.callback&&e.callback(null,c)},"after");if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var n=(this.values||[]).map(An.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let a=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(a)}return t.native.execute(this.name,n,r)}return t.native.prepare(this.name,this.text,n.length,function(a){return a?r(a):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,n,r))})}else if(this.values){if(!Array.isArray(this.values)){let a=new Error("Query values must be an array");return r(a)}var s=this.values.map(An.prepareValue);t.native.query(this.text,s,r)}else t.native.query(this.text,r)}});var ea=A((K_,Zi)=>{"use strict";var zi;try{zi=require("pg-native")}catch(t){throw t}var Dp=mr(),Xi=require("events").EventEmitter,Lp=require("util"),xp=gr(),Ji=ji(),me=Zi.exports=function(t){Xi.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new Dp(t.types),this.native=new zi({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var e=this.connectionParameters=new xp(t);t.nativeConnectionString&&(e.nativeConnectionString=t.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};me.Query=Ji;Lp.inherits(me,Xi);me.prototype._errorAllQueries=function(t){let e=i(r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})},"enqueueError");this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};me.prototype._connect=function(t){var e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),r)return t(r);e.native.connect(n,function(s){if(s)return e.native.end(),t(s);e._connected=!0,e.native.on("error",function(a){e._queryable=!1,e._errorAllQueries(a),e.emit("error",a)}),e.native.on("notification",function(a){e.emit("notification",{channel:a.relname,payload:a.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};me.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(n=>{n?r(n):e()})})};me.prototype.query=function(t,e,r){var n,s,a,o,c;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")a=t.query_timeout||this.connectionParameters.query_timeout,s=n=t,typeof e=="function"&&(t.callback=e);else if(a=this.connectionParameters.query_timeout,n=new Ji(t,e,r),!n.callback){let u,l;s=new this._Promise((m,p)=>{u=m,l=p}).catch(m=>{throw Error.captureStackTrace(m),m}),n.callback=(m,p)=>m?l(m):u(p)}return a&&(c=n.callback,o=setTimeout(()=>{var u=new Error("Query read timeout");process.nextTick(()=>{n.handleError(u,this.connection)}),c(u),n.callback=()=>{};var l=this._queryQueue.indexOf(n);l>-1&&this._queryQueue.splice(l,1),this._pulseQueryQueue()},a),n.callback=(u,l)=>{clearTimeout(o),c(u,l)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),s):(this._queryQueue.push(n),this._pulseQueryQueue(),s):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),s)};me.prototype.end=function(t){var e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));var r;return t||(r=new this._Promise(function(n,s){t=i(a=>a?s(a):n(),"cb")})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};me.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};me.prototype._pulseQueryQueue=function(t){if(this._connected&&!this._hasActiveQuery()){var e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);var r=this;e.once("_done",function(){r._pulseQueryQueue()})}};me.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};me.prototype.ref=function(){};me.prototype.unref=function(){};me.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};me.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var Cn=A((V_,ta)=>{"use strict";ta.exports=ea()});var Sn=A((H_,ft)=>{"use strict";var Mp=Ki(),qp=lt(),Fp=ln(),kp=Qi(),{DatabaseError:$p}=an(),{escapeIdentifier:Bp,escapeLiteral:Up}=pt(),Kp=i(t=>{var e;return e=class extends kp{constructor(n){super(n,t)}},i(e,"BoundPool"),e},"poolFactory"),Nn=i(function(t){this.defaults=qp,this.Client=t,this.Query=this.Client.Query,this.Pool=Kp(this.Client),this._pools=[],this.Connection=Fp,this.types=ut(),this.DatabaseError=$p,this.escapeIdentifier=Bp,this.escapeLiteral=Up},"PG");typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ft.exports=new Nn(Cn()):(ft.exports=new Nn(Mp),Object.defineProperty(ft.exports,"native",{configurable:!0,enumerable:!1,get(){var t=null;try{t=new Nn(Cn())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ft.exports,"native",{value:t}),t}}))});var na=A((Y_,ra)=>{"use strict";var Xe=require("fs"),Gp=Sn(),Vp="The server does not support SSL connections",Hp="28000",Qp=i((t,e)=>{let r=t.sslType;if(!r||r==="disable"||r==="allow")return!1;if(["require","prefer"].includes(r)&&!t.certAuthority)return{rejectUnauthorized:!1};let n={checkServerIdentity(s,a){e.info("Certificate",{hostname:s,cert:{subject:a.subject,issuer:a.issuer,valid_from:a.valid_from,valid_to:a.valid_to}})}};return Xe.existsSync(t.certAuthority)&&(n.ca=Xe.readFileSync(t.certAuthority).toString()),Xe.existsSync(t.clientCert)&&(n.cert=Xe.readFileSync(t.clientCert).toString()),Xe.existsSync(t.clientPrivateKey)&&(n.key=Xe.readFileSync(t.clientPrivateKey).toString()),n},"getSslOptions"),Yp=i(t=>({Off:"disable",TRUST_ALL_CERTIFICATES:"allow",TRUST_CUSTOM_CA_SIGNED_CERTIFICATES:"prefer",TRUST_SERVER_CLIENT_CERTIFICATES:"verify-full"})[t]||t,"mapSslType"),Wp=i(async(t,e,r)=>{let n=!1;if(t.ssh){let{options:o}=await e.openTunnel({sshAuthMethod:t.ssh_method==="privateKey"?"IDENTITY_FILE":"USER_PASSWORD",sshTunnelHostname:t.ssh_host,sshTunnelPort:t.ssh_port,sshTunnelUsername:t.ssh_user,sshTunnelPassword:t.ssh_password,sshTunnelIdentityFile:t.ssh_key_file,sshTunnelPassphrase:t.ssh_key_passphrase,host:t.host,port:t.port});t={...t,...o},n=!0}t=Object.assign({},t,{sslType:Yp(t.sslType)});let s={host:t.host,user:t.userName,password:t.userPassword,port:t.port,keepAlive:!0,ssl:Qp(t,r),connectionTimeoutMillis:Number(t.queryRequestTimeout)||6e4,query_timeout:Number(t.queryRequestTimeout)||6e4,statement_timeout:Number(t.queryRequestTimeout)||6e4,database:t.database||t.maintenanceDatabase,application_name:"Hackolade",idleTimeoutMillis:Number(t.queryRequestTimeout)||1e4,sslType:t.sslType,max:4};return{client:await bn(s,r),isSshTunnel:n}},"createClient"),jp=i((t,e,r)=>{var n;if(r.message===Vp&&t.sslType==="prefer")return e.info("Retry connection without SSL (SSL mode 'prefer')"),e.error(r),bn({...t,isRetry:!0,ssl:!1},e);if(((n=r.code)==null?void 0:n.toString())===Hp&&t.sslType==="allow")return e.info("Retry connection with SSL (SSL mode 'allow')"),e.error(r),bn({...t,isRetry:!0,ssl:{rejectUnauthorized:!1}},e);throw r},"retryOnSslError"),bn=i((t,e)=>{let r=new Gp.Pool(t);return r.connect().then(n=>(n.release(),r)).catch(async n=>{if(await r.end(),t.isRetry)throw n;return jp(t,e,n)})},"createConnectionPool");ra.exports={createClient:Wp}});var vn=A((j_,oa)=>{"use strict";var sa=i(t=>`
        SELECT indexname,
               index_method,
               index_unique,
               number_of_keys,
               where_expression,
               array_agg(attname
                         ORDER BY ord)::text[] AS columns,
               array_agg(coll
                         ORDER BY ord) AS collations,
               array_agg(opclass
                         ORDER BY ord) AS opclasses,
               array_agg(expression
                         ORDER BY ord) AS expressions,
               array_agg(ascending
                         ORDER BY ord) AS ascendings,
               array_agg(nulls_first
                         ORDER BY ord) AS nulls_first,
                reloptions AS storage_parameters,
                tablespace_name
        FROM
            (SELECT ct.oid AS table_oid,
                    c.relname AS indexname,
                    m.amname AS index_method,
                    indexes.indisunique AS index_unique,
                    indexes.ord,
                    attribute.attname,
                     c.reloptions,
                     tablespace_t.spcname AS tablespace_name,
                    indexes.${t===11?"indnatts":"indnkeyatts"} AS number_of_keys,
                    pg_catalog.pg_get_expr(indpred, indrelid) AS where_expression,
                    CASE
                        WHEN collation_namespace.nspname is not null THEN format('%I.%I',collation_namespace.nspname,collation_t.collname)
                    END AS coll,
                    CASE
                        WHEN opclass_t.opcname is not null THEN format('%I.%I',opclas_namespace.nspname,opclass_t.opcname)
                    END AS opclass,
                    CASE
                        WHEN indexes.ord > 0 THEN pg_catalog.pg_index_column_has_property(indexes.indexrelid, indexes.ord, 'asc')
                    END AS ascending,
                    CASE
                        WHEN indexes.ord > 0 THEN pg_catalog.pg_index_column_has_property(indexes.indexrelid, indexes.ord, 'nulls_first')
                    END AS nulls_first,
                    pg_catalog.pg_get_indexdef(indexes.indexrelid, ord, false) AS expression
             FROM
                 (SELECT *,
                         generate_series(1,array_length(i.indkey,1)) AS ord,
                         unnest(i.indkey) AS key,
                         unnest(i.indcollation) AS coll,
                         unnest(i.indclass) AS class,
                         unnest(i.indoption) AS option
                  FROM pg_catalog.pg_index i) indexes
             JOIN pg_catalog.pg_class c ON (c.oid=indexes.indexrelid)
             JOIN pg_catalog.pg_class ct ON (ct.oid=indexes.indrelid)
             JOIN pg_catalog.pg_am m ON (m.oid=c.relam)
             LEFT JOIN pg_catalog.pg_attribute attribute ON (attribute.attrelid=indexes.indrelid
                                                  AND attribute.attnum=indexes.key)
             LEFT JOIN pg_catalog.pg_collation collation_t ON (collation_t.oid=indexes.coll)
             LEFT JOIN pg_catalog.pg_namespace collation_namespace ON (collation_namespace.oid=collation_t.collnamespace)
             LEFT JOIN pg_catalog.pg_opclass opclass_t ON (opclass_t.oid=indexes.class)
             LEFT JOIN pg_catalog.pg_namespace opclas_namespace ON (opclas_namespace.oid=opclass_t.opcnamespace)
             LEFT JOIN pg_catalog.pg_tablespace tablespace_t ON (tablespace_t.oid = c.reltablespace)) s2
        WHERE table_oid = $1
        GROUP BY indexname,
                 index_method,
                 index_unique,
                 reloptions,
                 number_of_keys,
                 where_expression,
                 tablespace_name;
        `,"getGET_TABLE_INDEXES"),ia=i(t=>`
        SELECT obj_description(oid, 'pg_proc') AS description,
            proname AS function_name,
            provolatile AS volatility,
            proparallel AS parallel,
            proisstrict AS strict,
            proretset AS returns_set,
            proleakproof AS leak_proof,
            procost AS estimated_cost,
            prorows AS estimated_rows,
            prosrc AS body,
            ${t===10?"CASE WHEN proiswindow is true THEN 'w' ELSE '' END AS kind":"prokind AS kind"}
        FROM pg_catalog.pg_proc WHERE pronamespace = $1;`,"getGET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL"),aa={PING:"SELECT schema_name FROM information_schema.schemata LIMIT 1;",GET_VERSION:"SELECT version()",GET_VERSION_AS_NUM:"SHOW server_version_num;",GET_SCHEMA_NAMES:"SELECT schema_name FROM information_schema.schemata;",GET_TABLE_NAMES:`
        SELECT tables.table_name, tables.table_type FROM information_schema.tables AS tables
        INNER JOIN 
        (SELECT
                pg_class.relname AS table_name,
                 pg_namespace.nspname AS table_schema
        FROM pg_catalog.pg_class AS pg_class
        INNER JOIN pg_catalog.pg_namespace AS pg_namespace 
                ON (pg_namespace.oid = pg_class.relnamespace)
        WHERE pg_class.relispartition = false
                AND pg_class.relkind = ANY('{"r","v","t","m","p"}'))
        AS catalog_table_data
        ON (catalog_table_data.table_name = tables.table_name AND catalog_table_data.table_schema = tables.table_schema)
	LEFT JOIN (SELECT relname AS child_name FROM pg_catalog.pg_inherits AS inherit
		LEFT JOIN pg_catalog.pg_class AS child ON (child.oid = inherit.inhrelid)) AS inherited_tables
	ON (inherited_tables.child_name = tables.table_name)
	WHERE inherited_tables.child_name IS NULL
        AND tables.table_schema = $1;`,GET_NAMESPACE_OID:"SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = $1",GET_TABLE_LEVEL_DATA:`
        SELECT pc.oid, pc.relpersistence, pc.reloptions, pt.spcname, pg_get_expr(pc.relpartbound, pc.oid) AS partition_expr
            FROM pg_catalog.pg_class AS pc 
            LEFT JOIN pg_catalog.pg_tablespace AS pt 
            ON pc.reltablespace = pt.oid
            WHERE pc.relname = $1 AND pc.relnamespace = $2;`,GET_TABLE_TOAST_OPTIONS:`
        SELECT reloptions AS toast_options
        FROM pg_catalog.pg_class
        WHERE oid =
                (SELECT reltoastrelid
                 FROM pg_catalog.pg_class
                 WHERE relname=$1 AND relnamespace = $2
                 LIMIT 1)`,GET_TABLE_PARTITION_DATA:`
        SELECT partstrat as partition_method,
	            partattrs::int2[] as partition_attributes_positions,
	            pg_catalog.pg_get_expr(partexprs, partrelid) AS expressions
            FROM pg_catalog.pg_partitioned_table
            WHERE partrelid = $1;`,GET_TABLE_COLUMNS:`
        SELECT * FROM information_schema.columns
            WHERE table_name = $1 AND table_schema = $2
            ORDER BY ordinal_position`,GET_TABLE_COLUMNS_ADDITIONAL_DATA:`
        SELECT pg_attribute.attname AS name,
            pg_attribute.attndims AS number_of_array_dimensions,
            pg_description.description,
            pg_attribute.atttypmod AS attribute_mode
        FROM pg_catalog.pg_attribute AS pg_attribute
        LEFT JOIN pg_catalog.pg_description AS pg_description ON (pg_description.objsubid=pg_attribute.attnum
                                                               AND pg_description.objoid = pg_attribute.attrelid)
        WHERE pg_attribute.attrelid = $1;`,GET_DESCRIPTION_BY_OID:"SELECT obj_description($1)",GET_ROWS_COUNT:t=>`SELECT COUNT(*) AS quantity FROM ${t};`,GET_SAMPLED_DATA:(t,e)=>`SELECT ${e} FROM ${t} LIMIT $1;`,GET_INHERITS_PARENT_TABLE_NAME:`
        SELECT pc.relname AS parent_table_name FROM pg_catalog.pg_inherits AS pi
	        INNER JOIN pg_catalog.pg_class AS pc
	        ON pc.oid = pi.inhparent
	        WHERE pi.inhrelid = $1;`,GET_TABLE_CONSTRAINTS:`
        SELECT pcon.conname AS constraint_name, 
	            pcon.contype AS constraint_type,
	            pcon.connoinherit AS no_inherit,
	            pcon.conkey AS constraint_keys,
	            pg_catalog.pg_get_expr(pcon.conbin, pcon.conrelid) AS expression,
	            obj_description(pcon.oid, 'pg_constraint') AS description,
	            pc.reloptions AS storage_parameters,
	            pt.spcname AS tablespace
	        FROM pg_catalog.pg_constraint AS pcon
	        LEFT JOIN pg_catalog.pg_class AS pc
	        ON pcon.conindid = pc.oid
	        LEFT JOIN pg_catalog.pg_tablespace AS pt
	        ON pc.reltablespace = pt.oid
	        WHERE pcon.conrelid = $1;`,GET_TABLE_INDEXES:sa(),GET_TABLE_INDEXES_V_10:sa(10),GET_TABLE_FOREIGN_KEYS:`
        SELECT pcon.conname AS relationship_name, 
                pcon.conkey AS table_columns_positions,
                pcon.confdeltype AS relationship_on_delete,
                pcon.confupdtype AS relationship_on_update,
                pcon.confmatchtype AS relationship_match,
                pc_foreign_table.relname AS foreign_table_name, 
                ARRAY(
                    SELECT column_name::text FROM unnest(pcon.confkey) AS column_position 
                    JOIN information_schema.columns ON (ordinal_position = column_position)
                    WHERE table_name = pc_foreign_table.relname AND table_schema = foreign_table_namespace.nspname)::text[] AS foreign_columns,
                foreign_table_namespace.nspname AS foreign_table_schema
            FROM pg_catalog.pg_constraint AS pcon
            LEFT JOIN pg_catalog.pg_class AS pc ON pcon.conindid = pc.oid
            LEFT JOIN pg_catalog.pg_tablespace AS pt ON pc.reltablespace = pt.oid
            LEFT JOIN pg_catalog.pg_class AS pc_foreign_table ON (pcon.confrelid = pc_foreign_table.oid)
            JOIN pg_catalog.pg_namespace AS foreign_table_namespace ON (pc_foreign_table.relnamespace = foreign_table_namespace.oid)
            WHERE pcon.conrelid = $1 AND pcon.contype = 'f';`,GET_VIEW_DATA:"SELECT * FROM information_schema.views WHERE table_name = $1 AND table_schema = $2;",GET_VIEW_SELECT_STMT_FALLBACK:"SELECT definition FROM pg_views WHERE viewname = $1 AND schemaname = $2;",GET_VIEW_OPTIONS:`
        SELECT oid, 
            reloptions AS view_options,
            relpersistence AS persistence,
            obj_description(oid, 'pg_class') AS description
        FROM pg_catalog.pg_class 
        WHERE relname = $1 AND relnamespace = $2;`,GET_FUNCTIONS_WITH_PROCEDURES:`
        SELECT specific_name,
            routine_name AS name,
            routine_type,
            routine_definition,
            external_language,
            security_type,
            type_udt_name AS return_data_type
	    FROM information_schema.routines
	    WHERE specific_schema=$1;`,GET_FUNCTIONS_WITH_PROCEDURES_ARGS:`
        SELECT parameter_name,
            parameter_mode,
            parameter_default,
            data_type,
            udt_name
        FROM information_schema.parameters
        WHERE specific_name = $1
        ORDER BY ordinal_position;`,GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL:ia(),GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL_V_10:ia(10),GET_USER_DEFINED_TYPES:`
        SELECT pg_type.typrelid AS pg_class_oid,
            pg_type.typname AS name,
            pg_type.typtype AS type,
            pg_catalog.array_agg(pg_enum.enumlabel)::text[] AS enum_values,
            range_subtype_type.typname AS range_subtype,
            range_collation.collname AS range_collation_name,
            range_opclass.opcname AS range_opclass_name,
            range_canonical_proc.proname AS range_canonical_proc,
            range_diff_proc.proname AS range_diff_proc
        FROM pg_catalog.pg_type AS pg_type
        LEFT JOIN pg_catalog.pg_class AS pg_class ON (pg_class.oid = pg_type.typrelid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace ON (pg_namespace.oid = pg_type.typnamespace)
        LEFT JOIN pg_catalog.pg_enum AS pg_enum ON (pg_enum.enumtypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_range AS pg_range ON (pg_range.rngtypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_type AS range_subtype_type ON (range_subtype_type.oid = pg_range.rngsubtype)
        LEFT JOIN pg_catalog.pg_collation AS range_collation ON (range_collation.oid = pg_range.rngcollation)
        LEFT JOIN pg_catalog.pg_opclass AS range_opclass ON (range_opclass.oid = pg_range.rngsubopc)
        LEFT JOIN pg_catalog.pg_proc AS range_canonical_proc ON (range_canonical_proc.oid = pg_range.rngcanonical)
        LEFT JOIN pg_catalog.pg_proc AS range_diff_proc ON (range_diff_proc.oid = pg_range.rngsubdiff)
        WHERE pg_namespace.nspname = $1
         AND ((pg_type.typtype = 'c'
               AND pg_class.relkind = 'c')
              OR pg_type.typtype = 'e'
              OR pg_type.typtype = 'r')
        GROUP BY pg_class_oid,
              pg_type.typname,
              pg_type.typtype,
              pg_class.oid,
              range_subtype,
              range_collation_name,
              range_opclass_name,
              range_canonical_proc,
              range_diff_proc;`,GET_COMPOSITE_TYPE_COLUMNS:`
        SELECT pg_attribute.attname AS column_name,
           pg_type.typname AS data_type,
           pg_get_expr(pg_attrdef.adbin, pg_attrdef.adrelid) AS columns_default,
           pg_attribute.attnotnull AS not_null,
           pg_collation.collname AS collation_name,
           pg_attribute.attndims AS number_of_array_dimensions,
           pg_attribute.atttypmod AS character_maximum_length
        FROM pg_catalog.pg_attribute AS pg_attribute
        LEFT JOIN pg_catalog.pg_type AS pg_type ON (pg_type.oid = pg_attribute.atttypid)
        LEFT JOIN pg_catalog.pg_attrdef AS pg_attrdef ON (pg_attrdef.adrelid = pg_attribute.attrelid
                                                          AND pg_attrdef.adnum = pg_attribute.attnum)
        LEFT JOIN pg_catalog.pg_collation AS pg_collation ON (pg_collation.oid = pg_attribute.attcollation)
        WHERE pg_attribute.attrelid = $1`,GET_DB_NAME:"SELECT current_database();",GET_DB_ENCODING:"SHOW SERVER_ENCODING;",GET_DB_COLLATE_NAME:"SELECT default_collate_name FROM information_schema.character_sets;",GET_DOMAIN_TYPES:"SELECT * FROM information_schema.domains WHERE domain_schema = $1",GET_DOMAIN_TYPES_CONSTRAINTS:`
        SELECT pg_type.typname AS type_name,
        	pg_type.typnotnull AS not_null,
        	pg_constraint.conname AS constraint_name,
        	pg_catalog.pg_get_expr(pg_constraint.conbin, pg_constraint.conrelid) AS expression
        FROM pg_catalog.pg_type AS pg_type
        LEFT JOIN pg_catalog.pg_constraint AS pg_constraint ON (pg_constraint.contypid = pg_type.oid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace ON (pg_namespace.oid = pg_type.typnamespace)
        WHERE pg_type.typname = $1 AND pg_namespace.nspname = $2 AND pg_constraint.contype = 'c';`,GET_DATABASES:"SELECT datname AS database_name FROM pg_catalog.pg_database WHERE datistemplate != TRUE AND datallowconn = TRUE;",GET_TRIGGERS:`
        SELECT trigger_name,
                array_agg(event_manipulation::text) AS trigger_events,
                event_object_schema,
                event_object_table,
                action_orientation,
                action_timing,
                action_reference_old_table,
                action_reference_new_table,
                action_condition,
                action_statement
        FROM
            -- This is information_schema.triggers view but without permitions
            (SELECT (current_database())::information_schema.sql_identifier AS trigger_catalog,
                    (n.nspname)::information_schema.sql_identifier AS trigger_schema,
                    (t.tgname)::information_schema.sql_identifier AS trigger_name,
                    (em.text)::information_schema.character_data AS event_manipulation,
                    (current_database())::information_schema.sql_identifier AS event_object_catalog,
                    (n.nspname)::information_schema.sql_identifier AS event_object_schema,
                    (c.relname)::information_schema.sql_identifier AS event_object_table,
                    (rank() OVER (PARTITION BY (n.nspname)::information_schema.sql_identifier,
                                               (c.relname)::information_schema.sql_identifier,
                                               em.num, ((t.tgtype)::integer & 1), ((t.tgtype)::integer & 66)
                                  ORDER BY t.tgname))::information_schema.cardinal_number AS action_order,
                    (regexp_match(pg_get_triggerdef(t.oid), '.{35,} WHEN ((.+)) EXECUTE FUNCTION'::text))[1]::information_schema.character_data AS action_condition,
                    (SUBSTRING(pg_get_triggerdef(t.oid)
                               FROM (POSITION(('EXECUTE FUNCTION'::text) IN (SUBSTRING(pg_get_triggerdef(t.oid)
                                                                                       FROM 48))) + 47)))::information_schema.character_data AS action_statement,
                    (CASE ((t.tgtype)::integer & 1)
                         WHEN 1 THEN 'ROW'::text
                         ELSE 'STATEMENT'::text
                     END)::information_schema.character_data AS action_orientation,
                    (CASE ((t.tgtype)::integer & 66)
                         WHEN 2 THEN 'BEFORE'::text
                         WHEN 64 THEN 'INSTEAD OF'::text
                         ELSE 'AFTER'::text
                     END)::information_schema.character_data AS action_timing,
                    (t.tgoldtable)::information_schema.sql_identifier AS action_reference_old_table,
                    (t.tgnewtable)::information_schema.sql_identifier AS action_reference_new_table,
                    (NULL::timestamp with time zone)::information_schema.time_stamp AS created
                FROM pg_namespace n,
                        pg_class c,
                        pg_trigger t, (VALUES (4,'INSERT'::text), (8,'DELETE'::text), (16,'UPDATE'::text)) em(num, text)
                WHERE ((n.oid = c.relnamespace)
                        AND (c.oid = t.tgrelid)
                        AND (((t.tgtype)::integer & em.num) <> 0)
                        AND (NOT t.tgisinternal)
                        AND (NOT pg_is_other_temp_schema(n.oid)))) AS tmp_views
        WHERE event_object_schema = $1 AND event_object_table = $2
        GROUP BY
                trigger_schema,
                trigger_name,
                event_object_schema,
                event_object_table,
                action_orientation,
                action_timing,
                action_reference_old_table,
                action_reference_new_table,
                action_condition,
                action_statement;`,GET_TRIGGERS_ADDITIONAL_DATA:`
        SELECT
                pg_catalog.obj_description(pg_trigger.oid, 'pg_trigger') AS description,
        	pg_trigger.tgname AS trigger_name,
        	pg_proc.proname AS function_name,
        	CASE WHEN pg_trigger.tgconstraint != 0 THEN true ELSE false END AS "constraint",
        	array_agg(pg_attribute.attname)::text[] AS update_attributes,
        	tgdeferrable AS "deferrable",
        	tginitdeferred AS deferred,
                pg_class_referenced.relname AS referenced_table_name,
                pg_namespace_referenced.nspname AS referenced_table_schema
        FROM pg_catalog.pg_trigger as pg_trigger
        LEFT JOIN pg_catalog.pg_proc AS pg_proc 
        	ON (pg_trigger.tgfoid = pg_proc.oid)
        LEFT JOIN pg_catalog.pg_attribute AS pg_attribute
        	ON (pg_attribute.attnum = ANY(pg_trigger.tgattr::int2[]) AND pg_trigger.tgrelid = pg_attribute.attrelid)
        INNER JOIN pg_catalog.pg_class AS pg_class
        	ON (pg_class.oid = pg_trigger.tgrelid)
        INNER JOIN pg_catalog.pg_namespace AS pg_namespace
        	ON (pg_class.relnamespace = pg_namespace.oid)
        LEFT JOIN pg_catalog.pg_class AS pg_class_referenced
                ON(pg_class_referenced.oid = pg_trigger.tgconstrrelid)
        LEFT JOIN pg_catalog.pg_namespace AS pg_namespace_referenced
                ON(pg_namespace_referenced.oid = pg_class_referenced.relnamespace)
        WHERE pg_class.relnamespace = $1 AND pg_class.oid = $2
        GROUP BY 
        	trigger_name,
        	function_name,
        	"constraint",
        	"deferrable",
        	deferred,
                description,
                referenced_table_name,
                referenced_table_schema;`,GET_PARTITIONS:`
        SELECT
        	inher_child.relname AS child_name,
        	inher_parent.relname AS parent_name,
                CASE WHEN inher_parent.relkind = 'p' THEN TRUE ELSE FALSE END AS is_parent_partitioned
        FROM pg_inherits
        LEFT JOIN pg_class AS inher_child ON (inher_child.oid = pg_inherits.inhrelid)
        LEFT JOIN pg_class AS inher_parent ON (inher_parent.oid = pg_inherits.inhparent)
        WHERE inher_parent.relnamespace = $1;`},zp=i(t=>(Object.entries(aa).find(([r,n])=>t===n)||[])[0]||"Custom query","getQueryName");oa.exports={getQueryName:zp,...aa}});var ua=A((X_,ca)=>{"use strict";var Xp=vn(),Be=null,qt=null;ca.exports={initializeClient(t,e){Be=t,qt=e,Be.on("error",r=>e.error(r))},isClientInitialized(){return!!Be},releaseClient(){return Be?new Promise(t=>{Be.end(()=>{Be=null,t()})}):Promise.resolve()},async query(t,e,r=!1){let n=Xp.getQueryName(t);qt.info("Execute query",{queryName:n,params:e});let s=Date.now(),a=await Be.query(t,e),o=Date.now()-s;qt.info("Query executed",{queryName:n,params:e,duration:o,rowsCount:a.rowCount});let c=a.rows||[];return r?c[0]:c},async queryTolerant(t,e,r=!1){try{return await this.query(t,e,r)}catch(n){return n.query=t,n.params=e,qt.error(n),null}}}});var ma=A((J_,pa)=>{"use strict";var la=i(t=>{let e=t.reduce((n,s)=>s.properties?{...n,[s.name]:{...s,...la(s.properties)}}:{...n,[s.name]:s},{}),r=Object.entries(e).filter(([n,s])=>s.required).map(([n])=>n);return{properties:e,required:r}},"getJsonSchema");pa.exports={getJsonSchema:la}});var On=A((ey,da)=>{"use strict";var xe=null,Jp=i(t=>{xe=t.require("lodash")},"setDependencies"),ht={column_default:"default",is_nullable:{keyword:"required",values:{YES:!1,NO:!0}},not_null:"required",data_type:"type",numeric_precision:"precision",numeric_scale:"scale",datetime_precision:"timePrecision",attribute_mode:{keyword:"timePrecision",check:(t,e)=>e!==-1&&om(t.data_type)},interval_type:"intervalOptions",collation_name:"collationRule",column_name:"name",number_of_array_dimensions:"numberOfArrayDimensions",udt_name:"udt_name",character_maximum_length:"length",description:"description",domain_name:"domain_name"},Zp=i((t,e,r)=>{var n;return(n=ht[e])!=null&&n.check?ht[e].check(t,r)?r:"":xe.get(ht,`${e}.values.${r}`,r)},"getColumnValue"),em=i(t=>e=>xe.chain(e).toPairs().map(([r,n])=>{var s;return[((s=ht[r])==null?void 0:s.keyword)||ht[r],Zp(e,r,n)]}).filter(([r,n])=>r&&!xe.isNil(n)).fromPairs().thru(tm(t)).value(),"mapColumnData"),tm=i(t=>e=>({...e,...rm(t,e)}),"setColumnType"),rm=i((t,e)=>e.type==="ARRAY"?nm(t,e):e.type==="USER-DEFINED"?Ft(t,e.udt_name):e.domain_name?Ft(t,e.domain_name):Ft(t,e.type),"getType"),nm=i((t,e)=>({...Ft(t,e.udt_name.slice(1)),array_type:xe.fill(Array(e.numberOfArrayDimensions),"")}),"getArrayType"),Ft=i((t,e)=>{switch(e){case"bigint":case"bigserial":case"smallint":case"integer":case"numeric":case"real":case"double precision":case"smallserial":case"serial":case"money":return{type:"numeric",mode:e};case"int8":return{type:"numeric",mode:"bigint"};case"int2":return{type:"numeric",mode:"smallint"};case"int4":return{type:"numeric",mode:"integer"};case"float4":return{type:"numeric",mode:"real"};case"float8":return{type:"numeric",mode:"double precision"};case"bit":case"char":case"text":case"tsvector":case"tsquery":return{type:"char",mode:e};case"bit varying":return{type:"char",mode:"varbit"};case"character":return{type:"char",mode:"char"};case"character varying":return{type:"char",mode:"varchar"};case"bpchar":return{type:"char",mode:"char"};case"point":case"line":case"lseg":case"box":case"path":case"polygon":case"circle":case"box2d":case"box3d":case"geometry":case"geometry_dump":case"geography":return{type:"geometry",mode:e};case"bytea":return{type:"binary",mode:e};case"inet":case"cidr":case"macaddr":case"macaddr8":return{type:"inet",mode:e};case"date":case"time":case"timestamp":case"interval":return{type:"datetime",mode:e};case"timestamptz":case"timestamp with time zone":return{type:"datetime",mode:"timestamp",timezone:"WITH TIME ZONE"};case"timestamp without time zone":return{type:"datetime",mode:"timestamp",timezone:"WITHOUT TIME ZONE"};case"timetz":case"time with time zone":return{type:"datetime",mode:"time",timezone:"WITH TIME ZONE"};case"time without time zone":return{type:"datetime",mode:"time",timezone:"WITHOUT TIME ZONE"};case"json":case"jsonb":return{type:"json",mode:e,subtype:"object"};case"int4range":case"int8range":case"numrange":case"daterange":case"tsrange":case"tstzrange":return{type:"range",mode:e};case"int4multirange":case"int8multirange":case"nummultirange":case"tsmultirange":case"tstzmultirange":case"datemultirange":return{type:"multirange",mode:e};case"uuid":case"xml":case"boolean":return{type:e};case"bool":return{type:"boolean"};case"oid":case"regclass":case"regcollation":case"regconfig":case"regdictionary":case"regnamespace":case"regoper":case"regoperator":case"regproc":case"regprocedure":case"regrole":case"regtype":return{type:"oid",mode:e};default:return xe.some(t,{name:e})?{$ref:`#/definitions/${e}`}:{type:"char",mode:"varchar"}}},"mapType"),sm=i((t,e)=>{let r=xe.first(e)||{};return t.map(n=>{if(n.type!=="json")return n;let s=r[n.name],a=im(s),o=am(a);return{...n,subtype:o}})},"setSubtypeFromSampledJsonValues"),im=i(t=>{try{return JSON.parse(t)}catch{return{}}},"safeParse"),am=i(t=>{if(Array.isArray(t))return"array";let e=typeof t;return e==="undefined"?"object":e},"getParsedJsonValueType"),om=i(t=>xe.includes(["timestamp with time zone","timestamp without time zone","time with time zone","time without time zone"],t),"canHaveTimePrecision");da.exports={setDependencies:Jp,mapColumnData:em,setSubtypeFromSampledJsonValues:sm}});var gt=A((ry,fa)=>{"use strict";var cm=["ALL","ANALYSE","ANALYZE","AND","ANY","ARRAY","ASC","ASYMMETRIC","AUTHORIZATION","BINARY","BOTH","CASE","CAST","CHECK","COLLATE","COLUMN","CONCURRENTLY","CONSTRAINT","CREATE","CROSS","CURRENT_CATALOG","CURRENT_DATE","CURRENT_ROLE","CURRENT_SCHEMA","CURRENT_TIME","CURRENT_TIMESTAMP","CURRENT_USER","DEFAULT","DEFERRABLE","DESC","DISTINCT","DO","ELSE","END","EXCEPT","FALSE","FOR","FOREIGN","FREEZE","FROM","FULL","GRANT","GROUP","HAVING","ILIKE","IN","INITIALLY","INTERSECT","INTO","IS","ISNULL","JOIN","LATERAL","LEADING","LEFT","LIKE","LIMIT","LOCALTIME","LOCALTIMESTAMP","NATURAL","NOT","NULL","OFFSET","ON","ONLY","OR","ORDER","OUTER","OVERLAPS","PLACING","PRIMARY","REFERENCES","RETURNING","RIGHT","SELECT","SESSION_USER","SIMILAR","SOME","SYMMETRIC","TABLE","TABLESAMPLE","THEN","TO","TRAILING","TRUE","UNION","UNIQUE","USER","USING","VARIADIC","VERBOSE","WHEN","WHERE","WINDOW","WITH"],Je=null,um=i(t=>{Je=t.require("lodash")},"setDependencies"),lm=i(t=>Je.chain(t).toPairs().reject(([e,r])=>Je.isNil(r)).fromPairs().value(),"clearEmptyPropertiesInObject"),pm=i(t=>e=>{var r;return(r=Je.find(t,{ordinal_position:e}))==null?void 0:r.column_name},"getColumnNameByPosition"),mm=i(t=>/\s|\W/.test(t)||Je.includes(cm,Je.toUpper(t))?`"${t}"`:t,"wrapInQuotes");fa.exports={clearEmptyPropertiesInObject:lm,setDependencies:um,getColumnNameByPosition:pm,wrapInQuotes:mm}});var _a=A((sy,ga)=>{"use strict";var{getColumnNameByPosition:dm}=gt(),In=null,fm=i(t=>{In=t.require("lodash")},"setDependencies"),ha=i(t=>{switch(t){case"a":return"NO ACTION";case"r":return"RESTRICT";case"c":return"CASCADE";case"n":return"SET NULL";case"d":return"SET DEFAULT";default:return""}},"prepareDeleteAndUpdate"),hm=i(t=>{switch(t){case"f":return"FULL";case"s":return"SIMPLE";case"p":return"PARTIAL";default:return""}},"prepareMatch"),gm=i((t,e,r,n)=>In.map(t,s=>({relationshipName:s.relationship_name,dbName:s.foreign_table_schema,parentCollection:s.foreign_table_name,parentField:s.foreign_columns,childDbName:r,childCollection:e,childField:In.map(s.table_columns_positions,dm(n)),relationshipType:"Foreign Key",relationshipInfo:{relationshipOnDelete:ha(s.relationship_on_delete),relationshipOnUpdate:ha(s.relationship_on_update),relationshipMatch:hm(s.relationship_match)}})),"prepareForeignKeys");ga.exports={setDependencies:fm,prepareForeignKeys:gm}});var Ta=A((ay,Ea)=>{"use strict";var kt=null,_m=i(t=>{kt=t.require("lodash")},"setDependencies"),ya=i(t=>kt.map(t,e=>({argumentMode:e.parameter_mode,argumentName:e.parameter_name,argumentType:ym(e.data_type,e.udt_name),defaultExpression:e.parameter_default})),"mapFunctionArgs"),ym=i((t,e)=>t==="USER-DEFINED"?e:t==="ARRAY"?e.slice(1)+"[]":t,"getArgType"),Em=i(t=>{switch(t){case"i":return"IMMUTABLE";case"s":return"STABLE";case"v":default:return"VOLATILE"}},"getVolatility"),Tm=i(t=>{switch(t){case"s":return"SAFE";case"r":return"RESTICTED";case"u":return"UNSAFE";default:return""}},"getParallel"),Sm=i(t=>t?"STRICT":"CALLED ON NULL INPUT","getNullArgs"),Am=i((t,e,r)=>({name:t.name,functionDescription:r==null?void 0:r.description,functionArguments:ya(e),functionReturnsSetOf:r==null?void 0:r.returns_set,functionReturnType:t.return_data_type,functionLanguage:kt.toLower(t.external_language),functionBody:t.routine_definition??(r==null?void 0:r.body),functionWindow:(r==null?void 0:r.kind)==="w",functionVolatility:Em(r==null?void 0:r.volatility),functionLeakProof:r==null?void 0:r.leak_proof,functionNullArgs:Sm(r==null?void 0:r.strict),functionSqlSecurity:t.security_type,functionParallel:Tm(t.parallel),functionExecutionCost:t.estimated_cost,functionExecutionRows:t.estimated_rows}),"mapFunctionData"),Cm=i((t,e,r)=>({name:t.name,description:r==null?void 0:r.description,language:kt.toLower(t.external_language),inputArgs:ya(e),body:t.routine_definition}),"mapProcedureData");Ea.exports={setDependencies:_m,mapFunctionData:Am,mapProcedureData:Cm}});var ba=A((cy,Na)=>{"use strict";var{clearEmptyPropertiesInObject:_t,getColumnNameByPosition:$t}=gt(),G=null,Nm=i(t=>{G=t.require("lodash")},"setDependencies"),Aa=i((t,e)=>{if(!t&&!e)return null;let r=Sa(t),n=Sa(e==null?void 0:e.toast_options),s=r.fillfactor,a=r.parallel_workers,o=r.autovacuum_enabled,c=_t({vacuum_index_cleanup:r.vacuum_index_cleanup,vacuum_truncate:r.vacuum_truncate,autovacuum_vacuum_threshold:r.autovacuum_vacuum_threshold,autovacuum_vacuum_scale_factor:r.autovacuum_vacuum_scale_factor,autovacuum_vacuum_insert_threshold:r.autovacuum_vacuum_insert_threshold,autovacuum_vacuum_insert_scale_factor:r.autovacuum_vacuum_insert_scale_factor,autovacuum_analyze_threshold:r.autovacuum_analyze_threshold,autovacuum_analyze_scale_factor:r.autovacuum_analyze_scale_factor,autovacuum_vacuum_cost_delay:r.autovacuum_vacuum_cost_delay,autovacuum_vacuum_cost_limit:r.autovacuum_vacuum_cost_limit,autovacuum_freeze_min_age:r.autovacuum_freeze_min_age,autovacuum_freeze_max_age:r.autovacuum_freeze_max_age,autovacuum_freeze_table_age:r.autovacuum_freeze_table_age,autovacuum_multixact_freeze_min_age:r.autovacuum_multixact_freeze_min_age,autovacuum_multixact_freeze_max_age:r.autovacuum_multixact_freeze_max_age,autovacuum_multixact_freeze_table_age:r.autovacuum_multixact_freeze_table_age,log_autovacuum_min_duration:r.log_autovacuum_min_duration}),u=r.user_catalog_table,l=n.autovacuum_enabled,m=_t({toast_tuple_target:r.toast_tuple_target,toast_vacuum_index_cleanup:n.vacuum_index_cleanup,toast_vacuum_truncate:n.vacuum_truncate,toast_autovacuum_vacuum_threshold:n.autovacuum_vacuum_threshold,toast_autovacuum_vacuum_scale_factor:n.autovacuum_vacuum_scale_factor,toast_autovacuum_vacuum_insert_threshold:n.autovacuum_vacuum_insert_threshold,toast_autovacuum_vacuum_insert_scale_factor:n.autovacuum_vacuum_insert_scale_factor,toast_autovacuum_vacuum_cost_delay:n.autovacuum_vacuum_cost_delay,toast_autovacuum_vacuum_cost_limit:n.autovacuum_vacuum_cost_limit,toast_autovacuum_freeze_min_age:n.autovacuum_freeze_min_age,toast_autovacuum_freeze_max_age:n.autovacuum_freeze_max_age,toast_autovacuum_freeze_table_age:n.autovacuum_freeze_table_age,toast_autovacuum_multixact_freeze_min_age:n.autovacuum_multixact_freeze_min_age,toast_autovacuum_multixact_freeze_max_age:n.autovacuum_multixact_freeze_max_age,toast_autovacuum_multixact_freeze_table_age:n.autovacuum_multixact_freeze_table_age,toast_log_autovacuum_min_duration:n.log_autovacuum_min_duration}),p={fillfactor:s,parallel_workers:a,autovacuum_enabled:o,autovacuum:G.isEmpty(c)?null:c,toast_autovacuum_enabled:l,toast:G.isEmpty(m)?null:m,user_catalog_table:u};return _t(p)},"prepareStorageParameters"),bm=i((t,e)=>{if(!t)return null;let r=vm(t),n=G.some(t.partition_attributes_positions,o=>o===0),s=n?"partitioning_expression":"compositePartitionKey",a=n?Om(t,e):G.map(t.partition_attributes_positions,$t(e));return[{partitionMethod:r,partitionBy:n?"expression":"keys",[s]:a}]},"prepareTablePartition"),vm=i(t=>{switch(t.partition_method){case"h":return"HASH";case"l":return"LIST";case"r":return"RANGE";default:return""}},"getPartitionMethod"),Om=i((t,e)=>{let r=0,n=G.split(t.expressions,",");return G.chain(t.partition_attributes_positions).map(s=>{if(s===0){let a=n[r];return r++,a}return $t(e)(s)}).join(",").value()},"getPartitionExpression"),Ca=i(t=>G.split(t,"="),"splitByEqualitySymbol"),Im=i(t=>G.find(t,{type:"json"}),"checkHaveJsonTypes"),Rm=i((t,e)=>{if(e.active==="absolute")return Number(e.absolute.value);let r=Math.ceil(t*e.relative.value/100);return Math.min(r,e.maxValue)},"getSampleDocSize"),wm=i((t,e)=>G.reduce(t,(r,n)=>{switch(n.constraint_type){case"c":return{...r,chkConstr:[...r.chkConstr,Lm(n)]};case"p":return{...r,primaryKey:[...r.primaryKey,Pm(n,e)]};case"u":return{...r,uniqueKey:[...r.uniqueKey,Dm(n,e)]};default:return r}},{chkConstr:[],uniqueKey:[],primaryKey:[]}),"prepareTableConstraints"),Pm=i((t,e)=>({constraintName:t.constraint_name,compositePrimaryKey:G.map(t.constraint_keys,$t(e)),indexStorageParameters:G.join(t.storage_parameters,","),indexTablespace:t.tablespace}),"getPrimaryKeyConstraint"),Dm=i((t,e)=>({constraintName:t.constraint_name,compositeUniqueKey:G.map(t.constraint_keys,$t(e)),indexStorageParameters:G.join(t.storage_parameters,","),indexTablespace:t.tablespace,indexComment:t.description}),"getUniqueKeyConstraint"),Lm=i(t=>({chkConstrName:t.constraint_name,constrExpression:t.expression,noInherit:t.no_inherit,constrDescription:t.description}),"getCheckConstraint"),xm=i(t=>G.map(t,e=>{let r=Mm(e),n=G.slice(r,0,e.number_of_keys),s=G.chain(r).slice(e.number_of_keys).map(o=>G.pick(o,"name")).value(),a={indxName:e.indexname,index_method:e.index_method,unique:e.index_unique??!1,index_tablespace_name:e.tablespace_name||"",index_storage_parameter:Fm(e.storage_parameters),where:e.where_expression||"",include:s,columns:e.index_method==="btree"?n:G.map(n,o=>G.omit(o,"sortOrder","nullsOrder"))};return _t(a)}),"prepareTableIndexes"),Mm=i(t=>G.chain(t.columns).map((e,r)=>{if(!e)return;let n=G.get(t,`ascendings.${r}`,!1)?"ASC":"DESC",s=qm(G.get(t,`nulls_first.${r}`)),a=G.get(t,`opclasses.${r}`,""),o=G.get(t,`collations.${r}`,"");return{name:e,sortOrder:n,nullsOrder:s,opclass:a,collation:o}}).compact().value(),"mapIndexColumns"),qm=i(t=>G.isNil(t)?"":t?"NULLS FIRST":"NULLS LAST","getNullsOrder"),Fm=i(t=>{if(!t)return null;let e=G.fromPairs(G.map(t,n=>Ca(n))),r={index_fillfactor:e.fillfactor,deduplicate_items:e.deduplicate_items,index_buffering:e.index_buffering,fastupdate:e.fastupdate,gin_pending_list_limit:e.gin_pending_list_limit,pages_per_range:e.pages_per_range,autosummarize:e.autosummarize};return _t(r)},"getIndexStorageParameters"),km=i((t,e)=>{let r=(t==null?void 0:t.relpersistence)==="t",n=(t==null?void 0:t.relpersistence)==="u",s=Aa(t==null?void 0:t.reloptions,e),a=t==null?void 0:t.spcname,o=t.partition_expr;return{temporary:r,unlogged:n,storage_parameter:s,table_tablespace_name:a,partitionBounds:o}},"prepareTableLevelData"),$m=i(t=>{switch(Bm(t)){case"number":case"boolean":return JSON.parse(t);case"string":default:return t}},"convertValueToType"),Bm=i(t=>{try{let e=typeof JSON.parse(t);return e==="object"?"string":e}catch{return"string"}},"getTypeOfValue"),Sa=i(t=>G.chain(t).map(Ca).map(([e,r])=>[e,$m(r)]).fromPairs().value()||{},"prepareOptions"),Um=i((t,e)=>G.map(e,({parent_table_name:r})=>({parentTable:[t,r]})),"prepareTableInheritance");Na.exports={prepareStorageParameters:Aa,prepareTablePartition:bm,setDependencies:Nm,checkHaveJsonTypes:Im,prepareTableConstraints:wm,prepareTableLevelData:km,prepareTableIndexes:xm,getSampleDocSize:Rm,prepareTableInheritance:Um}});var Oa=A((ly,va)=>{"use strict";var{mapColumnData:Km}=On(),Te=null,Gm=i(t=>{Te=t.require("lodash")},"setDependencies"),Vm=i((t,e)=>Te.chain(t).map(r=>{switch(r.type){case"e":return Hm(r);case"r":return Qm(r);case"c":return Ym(r);default:return null}}).compact().concat(Te.map(e,jm)).value(),"getUserDefinedTypes"),Hm=i(t=>({name:t.name,type:"enum",enum:t.enum_values||[]}),"getEnumType"),Qm=i(t=>({name:t.name,type:"range_udt",rangeSubtype:t.range_subtype||"",operatorClass:t.range_opclass_name||"",collation:t.range_collation_name||"",canonicalFunction:t.range_canonical_proc||"",subtypeDiffFunction:t.range_diff_proc||""}),"getRangeType"),Ym=i(t=>{let e=Te.map(t.columns,Km([]));return{name:t.name,type:"composite",properties:e}},"getCompositeType"),Wm=i(t=>t.type==="c","isTypeComposite"),jm=i(t=>{var e;return{name:t.domain_name,type:"domain",underlyingType:Te.flow(Xm(t),Jm(t),Zm(t),ed(t))(zm(t)),collation:t.collation_name||"",default:t.domain_default||"",required:(e=Te.first(t.constraints))==null?void 0:e.not_null,checkConstraints:Te.map(t.constraints,td)}},"mapDomainType"),zm=i(t=>t.data_type==="USER-DEFINED"?t.udt_name:t.data_type,"getUnderlyingType"),Xm=i(t=>e=>t.character_maximum_length?`${e}(${t.character_maximum_length})`:e,"setLength"),Jm=i(t=>e=>e!=="numeric"?e:Te.isNumber(t.numeric_precision)&&Te.isNumber(t.numeric_scale)?`${e}(${t.numeric_precision},${t.numeric_scale})`:Te.isNumber(t.numeric_precision)?`${e}(${t.numeric_precision})`:e,"setPrecisionAndScale"),Zm=i(t=>e=>t.interval_type?`${e} ${t.interval_type}`:e,"setIntervalType"),ed=i(t=>e=>Te.isNumber(t.interval_precision)?`${e}(${t.interval_precision})`:e,"setIntervalPrecision"),td=i(t=>({name:t.constraint_name,expression:t.expression}),"mapDomainConstraint");va.exports={setDependencies:Gm,getUserDefinedTypes:Vm,isTypeComposite:Wm}});var Ra=A((my,Ia)=>{"use strict";var{clearEmptyPropertiesInObject:rd,wrapInQuotes:nd}=gt(),Re=null,sd=i(t=>{Re=t.require("lodash")},"setDependencies"),Rn=" (v)",id=i(t=>t==="VIEW","isViewByTableType"),ad=i(t=>Re.endsWith(t,Rn),"isViewByName"),od=i(t=>t.slice(0,-Rn.length),"removeViewNameSuffix"),cd=i(t=>`${t}${Rn}`,"setViewSuffix"),ud=i((t,e,r={})=>{let n=Re.trim((e==null?void 0:e.view_definition)||r.definition||"");return n?`CREATE VIEW ${nd(t)} AS ${n}`:""},"generateCreateViewScript"),ld=i((t,e,r)=>{let n={withCheckOption:(t==null?void 0:t.check_option)!=="NONE"||Re.isNil(t==null?void 0:t.check_option),checkTestingScope:pd(t==null?void 0:t.check_option),viewOptions:Re.fromPairs(Re.map(e==null?void 0:e.view_options,dd)),temporary:(e==null?void 0:e.persistence)==="t",recursive:md(t),description:e==null?void 0:e.description,triggers:r};return rd(n)},"prepareViewData"),pd=i(t=>t==="NONE"?"":t,"getCheckTestingScope"),md=i(t=>Re.startsWith(Re.trim(t==null?void 0:t.view_definition),"WITH RECURSIVE"),"isViewRecursive"),dd=i(t=>Re.split(t,"="),"splitByEqualitySymbol");Ia.exports={setDependencies:sd,isViewByTableType:id,isViewByName:ad,removeViewNameSuffix:od,generateCreateViewScript:ud,setViewSuffix:cd,prepareViewData:ld}});var Pa=A((fy,wa)=>{"use strict";var Bt=null,fd=i(t=>{Bt=t.require("lodash")},"setDependencies"),hd=i((t,e)=>Bt.chain(t).map(r=>({...r,...Bt.find(e,{trigger_name:r.trigger_name})||{}})).map(gd).value(),"getTriggers"),gd=i(t=>{var e;return{name:t.trigger_name,triggerDescription:t.description,triggerConstraint:t.constraint,triggerTable:`${t.event_object_schema}.${t.event_object_table}`,triggerReferencedTable:t.referenced_table_name?[t.referenced_table_schema,t.referenced_table_name]:[],triggerType:t.action_timing,triggerEvents:_d(t),triggerUpdateColumns:(e=t.update_attributes)==null?void 0:e.filter(Boolean),triggerDeferrable:t.deferrable,triggerTimeConstraintCheck:t.deferred?"INITIALLY DEFERRED":"INITIALLY IMMEDIATE",triggerReferencing:!!t.action_reference_old_table||!!t.action_reference_new_table,triggerBeforeImageTransitionRelation:t.action_reference_old_table||"",triggerAfterImageTransitionRelation:t.action_reference_new_table||"",triggerEachRowStatement:t.action_orientation==="ROW"?"FOR EACH ROW":"FOR EACH STATEMENT",triggerCondition:t.action_condition,triggerFunction:yd(t.action_statement)}},"getTrigger"),_d=i(t=>Bt.map(t.trigger_events,e=>({triggerEvent:e})),"getTriggerEvents"),yd=i(t=>{var e,r,n;return((n=(r=(e=/EXECUTE (?:FUNCTION|PROCEDURE)(?<function>[\s\S]*)/.exec(t))==null?void 0:e.groups)==null?void 0:r.function)==null?void 0:n.trim())||""},"getFunctionFromTrigger");wa.exports={setDependencies:fd,getTriggers:hd}});var xa=A((gy,La)=>{"use strict";var Ed=i((t,e)=>[Td,Sd].reduce(({attributes:r,entityLevel:n},s)=>s(r,n),{attributes:t,entityLevel:e}),"reorganizeConstraints"),Td=i((t,e)=>{var a,o,c;if(((c=(o=(a=e.primaryKey)==null?void 0:a[0])==null?void 0:o.compositePrimaryKey)==null?void 0:c.length)!==1)return{attributes:t,entityLevel:e};let n=e.primaryKey[0],s=n.compositePrimaryKey[0];return{attributes:Ad(t,s,n),entityLevel:vd(e)}},"reorganizePrimaryKeys"),Sd=i((t,e)=>(e.uniqueKey||[]).reduce(({attributes:r,entityLevel:n},s)=>{if(!(s.compositeUniqueKey.length===1))return{attributes:r,entityLevel:n};let o=s.compositeUniqueKey[0];return{attributes:Nd(r,o,s),entityLevel:Od(n,s)}},{attributes:t,entityLevel:e}),"reorganizeUniqueKeys"),Ad=i((t,e,r)=>t.map(n=>n.name!==e?n:Cd(n,r)),"setAttributesPrimaryKeyData"),Cd=i((t,e)=>({...t,primaryKey:!0,primaryKeyOptions:Da(e)}),"setPrimaryKeyData"),Nd=i((t,e,r)=>t.map(n=>n.name!==e?n:bd(n,r)),"setAttributesUniqueKeyData"),bd=i((t,e)=>({...t,unique:!0,uniqueKeyOptions:Da(e)}),"setUniqueKeyData"),Da=i(t=>[{constraintName:t.constraintName,indexInclude:t.indexInclude,indexStorageParameters:t.indexStorageParameters,indexTablespace:t.indexTablespace,indexComment:t.indexComment}],"getOptions"),vd=i(t=>({...t,primaryKey:[]}),"clearPrimaryKeys"),Od=i((t,e)=>{let r=t.uniqueKey.filter(n=>n.constraintName!==e.constraintName);return{...t,uniqueKey:r}},"filterUniqueKeys");La.exports={reorganizeConstraints:Ed}});var Dn=A((Ey,ka)=>{"use strict";var{createClient:Id}=na(),q=ua(),{getJsonSchema:Ma}=ma(),{setDependencies:Rd,mapColumnData:wd,setSubtypeFromSampledJsonValues:Pd}=On(),{setDependencies:Dd,clearEmptyPropertiesInObject:qa}=gt(),{setDependencies:Ld,prepareForeignKeys:xd}=_a(),{setDependencies:Md,mapFunctionData:qd,mapProcedureData:Fd}=Ta(),{setDependencies:kd,prepareTablePartition:$d,checkHaveJsonTypes:Bd,prepareTableConstraints:Ud,getSampleDocSize:Kd,prepareTableLevelData:Gd,prepareTableIndexes:Vd,prepareTableInheritance:yy}=ba(),{setDependencies:Hd,getUserDefinedTypes:Qd,isTypeComposite:Yd}=Oa(),{setDependencies:Wd,isViewByTableType:jd,isViewByName:zd,removeViewNameSuffix:Xd,generateCreateViewScript:Jd,setViewSuffix:Zd,prepareViewData:ef}=Ra(),{setDependencies:tf,getTriggers:Fa}=Pa(),k=vn(),{reorganizeConstraints:rf}=xa(),wn=!1,X=null,be=null,Pn=14;ka.exports={setDependencies(t){X=t.require("lodash"),Dd(t),kd(t),Rd(t),Ld(t),Wd(t),Md(t),Hd(t),tf(t)},async connect(t,e,r){q.isClientInitialized()&&await this.disconnect(e);let{client:n,iSshTunnel:s}=await Id(t,e,r);q.initializeClient(n,r),wn=s,be=r,Pn=await this._getServerVersion()},async disconnect(t){wn&&(await t.closeConsumer(),wn=!1),await q.releaseClient()},pingDb(){return q.query(k.PING)},applyScript(t){return q.query(t)},async getDatabaseNames(){return X.map(await q.query(k.GET_DATABASES),"database_name")},async logVersion(){let t=await q.queryTolerant(k.GET_VERSION,[],!0),e=(t==null?void 0:t.version)||"Version not retrieved";be.info(`YugabyteDB version: ${e}`)},async getAllSchemasNames(){return(await q.query(k.GET_SCHEMA_NAMES)).map(({schema_name:e})=>e).filter(e=>!nf(e))},async getTablesNames(t){let e=await q.query(k.GET_TABLE_NAMES,[t]),r=["FOREIGN TABLE"];return e.filter(({table_type:n})=>!X.includes(r,n)).map(({table_name:n,table_type:s})=>jd(s)?Zd(n):n)},async getDbLevelData(){var n,s,a;be.progress("Get database data");let t=(n=await q.queryTolerant(k.GET_DB_NAME,[],!0))==null?void 0:n.current_database,e=(s=await q.queryTolerant(k.GET_DB_ENCODING,[],!0))==null?void 0:s.server_encoding,r=(a=await q.queryTolerant(k.GET_DB_COLLATE_NAME,[],!0))==null?void 0:a.default_collate_name;return qa({database_name:t,encoding:e,LC_COLLATE:r,LC_CTYPE:r})},async retrieveEntitiesData(t,e,r,n=!1){let s=await this._retrieveUserDefinedTypes(t),a=await q.queryTolerant(k.GET_NAMESPACE_OID,[t],!0),o=a==null?void 0:a.oid,c=n?await q.queryTolerant(k.GET_PARTITIONS,[o]):[],[u,l]=X.partition(e,zd),m=l.flatMap(f=>[{tableName:f},...X.filter(c,{parent_name:f}).map(({child_name:y,is_parent_partitioned:g})=>({isParentPartitioned:g,tableName:y}))]),p=await Ze(X.uniq(m),X.bind(this._retrieveSingleTableData,this,r,o,t,s));return{views:await Ze(u,X.bind(this._retrieveSingleViewData,this,o,t)),tables:p,modelDefinitions:Ma(s)}},async retrieveSchemaLevelData(t){var u;be.progress("Get Functions and Procedures",t);let e=(u=await q.queryTolerant(k.GET_NAMESPACE_OID,[t],!0))==null?void 0:u.oid,r=await q.queryTolerant(k.GET_FUNCTIONS_WITH_PROCEDURES,[t]),n=await q.queryTolerant(af(Pn),[e]),[s,a]=X.partition(X.filter(r,"routine_type"),{routine_type:"FUNCTION"}),o=await Ze(s,async l=>{let m=await q.queryTolerant(k.GET_FUNCTIONS_WITH_PROCEDURES_ARGS,[l.specific_name]),p=X.find(n,{function_name:l.name});return qd(l,m,p)}),c=await Ze(a,async l=>{let m=await q.queryTolerant(k.GET_FUNCTIONS_WITH_PROCEDURES_ARGS,[l.specific_name]),p=X.find(n,{function_name:l.name});return Fd(l,m,p)});return{functions:o,procedures:c}},async _retrieveUserDefinedTypes(t){be.progress("Get User-Defined Types",t);let e=await q.queryTolerant(k.GET_USER_DEFINED_TYPES,[t]),r=await q.queryTolerant(k.GET_DOMAIN_TYPES,[t]),n=await Ze(e,async a=>Yd(a)?{...a,columns:await q.queryTolerant(k.GET_COMPOSITE_TYPE_COLUMNS,[a.pg_class_oid])}:a),s=await Ze(r,async a=>({...a,constraints:await q.queryTolerant(k.GET_DOMAIN_TYPES_CONSTRAINTS,[a.domain_name,t])}));return Qd(n,s)},async _retrieveSingleTableData(t,e,r,n,{tableName:s,isParentPartitioned:a}){be.progress("Get table data",r,s);let o=await q.queryTolerant(k.GET_TABLE_LEVEL_DATA,[s,e],!0),c=o==null?void 0:o.oid,u=await q.queryTolerant(k.GET_TABLE_TOAST_OPTIONS,[s,e],!0),l=await q.queryTolerant(k.GET_TABLE_PARTITION_DATA,[c],!0),m=await this._getTableColumns(s,r,c),p=await q.queryTolerant(k.GET_DESCRIPTION_BY_OID,[c],!0),d=await q.queryTolerant(k.GET_TABLE_CONSTRAINTS,[c]),f=await q.queryTolerant(sf(Pn),[c]),y=await q.queryTolerant(k.GET_TABLE_FOREIGN_KEYS,[c]),g=await q.queryTolerant(k.GET_TRIGGERS,[r,s]),E=await q.queryTolerant(k.GET_TRIGGERS_ADDITIONAL_DATA,[e,c]),_=$d(l,m),b=Gd(o,u),C=of(p),P=Ud(d,m),x=Vd(f),$=xd(y,s,r,m),U=Fa(g,E),V={partitioning:_,description:C,triggers:U,Indxs:x,...b,...P},v=qa(V),O=m.map(wd(n)),F=Bd(O),K=[];F&&(K=await this._getDocuments(r,s,O,t),O=Pd(O,K));let{attributes:Me,entityLevel:qe}=rf(O,v);return{name:s,entityLevel:qe,jsonSchema:Ma(Me),documents:K,relationships:$}},async _getTableColumns(t,e,r){be.progress("Get columns",e,t);let n=await q.query(k.GET_TABLE_COLUMNS,[t,e]),s=await q.queryTolerant(k.GET_TABLE_COLUMNS_ADDITIONAL_DATA,[r]);return X.map(n,(a,o)=>({...a,...X.find(s,{name:a.column_name})||{}}))},async _getDocuments(t,e,r,n){var u;be.progress("Sampling table",t,e);let s=`${t}.${e}`,a=((u=await q.queryTolerant(k.GET_ROWS_COUNT(s),[],!0))==null?void 0:u.quantity)||0,o=Kd(a,n),c=X.chain(r).filter(({type:l})=>X.includes(["json","jsonb"],l)).map("name").join(", ").value();return await q.queryTolerant(k.GET_SAMPLED_DATA(s,c),[o])},async _retrieveSingleViewData(t,e,r){be.progress("Get view data",e,r),r=Xd(r);let n=await q.query(k.GET_VIEW_DATA,[r,e],!0),s=!(n!=null&&n.view_definition)&&await q.queryTolerant(k.GET_VIEW_SELECT_STMT_FALLBACK,[r,e],!0),a=await q.queryTolerant(k.GET_VIEW_OPTIONS,[r,t],!0),o=await q.queryTolerant(k.GET_TRIGGERS,[e,r]),c=await q.queryTolerant(k.GET_TRIGGERS_ADDITIONAL_DATA,[t,a==null?void 0:a.oid]),u=Fa(o,c),l=Jd(r,n,s),m=ef(n,a,u);return l?{name:r,data:m,ddl:{script:l,type:"postgres"}}:(be.info("View select statement was not retrieved",{schemaName:e,viewName:r}),{name:r,data:m,jsonSchema:{properties:[]}})},async _getServerVersion(){let t=await q.queryTolerant(k.GET_VERSION_AS_NUM,[],!0),e=X.toNumber(t==null?void 0:t.server_version_num);return e>=1e5&&e<11e4?10:e>=11e4&&e<12e4?11:e>=12e4&&e<13e4?12:e>=13e4&&e<14e4?13:(e>=14e4&&e<15e4,14)}};var nf=i(t=>!!(X.startsWith(t,"pg_")||X.includes(["information_schema"],t)),"isSystemSchema"),sf=i(t=>t===10?k.GET_TABLE_INDEXES_V_10:k.GET_TABLE_INDEXES,"getGetIndexesQuery"),af=i(t=>t===10?k.GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL_V_10:k.GET_FUNCTIONS_WITH_PROCEDURES_ADDITIONAL,"getGetFunctionsAdditionalDataQuery"),of=i(t=>t==null?void 0:t.obj_description,"getDescriptionFromResult"),Ze=i((t,e)=>Promise.all(X.map(t,e)),"mapPromises")});var Ba=A((Sy,$a)=>{"use strict";var{createLogger:Ut}=jt(),J=Dn();$a.exports={async disconnect(t,e,r,n){let s=n.require("@hackolade/ssh-service");await J.disconnect(s),r()},async testConnection(t,e,r,n){let s=n.require("@hackolade/ssh-service");try{Ln("Test connection",t,e);let a=Ut({title:"Test connection instance log",hiddenKeys:t.hiddenKeys,logger:e});J.setDependencies(n),await J.connect(t,s,a),await J.pingDb(),await J.logVersion(),r()}catch(a){e.log("error",Ue(a),"Test connection instance log"),r(Ue(a))}finally{await J.disconnect(s)}},async getDatabases(t,e,r,n){try{Ln("Get databases",t,e);let s=n.require("@hackolade/ssh-service"),a=Ut({title:"Get DB names",hiddenKeys:t.hiddenKeys,logger:e});J.setDependencies(n),await J.connect(t,s,a),await J.logVersion();let o=await J.getDatabaseNames();return e.log("info",o,"All databases list",t.hiddenKeys),r(null,o)}catch(s){return e.log("error",s),r(Ue(s))}},getDocumentKinds:function(t,e,r){r(null,[])},async getDbCollectionsNames(t,e,r,n){let s=n.require("@hackolade/ssh-service");try{Ln("Get DB table names",t,e);let a=Ut({title:"Get DB collections names",hiddenKeys:t.hiddenKeys,logger:e});J.setDependencies(n),await J.connect(t,s,a),await J.logVersion();let c=await(await J.getAllSchemasNames()).reduce(async(u,l)=>{let m=await u;try{let p=await J.getTablesNames(l);return m.concat({dbName:l,dbCollections:p,isEmpty:p.length===0})}catch(p){return a.info(`Error reading database "${l}"`),a.error(p),m.concat({dbName:l,dbCollections:[],isEmpty:!0,status:!0})}},Promise.resolve([]));r(null,c)}catch(a){e.log("error",Ue(a),"Get DB collections names"),r(Ue(a)),await J.disconnect(s)}},async getDbCollectionsData(t,e,r,n){let s=n.require("@hackolade/ssh-service");try{e.log("info",t,"Retrieve tables data:",t.hiddenKeys);let a=Ut({title:"Get DB collections data log",hiddenKeys:t.hiddenKeys,logger:e});a.progress("Start reverse engineering...");let o=t.collectionData.collections,c=t.collectionData.dataBaseNames,u=await J.getDbLevelData(),{packages:l,relationships:m}=await Promise.all(c.map(async p=>{let{tables:d,views:f,modelDefinitions:y}=await J.retrieveEntitiesData(p,o[p],t.recordSamplingSettings,t.includePartitions),{functions:g,procedures:E,triggers:_}=await J.retrieveSchemaLevelData(p);return a.progress("Schema reversed successfully",p),{schemaName:p,tables:d,views:f,functions:g,procedures:E,modelDefinitions:y,triggers:_}})).then(p=>{let d=p.flatMap(({tables:y})=>y.map(g=>g.relationships)).flat();return{packages:p.flatMap(({schemaName:y,tables:g,views:E,functions:_,procedures:b,triggers:C,modelDefinitions:P})=>{let x={UDFs:_,Procedures:b,triggers:C},$=g.map(U=>({dbName:y,collectionName:U.name,documents:U.documents,views:[],emptyBucket:!1,entityLevel:U.entityLevel,validation:{jsonSchema:U.jsonSchema},bucketInfo:x,modelDefinitions:P})).sort(U=>n.require("lodash").isEmpty([])?-1:1);if(E!=null&&E.length){let U={dbName:y,views:E,emptyBucket:!1};return[...$,U]}return $}),relationships:d}}).then(({packages:p,relationships:d})=>({packages:cf(p),relationships:d}));r(null,l,u,m)}catch(a){e.log("error",Ue(a),"Retrieve tables data"),r(Ue(a))}finally{await J.disconnect(s)}}};var Ue=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError"),Ln=i((t,e,r)=>{r.clear(),r.log("info",e,"connectionInfo",e.hiddenKeys)},"logInfo"),cf=i(t=>t.sort((e,r)=>!e.collectionName&&!r.collectionName?0:e.collectionName?r.collectionName?e.collectionName.localeCompare(r.collectionName):-1:1),"orderPackages")});var Ka=A((Cy,Ua)=>{"use strict";var Kt=Dn(),uf=i(async(t,e,r)=>{try{let n=r.require("@hackolade/ssh-service");Kt.setDependencies(r),await Kt.connect(t,n,e),await Kt.logVersion(),await Kt.applyScript(lf(t.script))}catch(n){throw e.error(n),pf(n)}},"applyToInstance"),lf=i(t=>{let e=/CREATE DATABASE[^;]*;/gi;return t.replace(e,"")},"removeCreateDbScript"),pf=i(t=>(t=JSON.stringify(t,Object.getOwnPropertyNames(t)),t=JSON.parse(t),t),"prepareError");Ua.exports={applyToInstance:uf}});var ae=A((by,Ga)=>{"use strict";var qn=class qn{script;isDropScript};i(qn,"ModificationScript");var xn=qn,Fn=class Fn{isActivated;scripts;static getInstances(e,r,n){return(e||[]).filter(Boolean).map(s=>({isActivated:r,scripts:[{isDropScript:n,script:s}]}))}static getInstance(e,r,n){var s;if((s=e==null?void 0:e.filter(Boolean))!=null&&s.length)return{isActivated:r,scripts:e.filter(Boolean).map(a=>({isDropScript:n,script:a}))}}static getDropAndRecreateInstance(e,r,n){let s=[];if(e&&s.push({isDropScript:!0,script:e}),r&&s.push({isDropScript:!1,script:r}),!!(s!=null&&s.length))return{isActivated:n,scripts:s}}};i(Fn,"AlterScriptDto");var Mn=Fn;Ga.exports={ModificationScript:xn,AlterScriptDto:Mn}});var Ha=A((Oy,Va)=>{"use strict";var mf=Object.freeze({ALL:"ALL",ANALYSE:"ANALYSE",ANALYZE:"ANALYZE",AND:"AND",ANY:"ANY",ARRAY:"ARRAY",ASC:"ASC",ASYMMETRIC:"ASYMMETRIC",AUTHORIZATION:"AUTHORIZATION",BINARY:"BINARY",BOTH:"BOTH",CASE:"CASE",CAST:"CAST",CHECK:"CHECK",COLLATE:"COLLATE",COLUMN:"COLUMN",CONCURRENTLY:"CONCURRENTLY",CONSTRAINT:"CONSTRAINT",CREATE:"CREATE",CROSS:"CROSS",CURRENT_CATALOG:"CURRENT_CATALOG",CURRENT_DATE:"CURRENT_DATE",CURRENT_ROLE:"CURRENT_ROLE",CURRENT_SCHEMA:"CURRENT_SCHEMA",CURRENT_TIME:"CURRENT_TIME",CURRENT_TIMESTAMP:"CURRENT_TIMESTAMP",CURRENT_USER:"CURRENT_USER",DEFAULT:"DEFAULT",DEFERRABLE:"DEFERRABLE",DESC:"DESC",DISTINCT:"DISTINCT",DO:"DO",ELSE:"ELSE",END:"END",EXCEPT:"EXCEPT",FALSE:"FALSE",FOR:"FOR",FOREIGN:"FOREIGN",FREEZE:"FREEZE",FROM:"FROM",FULL:"FULL",GRANT:"GRANT",GROUP:"GROUP",HAVING:"HAVING",ILIKE:"ILIKE",IN:"IN",INITIALLY:"INITIALLY",INTERSECT:"INTERSECT",INTO:"INTO",IS:"IS",ISNULL:"ISNULL",JOIN:"JOIN",LATERAL:"LATERAL",LEADING:"LEADING",LEFT:"LEFT",LIKE:"LIKE",LIMIT:"LIMIT",LOCALTIME:"LOCALTIME",LOCALTIMESTAMP:"LOCALTIMESTAMP",NATURAL:"NATURAL",NOT:"NOT",NULL:"NULL",OFFSET:"OFFSET",ON:"ON",ONLY:"ONLY",OR:"OR",ORDER:"ORDER",OUTER:"OUTER",OVERLAPS:"OVERLAPS",PLACING:"PLACING",PRIMARY:"PRIMARY",REFERENCES:"REFERENCES",RETURNING:"RETURNING",RIGHT:"RIGHT",SELECT:"SELECT",SESSION_USER:"SESSION_USER",SIMILAR:"SIMILAR",SOME:"SOME",SYMMETRIC:"SYMMETRIC",TABLE:"TABLE",TABLESAMPLE:"TABLESAMPLE",THEN:"THEN",TO:"TO",TRAILING:"TRAILING",TRUE:"TRUE",UNION:"UNION",UNIQUE:"UNIQUE",USER:"USER",USING:"USING",VARIADIC:"VARIADIC",VERBOSE:"VERBOSE",WHEN:"WHEN",WHERE:"WHERE",WINDOW:"WINDOW",WITH:"WITH"}),df=Object.values(mf);Va.exports={ReservedWordsAsArray:df}});var B=A((Iy,Qa)=>{"use strict";var{ReservedWordsAsArray:ff}=Ha(),hf=/\t|\n|'|\f|\r/gm;Qa.exports=t=>{let e=i(S=>t.get(S,"[0].code")||t.get(S,"[0].name",""),"getDbName"),r=i(S=>S&&(S.code||S.collectionName)||"","getEntityName"),n=i(S=>S&&(S.code||S.name)||"","getViewName"),s=i(S=>Object.assign({},t.get(S,"[0]",{}),{name:e(S)}),"getDbData"),a=i(S=>t.get(S,"[0].viewOn"),"getViewOn"),o=i(S=>Object.keys(S).reduce((I,M)=>{let H=S[M].filter(z=>{let Se=S[z.primaryTableId];return Array.isArray(Se)?!Se.some(de=>de.primaryTableId===M&&de.primaryTableId!==de.foreignTableId):!0});return t.isEmpty(H)?I:Object.assign({},I,{[M]:H})},{}),"rejectRecursiveRelationships"),c=i(S=>Object.keys(S).reduce((I,M)=>{let H=S[M].filter(z=>{let Se=S[z.primaryTableId];return Array.isArray(Se)?Se.some(de=>de.primaryTableId===M&&de.primaryTableId!==de.foreignTableId):!1});return I.concat(H)},[]),"filterRecursiveRelationships"),u=i((S,I="	")=>S.split(`
`).map(M=>I+M).join(`
`),"tab"),l=i((S,I)=>Object.keys(S).map(t.toLower).includes(t.toLower(I)),"hasType"),m=i(S=>Object.entries(S).filter(([I,M])=>!t.isNil(M)).reduce((I,[M,H])=>({...I,[M]:H}),{}),"clean"),p=i(S=>S.every(I=>t.get(I,"isActivated",!0)),"checkAllKeysActivated"),d=i(S=>S.length?S.every(I=>!t.get(I,"isActivated",!0)):!1,"checkAllKeysDeactivated"),f=i((S,I)=>{let M=S.filter(z=>t.get(z,"isActivated",!0)).map(I),H=S.filter(z=>!t.get(z,"isActivated",!0)).map(I);return{activatedItems:M,deactivatedItems:H}},"divideIntoActivatedAndDeactivated"),y=i((S,{isActivated:I,isPartOfLine:M,inlineComment:H="--"})=>S?I!==!1?S:M?"/* "+S+" */":S.includes(`
`)?`/*
`+S+` */
`:H+" "+S:"","commentIfDeactivated"),g=i((S,I="'",M="'")=>{let H=S[0];return S[S.length-1]===I&&H===M?S:`${I}${S}${M}`},"wrap"),E=i((S,I)=>I.some(M=>(S==null?void 0:S.oldField[M])!==(S==null?void 0:S.newField[M])),"checkFieldPropertiesChanged"),_=i(S=>t.map(S,I=>{let M=I.defaultExpression?`DEFAULT ${I.defaultExpression}`:"";return t.trim(`${I.argumentMode} ${I.argumentName||""} ${I.argumentType} ${M}`)}).join(", "),"getFunctionArguments"),b=i((S,I)=>I?`${C(I)}.${C(S)}`:C(S),"getNamePrefixedWithSchemaName"),C=i(S=>/\s|\W/.test(S)||t.includes(ff,t.toUpper(S))?`"${S}"`:S,"wrapInQuotes"),P=i(({name:S})=>C(S),"columnMapToString"),x=i((S,I,M,H=P)=>{var de;let z=f(S,H),Se=(de=z==null?void 0:z.deactivatedItems)!=null&&de.length?y(z.deactivatedItems.join(", "),{isActivated:!1,isPartOfLine:!0}):"";return!I&&M?" ("+z.activatedItems.join(", ")+Se+")":" ("+S.map(H).join(", ")+")"},"getColumnsList"),$=i(S=>S?S.alias?`${C(S.name)} as ${C(S.alias)}`:C(S.name):"","getKeyWithAlias"),U=i(S=>Array.isArray(S)?S.reduce((I,M)=>{if(!M.tableName)return I.columns.push($(M)),I;let H=`${C(M.dbName)}.${C(M.tableName)}`;return I.tables.includes(H)||I.tables.push(H),I.columns.push({statement:`${H}.${$(M)}`,isActivated:M.isActivated}),I},{tables:[],columns:[]}):{tables:[],columns:[]},"getViewData"),V=i((S="")=>S.replace(hf,I=>`\\${I}`),"prepareComment"),v=i(S=>`E'${V(JSON.stringify(S)).slice(1,-1)}'`,"wrapComment"),O=i(S=>{var z;let I={...S,...t.omit(S==null?void 0:S.role,"properties")||{}},M=r(I),H=(z=I.compMod)==null?void 0:z.keyspaceName;return b(M,H)},"getFullTableName");return{getDbName:e,getDbData:s,getEntityName:r,getViewName:n,getViewOn:a,rejectRecursiveRelationships:o,filterRecursiveRelationships:c,tab:u,hasType:l,clean:m,checkAllKeysActivated:p,checkAllKeysDeactivated:d,divideIntoActivatedAndDeactivated:f,commentIfDeactivated:y,wrap:g,checkFieldPropertiesChanged:E,getFullTableName:O,getFullColumnName:i((S,I)=>`${O(S)}.${C(I)}`,"getFullColumnName"),getFullViewName:i(S=>{var z;let I={...S,...t.omit(S==null?void 0:S.role,"properties")||{}},M=n(I),H=(z=I.compMod)==null?void 0:z.keyspaceName;return b(M,H)},"getFullViewName"),getFunctionArguments:_,getNamePrefixedWithSchemaName:b,wrapInQuotes:C,getColumnsList:x,getViewData:U,wrapComment:v,getUdtName:i(S=>S.code||S.name,"getUdtName"),getSchemaOfAlterCollection:i(S=>({...S,...t.omit(S==null?void 0:S.role,"properties")||{}}),"getSchemaOfAlterCollection"),getFullCollectionName:i(S=>{var H;let I=r(S),M=(H=S.compMod)==null?void 0:H.keyspaceName;return b(I,M)},"getFullCollectionName")}}});var za=A((wy,ja)=>{"use strict";var{AlterScriptDto:Ya}=ae(),Wa=i(t=>{var e,r;return((r=(e=t==null?void 0:t.role)==null?void 0:e.compMod)==null?void 0:r.description)||{}},"extractDescription"),gf=i((t,e)=>r=>{let{wrapComment:n,wrapInQuotes:s}=B()(t),a=Wa(r);if(a.new&&a.new!==a.old){let o=n(a.new),c=s(r.role.name),u=e.updateSchemaComment(c,o);return Ya.getInstance([u],!0,!1)}},"getUpsertCommentsScriptDto"),_f=i((t,e)=>r=>{let{wrapInQuotes:n}=B()(t),s=Wa(r);if(s.old&&!s.new){let a=n(r.role.name),o=e.dropSchemaComment(a);return Ya.getInstance([o],!0,!0)}},"getDropCommentsScriptDto"),yf=i((t,e)=>r=>{let n=gf(t,e)(r),s=_f(t,e)(r);return[n,s].filter(Boolean)},"getModifySchemaCommentsScriptDtos");ja.exports={getModifySchemaCommentsScriptDtos:yf}});var Ja=A((Dy,Xa)=>{"use strict";Xa.exports={number:"numeric",string:"text",date:"date",timestamp:"timestamp",binary:"bytea",boolean:"boolean",document:"jsonb",array:"jsonb",objectId:"uuid",default:"char"}});var eo=A((Ly,Za)=>{"use strict";Za.exports={char:{size:1},varchar:{mode:"varying"},text:{mode:"text"},bit:{size:1,mode:"bit"},varbit:{size:1,mode:"varying"},tsvector:{mode:"text"},tsquery:{mode:"text"},smallint:{capacity:2},integer:{capacity:4},bigint:{capacity:8},numeric:{capacity:12,mode:"decimal"},real:{capacity:4,mode:"floating"},"double precision":{capacity:8,mode:"floating"},smallserial:{capacity:2},serial:{capacity:4},bigserial:{capacity:8},money:{capacity:8,mode:"decimal"},bytea:{size:4,mode:"binary"},date:{format:"YYYY-MM-DD"},time:{format:"hh:mm:ss.nnnnnn"},timestamp:{format:"YYYY-MM-DD hh:mm:ss"},interval:{format:"PnYnMnDTnHnMnS"},boolean:{mode:"boolean"},int4range:{mode:"range",modeType:"integer",capacity:4},int8range:{mode:"range",modeType:"integer",capacity:8},numrange:{mode:"range",modeType:"decimal",capacity:12},daterange:{mode:"range",modeType:"date",format:"YYYY-MM-DD"},tsrange:{mode:"range",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss"},tstzrange:{mode:"range",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss.nnnZ"},int4multirange:{mode:"multirange",modeType:"integer",capacity:4},int8multirange:{mode:"multirange",modeType:"integer",capacity:8},nummultirange:{mode:"multirange",modeType:"decimal",capacity:12},datemultirange:{mode:"multirange",modeType:"date",format:"YYYY-MM-DD"},tsmultirange:{mode:"multirange",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss"},tstzmultirange:{mode:"multirange",modeType:"timestamp",format:"YYYY-MM-DD hh:mm:ss.nnnZ"},geometry:{format:"euclidian",mode:"geospatial"},geography:{format:"euclidian",mode:"geospatial"},box2d:{format:"euclidian",mode:"geospatial"},box3d:{format:"euclidian",mode:"geospatial"},geometry_dump:{format:"euclidian",mode:"geospatial"},point:{format:"euclidian",mode:"geospatial"},line:{format:"euclidian",mode:"geospatial"},lseg:{format:"euclidian",mode:"geospatial"},box:{format:"euclidian",mode:"geospatial"},path:{format:"euclidian",mode:"geospatial"},polygon:{format:"euclidian",mode:"geospatial"},circle:{format:"euclidian",mode:"geospatial"},inet:{mode:"ip"},cidr:{mode:"ip"},macaddr:{},macaddr8:{},uuid:{mode:"uuid"},oid:{mode:"uuid"},regclass:{},regcollation:{},regconfig:{},regdictionary:{},regnamespace:{},regoper:{},regoperator:{},regproc:{},regprocedure:{},regrole:{},regtype:{},xml:{mode:"xml"},json:{format:"semi-structured"},jsonb:{format:"semi-structured"},composite:{format:"semi-structured",mode:"object"},enum:{mode:"enum"},range_udt:{mode:"range"},domain:{mode:"domain"}}});var ro=A((xy,to)=>{"use strict";to.exports={createDatabase:"CREATE DATABASE ${name}${template}${encoding}${locale}${collate}${characterClassification}${tablespace};\n",createSchema:"CREATE SCHEMA${ifNotExist} ${name};\nSET search_path TO ${name};\n\n${comment}\n",comment:"COMMENT ON ${object} ${objectName} IS ${comment};\n",createTable:"CREATE${temporary} TABLE${ifNotExist} ${name} (\n${columnDefinitions}${keyConstraints}${checkConstraints}${foreignKeyConstraints}\n)${options};\n\n${comment}${columnDescriptions}",createTablePartitionOf:"CREATE${temporary} TABLE${ifNotExist} ${name}\n${partitionOf} ${openParenthesis}${keyConstraints}${checkConstraints}${foreignKeyConstraints}\n${closeParenthesis}${options};\n\n${comment}${columnDescriptions}",columnDefinition:"${name} ${type}${collation}${primaryKey}${uniqueKey}${defaultValue}${notNull}",checkConstraint:"${name} CHECK (${expression})",createForeignKeyConstraint:"${name} FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable} (${primaryKey})${match}${onDelete}${onUpdate}${deferrable}${deferrableConstraintCheckTime}",createKeyConstraint:"${constraintName}${keyType}${columns}${includeNonKey}${storageParameters}${tablespace}",alterColumnType:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} SET DATA TYPE ${dataType};",addNotNullConstraint:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} SET NOT NULL;",dropNotNullConstraint:"ALTER TABLE IF EXISTS ${tableName} ALTER COLUMN ${columnName} DROP NOT NULL;",renameColumn:"ALTER TABLE IF EXISTS ${tableName} RENAME COLUMN ${oldColumnName} TO ${newColumnName};",addCheckConstraint:"ALTER TABLE IF EXISTS ${tableName} ADD CONSTRAINT ${constraintName} CHECK (${expression});",dropConstraint:"ALTER TABLE IF EXISTS ${tableName} DROP CONSTRAINT IF EXISTS ${constraintName};",createForeignKey:"ALTER TABLE IF EXISTS ${foreignTable} ADD CONSTRAINT ${name} FOREIGN KEY (${foreignKey}) REFERENCES ${primaryTable}(${primaryKey})${match}${onDelete}${onUpdate}${deferrable}${deferrableConstraintCheckTime};",dropForeignKey:"ALTER TABLE ${tableName} DROP CONSTRAINT ${fkConstraintName};",addPkConstraint:"ALTER TABLE IF EXISTS ${tableName} ADD ${constraintStatement};",dropTable:"DROP TABLE IF EXISTS ${tableName};",addColumn:"ALTER TABLE IF EXISTS ${tableName} ADD COLUMN IF NOT EXISTS ${columnDefinition};",dropColumn:"ALTER TABLE IF EXISTS ${tableName} DROP COLUMN IF EXISTS ${columnName};",dropDomain:"DROP DOMAIN IF EXISTS ${udtName};",dropType:"DROP TYPE IF EXISTS ${udtName};",alterTypeAddAttribute:"ALTER TYPE ${udtName} ADD ATTRIBUTE ${columnDefinition};",alterTypeDropAttribute:"ALTER TYPE ${udtName} DROP ATTRIBUTE IF EXISTS ${attributeName};",alterTypeRenameAttribute:"ALTER TYPE ${udtName} RENAME ATTRIBUTE ${oldAttributeName} TO ${newAttributeName};",alterTypeChangeAttributeType:"ALTER TYPE ${udtName} ALTER ATTRIBUTE ${attributeName} SET DATA TYPE ${newDataType};",updateCommentOnTable:"COMMENT ON TABLE ${tableName} IS ${comment};",updateCommentOnColumn:"COMMENT ON COLUMN ${columnName} IS ${comment};",updateCommentOnSchema:"COMMENT ON SCHEMA ${schemaName} IS ${comment};",updateCommentOnView:"COMMENT ON VIEW ${viewName} IS ${comment};",createSchemaOnly:"CREATE SCHEMA IF NOT EXISTS ${schemaName};",dropSchema:"DROP SCHEMA IF EXISTS ${schemaName};",index:"CREATE${unique} INDEX${concurrently}${ifNotExist} ${name}\n ON${only} ${tableName}${using}${keys}${options};\n",createView:"CREATE${orReplace}${temporary} VIEW ${name}${withOptions}\nAS ${selectStatement}${checkOption};\n\n${comment}\n",viewSelectStatement:"SELECT ${keys}\n	FROM ${tableName}",dropView:"DROP VIEW IF EXISTS ${viewName};",createFunction:"CREATE${orReplace} FUNCTION ${name}\n	(${parameters})\n	RETURNS ${returnType}\n	LANGUAGE ${language}\n${properties}AS $BODY$\n${definition}\n$BODY$;\n",createProcedure:"CREATE${orReplace} PROCEDURE ${name} (${parameters})\n	LANGUAGE ${language}\nAS $BODY$\n${body}\n$BODY$;\n",createCompositeType:`CREATE TYPE \${name} AS (
	\${columnDefinitions}
);

\${comment}`,createEnumType:"CREATE TYPE ${name} AS ENUM (${values});\n\n${comment}",createRangeType:"CREATE TYPE ${name} AS RANGE (\n	SUBTYPE=${subtype}${options}\n);\n\n${comment}",createDomainType:"CREATE DOMAIN ${name} AS ${underlyingType}${notNull}${collate}${default}${constraints};\n\n${comment}",createTrigger:"CREATE${orReplace}${constraint} TRIGGER ${name} ${actionTiming} ${events}\n	ON ${tableName}\n${options}	EXECUTE ${functionKey} ${functionName};\n"}});var so=A((My,no)=>{"use strict";var Ef=i(({index:t,numberOfStatements:e,lastIndexOfActivatedStatement:r,delimiter:n})=>{let s=t===e-1,a=t===r;return s?"":a?" --"+n:n},"getDelimiter"),Tf=i(({statements:t=[],delimiter:e=",",indent:r=`
`})=>{let n=t.findLastIndex(a=>!a.startsWith("--")),s=t.length;return t.map((a,o)=>{let c=Ef({index:o,numberOfStatements:s,lastIndexOfActivatedStatement:n,delimiter:e});return a+c}).join(r)},"joinActivatedAndDeactivatedStatements");no.exports={joinActivatedAndDeactivatedStatements:Tf}});var oo=A((Fy,ao)=>{"use strict";var io=i((t="")=>new RegExp("\\$\\{(.*?)\\}",t),"template"),Sf=i(t=>t.match(io("gi"))||[],"getAllTemplates"),Af=i(t=>(t.match(io("i"))||[])[1],"parseTemplate"),Cf=i((t,e)=>Sf(t).reduce((r,n)=>{let s=Af(n);return r.replace(n,()=>e[s]||e[s]===0?e[s]:"")},t),"assignTemplates");ao.exports=Cf});var uo=A(($y,co)=>{"use strict";co.exports=({_:t,commentIfDeactivated:e,checkAllKeysDeactivated:r,assignTemplates:n,wrapInQuotes:s,getColumnsList:a})=>({generateConstraintsString:i((d,f)=>{var _,b;let y=e(((d==null?void 0:d.deactivatedItems)||[]).join(`,
	`),{isActivated:!f,isPartOfLine:!0}),g=(_=d==null?void 0:d.activatedItems)!=null&&_.length?`,
	`+d.activatedItems.join(`,
	`):"",E=(b=d==null?void 0:d.deactivatedItems)!=null&&b.length?`
	`+y:"";return g+E},"generateConstraintsString"),foreignKeysToString:i(d=>{if(Array.isArray(d)){let f=d.filter(E=>t.get(E,"isActivated",!0)).map(E=>s(t.trim(E.name))),y=d.filter(E=>!t.get(E,"isActivated",!0)).map(E=>s(t.trim(E.name))),g=y.length?e(y,{isActivated:!1,isPartOfLine:!0}):"";return f.join(", ")+g}return d},"foreignKeysToString"),foreignActiveKeysToString:i(d=>d.map(f=>t.trim(f.name)).join(", "),"foreignActiveKeysToString"),createKeyConstraint:i((d,f)=>y=>{let g=s(t.trim(y.name)),E=r(y.columns||[]),_=t.isEmpty(y.columns)?"":a(y.columns,E,f),b=y.include.length?` INCLUDE${a(y.include,E,f)}`:"",C=y.storageParameters?` WITH (${y.storageParameters})`:"",P=y.tablespace?` USING INDEX TABLESPACE ${s(y.tablespace)}`:"";return{statement:n(d.createKeyConstraint,{constraintName:y.name?`CONSTRAINT ${g} `:"",keyType:y.keyType,columns:_,includeNonKey:b,storageParameters:C,tablespace:P}),isActivated:!E}},"createKeyConstraint"),getConstraintsWarnings:i((d=[])=>t.isEmpty(d)?"":`
	`+d.map(f=>{let y=f.name?` [constraint name: ${f.name}]`:"";return`-- ${f.errorMessage}${y}`}).join(`
	`),"getConstraintsWarnings"),additionalPropertiesForForeignKey:i(d=>{let f=t.get(d,"relationshipOnDelete",""),y=t.get(d,"relationshipOnUpdate",""),g=t.get(d,"relationshipMatch",""),E=t.get(d,"deferrable",""),_=t.get(d,"deferrableConstraintCheckTime","");return{foreignOnDelete:f,foreignOnUpdate:y,foreignMatch:g,deferrable:E,deferrableConstraintCheckTime:_}},"additionalPropertiesForForeignKey")})});var po=A((Uy,lo)=>{"use strict";lo.exports=(t,e)=>{let r=i((g,E)=>Object.entries(g.properties).map(E),"mapProperties"),n=i(g=>g.compositeUniqueKey?!1:!!g.unique,"isUniqueKey"),s=i(g=>{var E,_;return n(g)&&(((E=g.uniqueKeyOptions)==null?void 0:E.length)===1&&!((_=t.first(g.uniqueKeyOptions))!=null&&_.constraintName)||t.isEmpty(g.uniqueKeyOptions))},"isInlineUnique"),a=i(g=>g.compositeUniqueKey||g.compositePrimaryKey?!1:!!g.primaryKey,"isPrimaryKey"),o=i(g=>{var E;return a(g)&&!((E=t.first(g.primaryKeyOptions))!=null&&E.constraintName)},"isInlinePrimaryKey"),c=i((g,E,_,b)=>e({keyType:"UNIQUE",name:g.constraintName,columns:[{name:E,isActivated:_}],include:p(g.indexInclude||[],b),storageParameters:g.indexStorageParameters,comment:g.indexComment,tablespace:g.indexTablespace}),"hydrateUniqueOptions"),u=i((g,E,_,b)=>e({keyType:"PRIMARY KEY",name:g.constraintName,columns:[{name:E,isActivated:_}],include:p(g.indexInclude||[],b),storageParameters:g.indexStorageParameters,comment:g.indexComment,tablespace:g.indexTablespace}),"hydratePrimaryKeyOptions"),l=i((g,E)=>Object.keys(E).find(_=>E[_].GUID===g),"findName"),m=i((g,E)=>t.get(Object.values(E).find(_=>_.GUID===g),"isActivated",!0),"checkIfActivated"),p=i((g,E)=>t.map(g,_=>({name:l(_.keyId,E.properties),isActivated:m(_.keyId,E.properties)})),"getKeys"),d=i(g=>Array.isArray(g.primaryKey)?g.primaryKey.map(E=>t.isEmpty(E.compositePrimaryKey)?{name:E.constraintName,errorMessage:"A primary key constraint cannot be created without any primary key selected"}:{...u(E,null,null,g),columns:p(E.compositePrimaryKey,g)}):[],"getCompositePrimaryKeys"),f=i(g=>Array.isArray(g.uniqueKey)?g.uniqueKey.map(E=>t.isEmpty(E.compositeUniqueKey)?{name:E.constraintName,errorMessage:"A unique key constraint cannot be created without any unique key selected"}:{...c(E,null,null,g),columns:p(E.compositeUniqueKey,g)}):[],"getCompositeUniqueKeys");return{getTableKeyConstraints:i(g=>{if(!g.properties)return[];let E=r(g,([b,C])=>{if(!(!a(C)||o(C)))return u(t.first(C.primaryKeyOptions),b,C.isActivated,g)}).filter(Boolean),_=t.flatten(r(g,([b,C])=>!n(C)||s(C)?[]:(C.uniqueKeyOptions||[]).map(P=>c(P,b,C.isActivated,g)))).filter(Boolean);return[...E,...d(g),..._,...f(g)]},"getTableKeyConstraints"),isInlineUnique:s,isInlinePrimaryKey:o,getKeys:p,hydratePrimaryKeyOptions:u,hydrateUniqueOptions:c}}});var fo=A((Gy,mo)=>{"use strict";mo.exports=({_:t,templates:e,assignTemplates:r,getFunctionArguments:n,getNamePrefixedWithSchemaName:s,wrapComment:a})=>{let o=i((C,P)=>t.map(P,x=>{let $=x.functionOrReplace?" OR REPLACE":"",U=r(e.createFunction,{name:s(x.name,C),orReplace:$,parameters:n(x.functionArguments),returnType:x.functionReturnsSetOf?`SETOF ${x.functionReturnType}`:x.functionReturnType,language:x.functionLanguage,properties:c(x),definition:x.functionBody}),V=x.functionDescription?r(e.comment,{object:"FUNCTION",objectName:s(x.name,C),comment:a(x.functionDescription)}):"";return[U,V].filter(Boolean).join(`
`)}).join(`
`),"getFunctionsScript"),c=i(C=>{let P=i(x=>x?`	${x}
`:"","wrap");return[{key:"functionWindow",getValue:u},{key:"functionVolatility",getValue:l},{key:"functionLeakProof",getValue:m},{key:"functionNullArgs",getValue:p},{key:"functionSqlSecurity",getValue:d},{key:"functionParallel",getValue:f},{key:"functionExecutionCost",getValue:y},{key:"functionExecutionRows",getValue:g},{key:"functionSupportFunction",getValue:E},{key:"functionConfigurationParameters",getValue:_}].map(x=>P(x.getValue(C[x.key],C))).filter(Boolean).join("")},"getProperties"),u=i((C,P)=>P.language!=="c"||!C?"":"WINDOW","getWindow"),l=i(C=>C,"getVolatility"),m=i(C=>C?"LEAKPROOF":"NOT LEAKPROOF","getLeakProof"),p=i(C=>C,"getNullArgs"),d=i(C=>{if(C)return`SECURITY ${C}`},"getSqlSecurity"),f=i(C=>{if(C)return`PARALLEL ${C}`},"getParallel"),y=i(C=>{if(C)return`COST ${C}`},"getExecutionCost"),g=i((C,P)=>!C||!P.functionReturnsSetOf&&!b(P)?"":`ROWS ${C}`,"getExecutionRows"),E=i(C=>{if(C)return`SUPPORT ${C}`},"getSupportFunction"),_=i(C=>{if(C)return`SET ${C}`},"getConfigurationParameters"),b=i(C=>(C.functionReturnType||"").trim().toUpperCase().startsWith("TABLE"),"isFunctionReturnsTable");return{getFunctionsScript:o}}});var go=A((Hy,ho)=>{"use strict";ho.exports=({_:t,templates:e,assignTemplates:r,getFunctionArguments:n,getNamePrefixedWithSchemaName:s})=>({getProceduresScript:i((o,c)=>t.map(c,u=>{let l=u.orReplace?" OR REPLACE":"";return r(e.createProcedure,{name:s(u.name,o),orReplace:l,parameters:n(u.inputArgs),language:u.language,body:u.body})}).join(`
`),"getProceduresScript")})});var yo=A((Yy,_o)=>{"use strict";_o.exports=({_:t,getColumnsList:e,checkAllKeysDeactivated:r})=>{let n=i((p,d)=>p?" TEMPORARY":d?" UNLOGGED":"","getTableTemporaryValue"),s=i(p=>{let d=i(y=>y?`${y}
`:"","wrap"),f=[{key:"partitionBounds",getValue:u("")},{key:"partitioning",getValue:a},{key:"usingMethod",getValue:u("USING")},{key:"storage_parameter",getValue:m},{key:"on_commit",getValue:c},{key:"table_tablespace_name",getValue:u("TABLESPACE")},{key:"selectStatement",getValue:u("AS")}].map(y=>d(y.getValue(p[y.key],p))).filter(Boolean).join("");return t.trim(f)?` ${t.trim(f)}`:""},"getTableOptions"),a=i((p,{isActivated:d})=>{if(p&&p.partitionMethod){let f=p.partitionBy==="keys"?o(p,d):` (${p.partitioning_expression})`;return`PARTITION BY ${p.partitionMethod}${f}`}},"getPartitioning"),o=i((p,d)=>{let f=r(p.compositePartitionKey);return e(p.compositePartitionKey,f,d)},"getPartitionKeys"),c=i((p,d)=>{if(p&&d.temporary)return`ON COMMIT ${p}`},"getOnCommit"),u=i(p=>d=>{if(d)return`${p} ${d}`},"getBasicValue"),l=["toast_autovacuum_enabled","toast_vacuum_index_cleanup","toast_vacuum_truncate","toast_autovacuum_vacuum_threshold","toast_autovacuum_vacuum_scale_factor","toast_autovacuum_vacuum_insert_threshold","toast_autovacuum_vacuum_insert_scale_factor","toast_autovacuum_vacuum_cost_delay","toast_autovacuum_vacuum_cost_limit","toast_autovacuum_freeze_min_age","toast_autovacuum_freeze_max_age","toast_autovacuum_freeze_table_age","toast_autovacuum_multixact_freeze_min_age","toast_autovacuum_multixact_freeze_max_age","toast_autovacuum_multixact_freeze_table_age","toast_log_autovacuum_min_duration"],m=i(p=>{if(t.isEmpty(p))return"";let d=["autovacuum","toast","id"];return t.chain(p).toPairs().flatMap(([f,y])=>f==="autovacuum"||f==="toast"?t.toPairs(y):[[f,y]]).reject(([f])=>t.includes(d,f)).map(([f,y])=>{if(!(!y&&y!==0))return t.includes(l,f)?`toast.${f.slice(6)}=${y}`:`${f}=${y}`}).compact().join(`,
	`).trim().thru(f=>{if(f)return`WITH (
	${f}
)`}).value()},"getStorageParameters");return{getTableTemporaryValue:n,getTableOptions:s}}});var To=A((jy,Eo)=>{"use strict";Eo.exports=({_:t,commentIfDeactivated:e,assignTemplates:r,templates:n,getNamePrefixedWithSchemaName:s,wrapComment:a})=>{let o=["composite","enum","range_udt","domain"],c=i((f,y)=>{let g=s(f.name,f.schemaName),E=r(n.comment,{object:"TYPE",objectName:g,comment:a(f.comment)});switch(f.type){case"composite":return r(n.createCompositeType,{name:g,columnDefinitions:t.join(y,`,
	`),comment:f.comment?E:""});case"enum":return r(n.createEnumType,{name:g,values:t.map(f.enum,_=>`'${_}'`).join(", "),comment:f.comment?E:""});case"range_udt":return r(n.createRangeType,{name:g,subtype:f.rangeSubtype,options:l(f),comment:f.comment?E:""});case"domain":{let _=r(n.comment,{object:"DOMAIN",objectName:g,comment:a(f.comment)});return r(n.createDomainType,{name:g,underlyingType:f.underlyingType,notNull:f.nullable?"":" NOT NULL",collate:f.collation?`
	COLLATE ${f.collation}`:"",default:f.default?`
	DEFAULT ${f.default}`:"",constraints:m(f),comment:f.comment?_:""})}default:return""}},"getPlainUdt"),u=i(f=>o.includes(f.type),"isNotPlainType"),l=i(f=>{let y=i(E=>E?`	${E}`:"","wrap"),g=[{key:"operatorClass",getValue:p("SUBTYPE_OPCLASS")},{key:"collation",getValue:p("COLLATION")},{key:"canonicalFunction",getValue:p("CANONICAL")},{key:"subtypeDiffFunction",getValue:p("SUBTYPE_DIFF")},{key:"multiRangeType",getValue:p("MULTIRANGE_TYPE_NAME")}].map(E=>y(E.getValue(f[E.key]))).filter(Boolean).join(`,
`);return t.trim(g)?`,
	`+t.trim(g):""},"getRangeOptions"),m=i(f=>t.map(f.checkConstraints,y=>y.name?`
	CONSTRAINT ${y.name} CHECK (${y.expression})`:`
	CHECK (${y.expression})`).join(""),"getDomainConstraints"),p=i(f=>y=>{if(y)return`${f}=${y}`},"getBasicValue");return{getUserDefinedType:i((f,y)=>e(c(f,y),{isActivated:f.isActivated}),"getUserDefinedType"),isNotPlainType:u}}});var Ao=A((Xy,So)=>{"use strict";So.exports=({_:t,wrapInQuotes:e,checkAllKeysDeactivated:r,getColumnsList:n})=>{let s=i(({name:m,sortOrder:p,nullsOrder:d,collation:f,opclass:y})=>{let g=p?` ${p}`:"",E=d?` ${d}`:"",_=t.includes(f,'"')?f:`"${f}"`,b=f?` COLLATE ${_}`:"",C=y?` ${y}`:"";return`${e(m)}${b}${C}${g}${E}`},"mapIndexKey"),a=i((m=[],p)=>{let d=r(m);return n(m,d,p,s)},"getIndexKeys"),o=i((m,p)=>{var b;let d=n(m.include||[],r(m.include||[]),p),f=(b=m.include)!=null&&b.length?` INCLUDE ${t.trim(d)}`:"",y=u(m),g=y?` WITH (
	${y})`:"",E=m.index_tablespace_name?` TABLESPACE ${m.index_tablespace_name}`:"",_=m.where?` WHERE ${m.where}`:"";return t.compact([" ",f,g,E,_]).join(`
`)},"getIndexOptions"),c={btree:{index_fillfactor:"fillfactor",deduplicate_items:"deduplicate_items"},hash:{index_fillfactor:"fillfactor"},gin:{fastupdate:"fastupdate",gin_pending_list_limit:"gin_pending_list_limit"},brin:{pages_per_range:"pages_per_range",autosummarize:"autosummarize"}},u=i(m=>{let p=c[m.index_method];return t.chain(p).toPairs().map(([d,f])=>{let y=m.index_storage_parameter[d];if(!(t.isNil(y)||y===""))return`${f}=${l(y)}`}).compact().join(`,
	`).value()},"getWithOptions"),l=i(m=>t.isBoolean(m)?m?"ON":"OFF":m,"getValue");return{getIndexKeys:a,getIndexOptions:o}}});var No=A((Zy,Co)=>{"use strict";Co.exports=({_:t,wrap:e,assignTemplates:r,templates:n,commentIfDeactivated:s,wrapComment:a,wrapInQuotes:o})=>{let c=i((v,O)=>`${v}(${O})`,"addLength"),u=i((v,O,F)=>t.isNumber(F)?`${v}(${O},${F})`:`${v}(${O})`,"addScalePrecision"),l=i((v,O)=>t.isNumber(O)?`${v}(${O})`:v,"addPrecision"),m=i((v,O)=>O?`${v} ${O}`:v,"addWithTimezone"),p=i(({type:v,typeModifier:O,srid:F})=>{let K=F?`, ${F}`:"";return O&&O!==""?`${v}(${O}${K})`:v},"addTypeModifier"),d=i((v,O)=>{let F=(O==null?void 0:O.map(K=>`[${(K==null?void 0:K.array_size_limit)??""}]`).join("").trim())||"";return`${v}${F}`},"addArrayDecorator"),f=i(v=>["char","varchar","bit","varbit"].includes(v),"canHaveLength"),y=i(v=>v==="numeric","canHavePrecision"),g=i(v=>["time","timestamp"].includes(v),"canHaveTimePrecision"),E=i(v=>v==="numeric","canHaveScale"),_=i(v=>["geography","geometry"].includes(v),"canHaveTypeModifier"),b=i((v,O)=>f(v)&&t.isNumber(O.length)?c(v,O.length):y(v)&&E(v)&&t.isNumber(O.precision)?u(v,O.precision,O.scale):y(v)&&t.isNumber(O.precision)?l(v,O.precision):_(v)?p({type:v,typeModifier:O.typeModifier,srid:O.srid}):g(v)&&(t.isNumber(O.timePrecision)||O.timezone)?m(l(v,O.timePrecision),O.timezone):d(v,O.array_type),"decorateType"),C=i(v=>["char","varchar","text","bit","varbit"].includes(v),"isString"),P=i(v=>["date","time","timestamp","interval"].includes(v),"isDateTime"),x=i((v,O,F)=>{let K=["current_timestamp","current_user","null"];return(C(v)||P(v))&&!K.includes(t.toLower(O))&&!F?a(O):O},"decorateDefault"),$=i((v,O)=>t.chain(O).filter("comment").map(F=>{let K=r(n.comment,{object:"COLUMN",objectName:`${v}.${o(F.name)}`,comment:a(F.comment)});return s(K,F)}).join(`
`).value(),"getColumnComments"),U={"v2.x":{int4multirange:"int4range",int8multirange:"int8range",nummultirange:"numrange",datemultirange:"daterange",tsmultirange:"tsrange",tstzmultirange:"tstzrange"}};return{decorateType:b,decorateDefault:x,getColumnComments:$,replaceTypeByVersion:i((v,O)=>{let F=U[O];return t.get(F,v)||v},"replaceTypeByVersion")}}});var vo=A((tE,bo)=>{"use strict";bo.exports=({_:t,assignTemplates:e,templates:r,getNamePrefixedWithSchemaName:n,wrap:s,commentIfDeactivated:a})=>{let o=i(({dbVersion:p,triggers:d,tableName:f})=>t.map(d,c(p,f)).join(`
`).trim(),"getTriggersScript"),c=i((p,d)=>f=>{let y=u(f),g=l(f);return e(r.createTrigger,{orReplace:f.triggerOrReplace?" OR REPLACE":"",constraint:f.triggerConstraint?" CONSTRAINT":"",actionTiming:f.triggerType??"",functionKey:p==="v2.x"?"PROCEDURE":"FUNCTION",functionName:f.triggerFunction,name:f.name,tableName:d,events:y,options:g})},"getTriggerScript"),u=i(p=>{var d;return(d=p.triggerEvents)==null?void 0:d.map(f=>{if(f.triggerEvent!=="UPDATE"||t.isEmpty(p.triggerUpdateColumns))return f.triggerEvent;let y=t.chain(p.triggerUpdateColumns).filter("isActivated").map(({name:_})=>_).join(", ").thru(_=>_&&`OF ${_}`).value(),g=t.chain(p.triggerUpdateColumns).reject("isActivated").map(({name:_})=>_).join(", ").thru(_=>!y&&_?`OF ${_}`:_).value(),E=g&&a(g,{isActivated:!1,isPartOfLine:!0});return`UPDATE ${y} ${E}`}).join(" OR ")},"getTriggerEvents"),l=i(p=>{let d="";if(p.triggerConstraint&&(p.triggerReferencedTable&&(d+=s(`FROM ${p.triggerReferencedTable}`,"	",`
`)),d+=s(p.triggerDeferrable?"DEFERRABLE":"NOT DEFERRABLE","	",`
`),p.triggerDeferrable&&p.triggerTimeConstraintCheck&&(d+=s(p.triggerTimeConstraintCheck,"	",`
`))),p.triggerReferencing){let f="REFERENCING";p.triggerBeforeImageTransitionRelation&&(f+=` OLD TABLE ${p.triggerBeforeImageTransitionRelation}`),p.triggerAfterImageTransitionRelation&&(f+=` NEW TABLE ${p.triggerAfterImageTransitionRelation}`),d+=s(f,"	",`
`)}return d+=s(p.triggerConstraint||p.triggerType==="INSTEAD OF"?"FOR EACH ROW":p.triggerEachRowStatement||"FOR EACH STATEMENT","	",`
`),p.triggerCondition&&(d+=s(`WHEN ${p.triggerCondition}`,"	",`
`)),d},"getTriggerOptions");return{getTriggersScript:o,hydrateTriggers:i((p,d={})=>{var f;return(((f=t.find(p,"triggers"))==null?void 0:f.triggers)||[]).map(y=>{let g=d[y.triggerReferencedTable];if(!g)return{...y,triggerReferencedTable:""};let E=n(g.code||g.collectionName,g.bucketName);return{...y,triggerReferencedTable:E}})},"hydrateTriggers")}}});var Io=A((nE,Oo)=>{"use strict";Oo.exports=()=>({getLocaleProperties:i(e=>{let r=["v13.x","v14.x"].includes(e.dbVersion);return r&&e.locale?{locale:e.locale}:!r&&e.locale?{collate:e.locale,characterClassification:e.locale}:{collate:e.collate,characterClassification:e.characterClassification}},"getLocaleProperties")})});var ee=A((iE,wo)=>{"use strict";var Nf=Ja(),Ro=eo(),w=ro(),{joinActivatedAndDeactivatedStatements:bf}=so();wo.exports=(t,e,r)=>{let n=r.require("lodash"),{tab:s,commentIfDeactivated:a,checkAllKeysDeactivated:o,divideIntoActivatedAndDeactivated:c,hasType:u,wrap:l,clean:m,getFunctionArguments:p,wrapInQuotes:d,getNamePrefixedWithSchemaName:f,getColumnsList:y,getViewData:g,wrapComment:E}=B()(n),_=oo(),{generateConstraintsString:b,foreignKeysToString:C,foreignActiveKeysToString:P,createKeyConstraint:x,getConstraintsWarnings:$,additionalPropertiesForForeignKey:U}=uo()({_:n,commentIfDeactivated:a,checkAllKeysDeactivated:o,assignTemplates:_,getColumnsList:y,wrapInQuotes:d}),V=po()(n,m),{getFunctionsScript:v}=fo()({_:n,templates:w,assignTemplates:_,getFunctionArguments:p,getNamePrefixedWithSchemaName:f,wrapComment:E}),{getProceduresScript:O}=go()({_:n,templates:w,assignTemplates:_,getFunctionArguments:p,getNamePrefixedWithSchemaName:f}),{getTableTemporaryValue:F,getTableOptions:K}=yo()({_:n,checkAllKeysDeactivated:o,getColumnsList:y}),{getUserDefinedType:Me,isNotPlainType:qe}=To()({_:n,commentIfDeactivated:a,assignTemplates:_,templates:w,getNamePrefixedWithSchemaName:f,wrapComment:E}),{getIndexKeys:L,getIndexOptions:S}=Ao()({_:n,wrapInQuotes:d,checkAllKeysDeactivated:o,getColumnsList:y}),{decorateType:I,decorateDefault:M,getColumnComments:H,replaceTypeByVersion:z}=No()({_:n,wrap:l,assignTemplates:_,templates:w,commentIfDeactivated:a,wrapInQuotes:d,wrapComment:E}),{getTriggersScript:Se,hydrateTriggers:de}=vo()({_:n,wrap:l,assignTemplates:_,templates:w,getNamePrefixedWithSchemaName:f,commentIfDeactivated:a}),{getLocaleProperties:Ic}=Io()();return{createDatabase(h){if(!h.databaseName)return"";let{locale:T,collate:N,characterClassification:R}=Ic(h);return _(w.createDatabase,{name:d(h.databaseName),template:h.template?`
	TEMPLATE ${h.template}`:"",encoding:h.encoding?`
	ENCODING ${h.encoding}`:"",locale:T?`
	LOCALE '${h.locale}'`:"",collate:N?`
	LC_COLLATE '${h.collate}'`:"",characterClassification:R?`
	LC_CTYPE '${R}'`:"",tablespace:h.tablespace?`
	TABLESPACE '${h.tablespace}'`:""})},createSchema({schemaName:h,ifNotExist:T,comments:N,udfs:R,procedures:Q}){let ne=_(w.comment,{object:"SCHEMA",objectName:d(h),comment:E(N)}),Z=_(w.createSchema,{name:d(h),ifNotExist:T?" IF NOT EXISTS":"",comment:N?ne:""}),te=v(h,R),oe=O(h,Q);return n.chain([Z,te,oe]).compact().map(n.trim).join(`

`).trim().value()},createTable({name:h,columns:T,checkConstraints:N,foreignKeyConstraints:R,schemaData:Q,columnDefinitions:ne,keyConstraints:Z,inherits:te,description:oe,ifNotExist:he,usingMethod:Ae,on_commit:ye,partitioning:fe,storage_parameter:Fe,table_tablespace_name:ve,temporary:Ce,unlogged:Oe,selectStatement:Ne,triggers:Ee,partitionOf:se,partitionBounds:ie},Pe){let Wt=he?" IF NOT EXISTS":"",Et=f(h,Q.schemaName),Rc=_(w.comment,{object:"TABLE",objectName:Et,comment:E(oe)}),wc=c(Z.filter(({errorMessage:ke})=>!ke).map(x(w,Pe)),ke=>ke.statement),Pc=$(Z.filter(({errorMessage:ke})=>ke)),nt=`${b(wc,Pe)}${Pc}`,fs=se?nt==null?void 0:nt.slice(1):nt,Dc=c(R,ke=>ke.statement),hs=b(Dc,Pe),Lc=`
`+H(Et,ne),xc=se?w.createTablePartitionOf:w.createTable,Mc=se&&!nt?`
	`:`,
	`,gs=n.isEmpty(N)?"":l(n.join(N,`,
	`),Mc,""),_s=se&&!fs&&!gs&&!hs,qc=_s?"":"(",Fc=_s?"":")",kc=bf({statements:T,indent:`
	`}),$c=_(xc,{temporary:F(Ce,Oe),ifNotExist:Wt,name:Et,columnDefinitions:se?"":"	"+kc,keyConstraints:fs,checkConstraints:gs,foreignKeyConstraints:hs,options:K({inherits:te,partitioning:fe,usingMethod:Ae,on_commit:ye,storage_parameter:Fe,table_tablespace_name:ve,selectStatement:Ne,partitionBounds:ie}),comment:oe?Rc:"",partitionOf:se?` PARTITION OF ${se} `:"",columnDescriptions:Lc,openParenthesis:qc,closeParenthesis:Fc}),Bc=Se({dbVersion:Q.dbVersion,tableName:Et,triggers:Ee});return a([$c,Bc].map(n.trim).join(`

`).trim()+`
`,{isActivated:Pe})},convertColumnDefinition(h){let T=z(h.type,h.dbVersion),N=h.nullable?"":" NOT NULL",R=h.primaryKey?" "+x(w,!0)(h.primaryKeyOptions).statement:"",Q=h.unique?" "+x(w,!0)(h.uniqueKeyOptions).statement:"",ne=h.collationRule?` COLLATE "${h.collationRule}"`:"",Z=Array.isArray(h.array_type)&&h.array_type.length>0,te=n.isUndefined(h.default)?"":" DEFAULT "+M(T,h.default,Z);return a(_(w.columnDefinition,{name:d(h.name),type:I(T,h),notNull:N,primaryKey:R,uniqueKey:Q,collation:ne,defaultValue:te}),{isActivated:h.isActivated})},createIndex(h,T,N,R=!0){let Q=d(T.indxName),ne=T.unique&&T.index_method==="btree"?" UNIQUE":"",Z=T.concurrently?" CONCURRENTLY":"",te=T.ifNotExist?" IF NOT EXISTS":"",oe=T.only?" ONLY":"",he=T.index_method?` USING ${n.toUpper(T.index_method)}`:"",Ae=L(T.index_method==="btree"?T.columns:n.map(T.columns,fe=>n.omit(fe,"sortOrder","nullsOrder")),R),ye=S(T,R);return a(_(w.index,{unique:ne,concurrently:Z,ifNotExist:te,name:Q,only:oe,using:he,keys:Ae,options:ye,tableName:f(h,T.schemaName)}),{isActivated:T.isActivated})},createCheckConstraint(h){return _(w.checkConstraint,{name:h.name?`CONSTRAINT ${d(h.name)}`:"",expression:n.trim(h.expression).replace(/^\(([\s\S]*)\)$/,"$1")})},createForeignKeyConstraint({name:h,foreignKey:T,primaryTable:N,primaryKey:R,primaryTableActivated:Q,foreignTableActivated:ne,foreignSchemaName:Z,primarySchemaName:te,customProperties:oe,isActivated:he},Ae,ye){let fe=o(R),Fe=o(T),ve=!fe&&!Fe&&Q&&ne,{foreignOnDelete:Ce,foreignOnUpdate:Oe,foreignMatch:Ne,deferrable:Ee,deferrableConstraintCheckTime:se}=U(oe),ie=_(w.createForeignKeyConstraint,{primaryTable:f(N,te||ye.schemaName),name:h?`CONSTRAINT ${d(h)}`:"",foreignKey:ve?C(T):P(T),primaryKey:ve?C(R):P(R),onDelete:Ce?` ON DELETE ${Ce}`:"",onUpdate:Oe?` ON UPDATE ${Oe}`:"",match:Ne?` MATCH ${Ne}`:"",deferrable:Ee?` ${Ee}`:"",deferrableConstraintCheckTime:Ee==="DEFERRABLE"&&se?` ${se}`:""});return{statement:n.trim(ie),isActivated:ve&&he}},createForeignKey({name:h,foreignTable:T,foreignKey:N,primaryTable:R,primaryKey:Q,primaryTableActivated:ne,foreignTableActivated:Z,foreignSchemaName:te,primarySchemaName:oe,customProperties:he,isActivated:Ae},ye,fe){let Fe=o(Q),ve=o(N),Ce=!Fe&&!ve&&ne&&Z,{foreignOnDelete:Oe,foreignOnUpdate:Ne,foreignMatch:Ee,deferrable:se,deferrableConstraintCheckTime:ie}=U(he),Pe=_(w.createForeignKey,{primaryTable:f(R,oe||fe.schemaName),foreignTable:f(T,te||fe.schemaName),name:h?d(h):"",foreignKey:Ce?C(N):P(N),primaryKey:Ce?C(Q):P(Q),onDelete:Oe?` ON DELETE ${Oe}`:"",onUpdate:Ne?` ON UPDATE ${Ne}`:"",match:Ee?` MATCH ${Ee}`:"",deferrable:se?` ${se}`:"",deferrableConstraintCheckTime:se==="DEFERRABLE"&&ie?` ${ie}`:""});return{statement:n.trim(Pe),isActivated:Ce&&Ae}},createView(h,T,N){var Ne,Ee,se;let R=f(h.name,h.schemaName),Q=_(w.comment,{object:"VIEW",objectName:R,comment:E(h.comment)}),Z=o(h.keys||[])||!N,{columns:te,tables:oe}=g(h.keys),he=te.map(ie=>ie.statement).join(`,
		`);if(!Z){let ie=c(te,Wt=>Wt.statement),Pe=ie.deactivatedItems.length?a(ie.deactivatedItems.join(`,
		`),{isActivated:!1,isPartOfLine:!0}):"";he=ie.activatedItems.join(`,
		`)+Pe}let Ae=n.trim(h.selectStatement)?n.trim(s(h.selectStatement)):_(w.viewSelectStatement,{tableName:oe.join(", "),keys:he}),ye=(Ne=h.viewOptions)!=null&&Ne.check_option?`check_option=${(Ee=h.viewOptions)==null?void 0:Ee.check_option}`:"",fe=(se=h.viewOptions)!=null&&se.security_barrier?"security_barrier":"",Fe=ye||fe?`
	WITH (${n.compact([ye,fe]).join(",")})`:"",ve=i(ie=>ie.withCheckOption&&ie.checkTestingScope?`
	WITH ${ie.checkTestingScope} CHECK OPTION`:ie.withCheckOption?`
	WITH CHECK OPTION`:"","getCheckOption"),Ce=a(_(w.createView,{name:R,orReplace:h.orReplace?" OR REPLACE":"",temporary:h.temporary?" TEMPORARY":"",checkOption:ve(h),comment:h.comment?Q:"",withOptions:Fe,selectStatement:Ae}),{isActivated:!Z}),Oe=Se({dbVersion:h.dbVersion,tableName:R,triggers:h.triggers});return[Ce,Oe].map(n.trim).join(`

`).trim()+`
`},createViewIndex(){return""},createUdt(h){let T=n.map(h.properties,this.convertColumnDefinition);return Me(h,T)},getDefaultType(h){return Nf[h]},dropView(h){let T={viewName:h};return _(w.dropView,T)},getTypesDescriptors(){return Ro},hasType(h){return u(Ro,h)},hydrateDatabase({modelData:h}){return h=n.get(h,"0",{}),{databaseName:h.database_name,tablespace:h.tablespace_name,encoding:h.encoding,template:h.template,collate:h.LC_COLLATE,characterClassification:h.LC_CTYPE,dbVersion:h.dbVersion,locale:h.locale}},hydrateColumn({columnDefinition:h,jsonSchema:T,schemaData:N,definitionJsonSchema:R={},parentJsonSchema:Q}){let ne=n.includes(["char","varchar","text"],h.type)?T.collationRule:"",Z=["time","timestamp"],te=n.includes(Z,h.type)?T.timePrecision:"",oe=n.includes(Z,h.type)?T.timezone:"",he=h.type==="interval"?T.intervalOptions:"",Ae=N.dbVersion,ye=n.omit(V.hydratePrimaryKeyOptions(n.first(T.primaryKeyOptions)||{},h.name,h.isActivated,Q),"columns"),fe=n.omit(V.hydrateUniqueOptions(n.first(T.uniqueKeyOptions)||{},h.name,h.isActivated,Q),"columns");return{name:h.name,type:h.type,primaryKey:V.isInlinePrimaryKey(T),primaryKeyOptions:ye,unique:V.isInlineUnique(T),uniqueKeyOptions:fe,nullable:h.nullable,default:h.default,comment:T.refDescription||T.description||R.description,isActivated:h.isActivated,scale:h.scale,precision:h.precision,length:h.length,enum:T.enum,array_type:T.array_type,unit:T.unit,rangeSubtype:T.rangeSubtype,operatorClass:T.operatorClass,collation:T.collation,canonicalFunction:T.canonicalFunction,subtypeDiffFunction:T.subtypeDiffFunction,multiRangeType:T.multiRangeType,schemaName:N.schemaName,underlyingType:T.underlyingType,checkConstraints:T.checkConstraints,typeModifier:T.typeModifier,srid:T.srid,collationRule:ne,timePrecision:te,timezone:oe,intervalOptions:he,dbVersion:Ae}},hydrateJsonSchemaColumn(h,T){return!h.$ref||n.isEmpty(T)||qe(T)?h:(h=n.omit(h,"$ref"),{...T,...h})},hydrateIndex(h,T,N){return{...h,schemaName:N.schemaName}},hydrateViewIndex(h){return{}},hydrateCheckConstraint(h){return{name:h.chkConstrName,expression:h.constrExpression,noInherit:null}},hydrateSchema(h,T){let N=n.get(T,"modelData.0.dbVersion");return{schemaName:h.name,ifNotExist:h.ifNotExist,comments:h.description,udfs:(T==null?void 0:T.udfs)||[],procedures:(T==null?void 0:T.procedures)||[],dbVersion:N}},hydrateTable({tableData:h,entityData:T,jsonSchema:N}){let R=T[0],Q=[],ne=n.first(R.partitioning)||{},Z=V.getKeys(ne.compositePartitionKey,N),te="",oe=de(T,h.relatedSchemas);return{...h,triggers:oe,partitionOf:te,keyConstraints:V.getTableKeyConstraints(N),inherits:Q,selectStatement:n.trim(R.selectStatement),partitioning:n.assign({},ne,{compositePartitionKey:Z}),...n.pick(R,"temporary","unlogged","description","ifNotExist","usingMethod","on_commit","storage_parameter","table_tablespace_name","partitionBounds")}},hydrateViewColumn(h){return{name:h.name,tableName:h.entityName,alias:h.alias,isActivated:h.isActivated,dbName:h.dbName}},hydrateView({viewData:h,entityData:T,relatedSchemas:N}){let R=T[0],Q=de(T,N);return{name:h.name,keys:h.keys,comment:R.description,orReplace:R.orReplace,temporary:R.temporary,recursive:R.recursive,viewOptions:R.viewOptions,selectStatement:R.selectStatement,withCheckOption:R.withCheckOption,checkTestingScope:R.withCheckOption?R.checkTestingScope:"",schemaName:h.schemaData.schemaName,triggers:Q}},commentIfDeactivated(h,T,N){return h},alterColumnType(h,T,N,R){let Q=N;return R.length?Q+=`(${R.length})`:R.precision&&R.scale?Q+=`(${R.precision},${R.scale})`:R.precision&&(Q+=`(${R.precision})`),_(w.alterColumnType,{tableName:h,columnName:T,dataType:Q})},setNotNullConstraint(h,T){return _(w.addNotNullConstraint,{tableName:h,columnName:T})},dropNotNullConstraint(h,T){return _(w.dropNotNullConstraint,{tableName:h,columnName:T})},renameColumn(h,T,N){return _(w.renameColumn,{tableName:h,oldColumnName:T,newColumnName:N})},addCheckConstraint(h,T,N){let R={tableName:h,constraintName:T,expression:N};return _(w.addCheckConstraint,R)},dropConstraint(h,T){let N={tableName:h,constraintName:T};return _(w.dropConstraint,N)},updateTableComment(h,T){let N={tableName:h,comment:T};return _(w.updateCommentOnTable,N)},dropTableComment(h){let T={tableName:h,comment:"NULL"};return _(w.updateCommentOnTable,T)},updateColumnComment(h,T){let N={columnName:h,comment:T};return _(w.updateCommentOnColumn,N)},dropColumnComment(h){let T={columnName:h,comment:"NULL"};return _(w.updateCommentOnColumn,T)},updateSchemaComment(h,T){let N={schemaName:h,comment:T};return _(w.updateCommentOnSchema,N)},dropSchemaComment(h){let T={schemaName:h,comment:"NULL"};return _(w.updateCommentOnSchema,T)},updateViewComment(h,T){let N={viewName:h,comment:T};return _(w.updateCommentOnView,N)},dropViewComment(h){let T={viewName:h,comment:"NULL"};return _(w.updateCommentOnView,T)},createSchemaOnly(h){let T={schemaName:h};return _(w.createSchemaOnly,T)},dropSchema(h){let T={schemaName:h};return _(w.dropSchema,T)},dropTable(h){let T={tableName:h};return _(w.dropTable,T)},addColumn(h,T){let N={tableName:h,columnDefinition:T};return _(w.addColumn,N)},dropColumn(h,T){let N={tableName:h,columnName:T};return _(w.dropColumn,N)},dropDomain(h){let T={udtName:h};return _(w.dropDomain,T)},dropType(h){let T={udtName:h};return _(w.dropType,T)},alterTypeAddAttribute(h,T){let N={udtName:h,columnDefinition:T};return _(w.alterTypeAddAttribute,N)},alterTypeDropAttribute(h,T){let N={udtName:h,attributeName:T};return _(w.alterTypeDropAttribute,N)},alterTypeRenameAttribute(h,T,N){let R={udtName:h,oldAttributeName:T,newAttributeName:N};return _(w.alterTypeRenameAttribute,R)},alterTypeChangeAttributeType(h,T,N){let R={udtName:h,attributeName:T,newDataType:N};return _(w.alterTypeChangeAttributeType,R)},dropForeignKey(h,T){let N={tableName:h,fkConstraintName:T};return _(w.dropForeignKey,N)},createKeyConstraint(h,T,N){let R=x(w,T)(N);return{statement:_(w.addPkConstraint,{constraintStatement:(R.statement||"").trim(),tableName:h}),isActivated:R.isActivated}},dropPkConstraint(h,T){let N={tableName:h,constraintName:T};return _(w.dropConstraint,N)}}}});var Lo=A((oE,Do)=>{"use strict";var{AlterScriptDto:Po}=ae(),{getModifySchemaCommentsScriptDtos:vf}=za(),Of=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{wrapInQuotes:s}=B()(r),a=n.createSchemaOnly(s(e));return Po.getInstance([a],!0,!1)},"getAddContainerScriptDto"),If=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{wrapInQuotes:s}=B()(r),a=n.dropSchema(s(e));return Po.getInstance([a],!0,!1)},"getDeleteContainerScriptDto"),Rf=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t);return[...vf(r,n)(e)]},"getModifyContainerScriptDtos");Do.exports={getAddContainerScriptDto:Of,getDeleteContainerScriptDto:If,getModifyContainerScriptDtos:Rf}});var we=A((uE,xo)=>{"use strict";var Vn=class Vn{id;constraintName;indexStorageParameters;indexTablespace;indexInclude};i(Vn,"AlterCollectionColumnPrimaryKeyOptionDto");var kn=Vn,Hn=class Hn{type;isActivated;primaryKey;unique;mode;length;compositeKey;compositePartitionKey;compositePrimaryKey;compositeUniqueKey;primaryKeyOptions;triggerUpdateColumns;compMod;GUID};i(Hn,"AlterCollectionColumnDto");var $n=Hn,Qn=class Qn extends kn{compositePrimaryKey};i(Qn,"AlterCollectionRoleCompModPKDto");var Bn=Qn,Yn=class Yn{new;old};i(Yn,"AlterCollectionRoleCompModPrimaryKey");var Un=Yn,Wn=class Wn{id;type;collectionName;properties;definitions;isActivated;additionalProperties;memory_optimized;collectionUsers;ifNotExist;on_commit;table_tablespace_name;bucketId;compMod;name;roleType;patternProperties};i(Wn,"AlterCollectionRoleDto");var Kn=Wn,jn=class jn{type;isActivated;unique;subtype;properties;compositeKey;compositePartitionKey;compositePrimaryKey;compositeUniqueKey;triggerUpdateColumns;role;GUID};i(jn,"AlterCollectionDto");var Gn=jn;xo.exports={AlterCollectionDto:Gn,AlterCollectionRoleDto:Kn,AlterCollectionColumnDto:$n,AlterCollectionRoleCompModPrimaryKey:Un,AlterCollectionRoleCompModPKDto:Bn}});var qo=A((mE,Mo)=>{"use strict";var{AlterCollectionDto:pE}=we(),{AlterScriptDto:Gt}=ae(),wf=i(t=>e=>{var o;let r=(o=e==null?void 0:e.compMod)==null?void 0:o.chkConstr;if(!r)return[];let n=r.new||[],s=r.old||[];return t.chain([...n,...s]).map(c=>c.chkConstrName).uniq().value().map(c=>({old:t.find(s,{chkConstrName:c}),new:t.find(n,{chkConstrName:c})}))},"mapCheckConstraintNamesToChangeHistory"),Pf=i((t,e)=>(r,n)=>{let{wrapInQuotes:s}=B()(t);return r.filter(a=>a.old&&!a.new).map(a=>{let o=s(a.old.chkConstrName);return e.dropConstraint(n,o)}).map(a=>Gt.getInstance([a],!0,!0))},"getDropCheckConstraintScriptDtos"),Df=i((t,e)=>(r,n)=>{let{wrapInQuotes:s}=B()(t);return r.filter(a=>a.new&&!a.old).map(a=>{let{chkConstrName:o,constrExpression:c}=a.new;return e.addCheckConstraint(n,s(o),c)}).map(a=>Gt.getInstance([a],!0,!1))},"getAddCheckConstraintScriptDtos"),Lf=i((t,e)=>(r,n)=>{let{wrapInQuotes:s}=B()(t);return r.filter(a=>{if(a.old&&a.new){let o=a.old.constrExpression,c=a.new.constrExpression;return o!==c}return!1}).map(a=>{let{chkConstrName:o}=a.old,c=e.dropConstraint(n,s(o)),{chkConstrName:u,constrExpression:l}=a.new,m=e.addCheckConstraint(n,s(u),l);return[Gt.getInstance([c],!0,!0),Gt.getInstance([m],!0,!1)]}).flat()},"getUpdateCheckConstraintScriptDtos"),xf=i((t,e)=>r=>{let{getFullTableName:n}=B()(t),s=n(r),a=wf(t)(r),o=Df(t,e)(a,s),c=Pf(t,e)(a,s),u=Lf(t,e)(a,s);return[...o,...c,...u]},"getModifyCheckConstraintScriptDtos");Mo.exports={getModifyCheckConstraintScriptDtos:xf}});var $o=A((hE,ko)=>{"use strict";var{AlterCollectionDto:fE}=we(),{AlterScriptDto:Fo}=ae(),Mf=i((t,e)=>r=>{var p;let{getFullTableName:n,wrapComment:s}=B()(t),a=(p=r==null?void 0:r.role.compMod)==null?void 0:p.description;if(!a)return;let{old:o,new:c}=a;if(!c||c===o)return;let u=n(r),l=s(c),m=e.updateTableComment(u,l);return Fo.getInstance([m],!0,!1)},"getUpdatedCommentOnCollectionScriptDto"),qf=i((t,e)=>r=>{var l;let{getFullTableName:n}=B()(t),s=(l=r==null?void 0:r.role.compMod)==null?void 0:l.description;if(!s)return"";let{old:a,new:o}=s;if(!a||o)return"";let c=n(r),u=e.dropTableComment(c);return Fo.getInstance([u],!0,!0)},"getDeletedCommentOnCollectionScriptDto"),Ff=i((t,e)=>r=>{let n=Mf(t,e)(r),s=qf(t,e)(r);return[n,s].filter(Boolean)},"getModifyEntityCommentsScriptDtos");ko.exports={getModifyEntityCommentsScriptDtos:Ff}});var Uo=A((EE,Bo)=>{"use strict";var{AlterCollectionDto:_E,AlterCollectionColumnDto:yE}=we(),{AlterScriptDto:kf}=ae(),$f=i((t,e,r)=>{let n=t.role.properties[e],s=n==null?void 0:n.length,a=r==null?void 0:r.length;return s!==a},"hasLengthChanged"),Bf=i((t,e,r)=>{let n=t.role.properties[e],s=n==null?void 0:n.precision,a=r==null?void 0:r.precision,o=n==null?void 0:n.scale,c=r==null?void 0:r.scale;return s!==a||o!==c},"hasPrecisionOrScaleChanged"),Uf=i((t,e)=>r=>{let{getFullTableName:n,checkFieldPropertiesChanged:s,wrapInQuotes:a}=B()(t),o=n(r);return t.toPairs(r.properties).filter(([c,u])=>{let l=s(u.compMod,["type","mode"]);if(!l){let m=u.compMod.oldField.name,p=$f(r,m,u),d=Bf(r,m,u);return p||d}return l}).map(([c,u])=>{let l=u.compMod.newField.mode||u.compMod.newField.type,m=a(c),p=t.pick(u,["length","precision","scale"]);return e.alterColumnType(o,m,l,p)}).map(c=>kf.getInstance([c],!0,!1))},"getUpdateTypesScriptDtos");Bo.exports={getUpdateTypesScriptDtos:Uf}});var Vo=A((AE,Go)=>{"use strict";var{AlterCollectionDto:SE}=we(),{AlterScriptDto:Ko}=ae(),Kf=i((t,e)=>r=>{let{getFullTableName:n,wrapInQuotes:s}=B()(t),a=n(r),o=r.required||[],c=r.role.required||[],u=t.difference(o,c),l=t.difference(c,o),m=t.toPairs(r.properties).filter(([d,f])=>{let y=f.compMod.oldField.name,g=l.includes(y);return u.includes(d)&&!g}).map(([d])=>e.setNotNullConstraint(a,s(d))).map(d=>Ko.getInstance([d],!0,!1)),p=t.toPairs(r.properties).filter(([d,f])=>{let y=f.compMod.oldField.name,g=l.includes(y),E=u.includes(d);return g&&!E}).map(([d])=>e.dropNotNullConstraint(a,s(d))).map(d=>Ko.getInstance([d],!0,!0));return[...m,...p]},"getModifyNonNullColumnsScriptDtos");Go.exports={getModifyNonNullColumnsScriptDtos:Kf}});var Yo=A((bE,Qo)=>{"use strict";var{AlterCollectionDto:NE}=we(),{AlterScriptDto:Ho}=ae(),Gf=i((t,e)=>r=>{let{getFullColumnName:n,wrapComment:s}=B()(t);return t.toPairs(r.properties).filter(([a,o])=>{var m;let c=o.description,u=o.compMod.oldField.name,l=(m=r.role.properties[u])==null?void 0:m.description;return c&&(!l||c!==l)}).map(([a,o])=>{let c=o.description,u=s(c),l=n(r,a);return e.updateColumnComment(l,u)}).map(a=>Ho.getInstance([a],!0,!1))},"getUpdatedCommentOnColumnScriptDtos"),Vf=i((t,e)=>r=>{let{getFullColumnName:n}=B()(t);return t.toPairs(r.properties).filter(([s,a])=>{var l;let o=a.description,c=a.compMod.oldField.name;return((l=r.role.properties[c])==null?void 0:l.description)&&!o}).map(([s,a])=>{let o=n(r,s);return e.dropColumnComment(o)}).map(s=>Ho.getInstance([s],!0,!0))},"getDeletedCommentOnColumnScriptDtos"),Hf=i((t,e)=>r=>{let n=Gf(t,e)(r),s=Vf(t,e)(r);return[...n,...s]},"getModifiedCommentOnColumnScriptDtos");Qo.exports={getModifiedCommentOnColumnScriptDtos:Hf}});var jo=A((IE,Wo)=>{"use strict";var{AlterCollectionDto:OE}=we(),{AlterScriptDto:Qf}=ae(),Yf=i((t,e)=>r=>{let{getFullTableName:n,wrapInQuotes:s,checkFieldPropertiesChanged:a}=B()(t),o=n(r);return t.values(r.properties).filter(c=>a(c.compMod,["name"])).map(c=>{let u=s(c.compMod.oldField.name),l=s(c.compMod.newField.name);return e.renameColumn(o,u,l)}).map(c=>Qf.getInstance([c],!0,!1))},"getRenameColumnScriptDtos");Wo.exports={getRenameColumnScriptDtos:Yf}});var ec=A((ME,Zo)=>{"use strict";var{AlterScriptDto:Wf}=ae(),{AlterCollectionDto:wE,AlterCollectionColumnDto:PE,AlterCollectionRoleCompModPKDto:DE,AlterCollectionColumnPrimaryKeyOptionDto:LE,AlterCollectionRoleCompModPrimaryKey:xE}=we(),et=1,Xn=class Xn{didTransitionHappen;wasPkChangedInTransition;static noTransition(){return{didTransitionHappen:!1}}static transition(e){return{didTransitionHappen:!0,wasPkChangedInTransition:e}}};i(Xn,"PkTransitionDto");var ue=Xn,Jn=class Jn{script;isDropScript;fullTableName;isActivated;constructor(e,r,n,s){this.script=e,this.isDropScript=n,this.fullTableName=r,this.isActivated=s}};i(Jn,"PkScriptModificationDto");var tt=Jn,zn=i(t=>`${t}_pkey`,"getDefaultConstraintName"),zo=i(t=>({constraintName:t.constraintName,indexStorageParameters:t.indexStorageParameters,indexTablespace:t.indexTablespace,indexInclude:t.indexInclude}),"extractOptionsForComparisonWithRegularPkOptions"),rt=i(t=>(t.primaryKeyOptions||[]).map(r=>zo(r)),"getCustomPropertiesOfRegularPkForComparisonWithRegularPkOptions"),Vt=i(t=>[zo(t)].filter(r=>Object.values(r).some(Boolean)),"getCustomPropertiesOfCompositePkForComparisonWithRegularPkOptions"),jf=i(t=>e=>{var m,p;let n=(((p=(m=e==null?void 0:e.role)==null?void 0:m.compMod)==null?void 0:p.primaryKey)||{}).old||[],s=n.flatMap(d=>d.compositePrimaryKey.map(f=>f.keyId));if(s.length!==et)return ue.noTransition();let a=s[0],o=Object.values(e.properties).find(d=>d.GUID===a);if(!o||!((o==null?void 0:o.primaryKey)&&!(o!=null&&o.compositePrimaryKey)))return ue.noTransition();let u=rt(o),l=n.some(d=>{if(d.compositePrimaryKey.length!==et)return!1;let f=Vt(d);return t(f).differenceWith(u,t.isEqual).isEmpty()});return ue.transition(!l)},"wasCompositePkChangedInTransitionFromCompositeToRegular"),zf=i(t=>e=>{var m,p;let n=(((p=(m=e==null?void 0:e.role)==null?void 0:m.compMod)==null?void 0:p.primaryKey)||{}).new||[],s=n.flatMap(d=>d.compositePrimaryKey.map(f=>f.keyId));if(s.length!==et)return ue.noTransition();let a=s[0],o=Object.values(e.role.properties).find(d=>d.GUID===a);if(!o||!((o==null?void 0:o.primaryKey)&&!(o!=null&&o.compositePrimaryKey)))return ue.noTransition();let u=rt(o),l=n.some(d=>{if(d.compositePrimaryKey.length!==et)return!1;let f=Vt(d);return t(f).differenceWith(u,t.isEqual).isEmpty()});return ue.transition(!l)},"wasCompositePkChangedInTransitionFromRegularToComposite"),Xf=i((t,e)=>t.constraintName?t.constraintName:zn(e),"getConstraintNameForCompositePk"),Jf=i(t=>(e,r,n)=>{let s=Xf(e,r),a=t.toPairs(n.role.properties).filter(([l,m])=>!!e.compositePrimaryKey.find(p=>p.keyId===m.GUID)).map(([l,m])=>({name:l,isActivated:m.isActivated})),o="",c="",u=[];return e.indexStorageParameters&&(o=e.indexStorageParameters),e.indexTablespace&&(c=e.indexTablespace),e.indexInclude&&(u=t.toPairs(n.role.properties).filter(([l,m])=>!!e.indexInclude.find(p=>p.keyId===m.GUID)).map(([l,m])=>({name:l,isActivated:m.isActivated}))),{name:s,keyType:"PRIMARY KEY",columns:a,include:u,storageParameters:o,tablespace:c}},"getCreateCompositePKDDLProviderConfig"),Zf=i((t,e)=>r=>{var f,y;let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:a}=B()(t),o=((y=(f=r==null?void 0:r.role)==null?void 0:f.compMod)==null?void 0:y.primaryKey)||{},c=o.new||[],u=o.old||[];if(c.length===0&&u.length===0)return[];let l=zf(t)(r);if(l.didTransitionHappen&&!l.wasPkChangedInTransition)return[];if(c.length===u.length&&t(u).differenceWith(c,t.isEqual).isEmpty())return[];let m=s(r),p=n(m),d=a(m);return c.map(g=>{let E=Jf(t)(g,d,r),_=e.createKeyConstraint(p,r.isActivated,E);return new tt(_.statement,p,!1,_.isActivated)}).filter(g=>!!g.script)},"getAddCompositePkScriptDtos"),eh=i((t,e)=>r=>{var y,g;let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:a,wrapInQuotes:o}=B()(t),c=((g=(y=r==null?void 0:r.role)==null?void 0:y.compMod)==null?void 0:g.primaryKey)||{},u=c.new||[],l=c.old||[];if(u.length===0&&l.length===0)return[];let m=jf(t)(r);if(m.didTransitionHappen&&!m.wasPkChangedInTransition)return[];if(u.length===l.length&&t(l).differenceWith(u,t.isEqual).isEmpty())return[];let p=s(r),d=n(p),f=a(p);return l.map(E=>{let _=zn(f);E.constraintName&&(_=E.constraintName);let b=o(_),C=e.dropPkConstraint(d,b);return new tt(C,d,!0,r.isActivated)}).filter(E=>!!E.script)},"getDropCompositePkScriptDtos"),th=i((t,e)=>r=>{let n=eh(t,e)(r),s=Zf(t,e)(r);return[...n,...s].filter(Boolean)},"getModifyCompositePkScriptDtos"),Xo=i((t,e)=>{let r=t.primaryKeyOptions;if(r!=null&&r.length&&(r==null?void 0:r.length)>0){let n=r[0];if(n.constraintName)return n.constraintName}return zn(e)},"getConstraintNameForRegularPk"),rh=i(t=>(e,r,n,s)=>{let a=Xo(r,n),o=[{name:e,isActivated:r.isActivated}],c="",u="",l=[],m=r.primaryKeyOptions;if(m!=null&&m.length&&(m==null?void 0:m.length)>0){let p=m[0];p.indexStorageParameters&&(c=p.indexStorageParameters),p.indexTablespace&&(u=p.indexTablespace),p.indexInclude&&(l=t.toPairs(s.role.properties).filter(([d,f])=>!!p.indexInclude.find(y=>y.keyId===f.GUID)).map(([d,f])=>({name:d,isActivated:f.isActivated})))}return{name:a,keyType:"PRIMARY KEY",columns:o,include:l,storageParameters:c,tablespace:u}},"getCreateRegularPKDDLProviderConfig"),nh=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n],a=e.primaryKey&&!e.compositePrimaryKey,o=!!(s!=null&&s.primaryKey);return a&&!o},"wasFieldChangedToBeARegularPk"),sh=i(t=>(e,r)=>{var f,y;let n=e.compMod.oldField.name,s=r.role.properties[n],a=e.primaryKey&&!e.compositePrimaryKey,o=!!(s!=null&&s.primaryKey);if(!(a&&o))return ue.noTransition();let c=((y=(f=r==null?void 0:r.role)==null?void 0:f.compMod)==null?void 0:y.primaryKey)||{},u=c.new||[],l=c.old||[],m=l.some(g=>g.compositePrimaryKey.some(E=>E.keyId===s.GUID)),p=u.some(g=>g.compositePrimaryKey.some(E=>E.keyId===e.GUID));if(a&&(m&&!p)){let g=rt(e),E=l.some(_=>{if(_.compositePrimaryKey.length!==et)return!1;let b=Vt(_);return t(b).differenceWith(g,t.isEqual).isEmpty()});return ue.transition(!E)}return ue.noTransition()},"wasRegularPkChangedInTransitionFromCompositeToRegular"),ih=i(t=>(e,r)=>{var f,y;let n=e.compMod.oldField.name,s=r.role.properties[n],a=s.primaryKey&&!s.compositePrimaryKey,o=!!(e!=null&&e.primaryKey);if(!(a&&o))return ue.noTransition();let c=((y=(f=r==null?void 0:r.role)==null?void 0:f.compMod)==null?void 0:y.primaryKey)||{},u=c.new||[],m=(c.old||[]).some(g=>g.compositePrimaryKey.some(E=>E.keyId===s.GUID)),d=u.some(g=>g.compositePrimaryKey.some(E=>E.keyId===e.GUID))&&!m;if(a&&d){let g=rt(s),E=u.some(_=>{if(_.compositePrimaryKey.length!==et)return!1;let b=Vt(_);return t(b).differenceWith(g,t.isEqual).isEmpty()});return ue.transition(!E)}return ue.noTransition()},"wasRegularPkChangedInTransitionFromRegularToComposite"),ah=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n],a=(s==null?void 0:s.primaryKey)&&!(s!=null&&s.compositePrimaryKey),o=!e.primaryKey&&!e.compositePrimaryKey;return a&&o},"isFieldNoLongerARegularPk"),Jo=i(t=>(e,r)=>{let n=e.compMod.oldField.name,s=r.role.properties[n]||{},a=e.primaryKey&&!e.compositePrimaryKey,o=(s==null?void 0:s.primaryKey)&&!(s!=null&&s.compositePrimaryKey);if(!(a&&o))return!1;let c=rt(e),u=rt(s);return!t(u).differenceWith(c,t.isEqual).isEmpty()},"wasRegularPkModified"),oh=i((t,e)=>r=>{let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:a}=B()(t),o=s(r),c=n(o),u=a(o);return t.toPairs(r.properties).filter(([l,m])=>{if(nh(t)(m,r))return!0;let p=sh(t)(m,r);return p.didTransitionHappen?p.wasPkChangedInTransition:Jo(t)(m,r)}).map(([l,m])=>{let p=rh(t)(l,m,u,r),d=e.createKeyConstraint(c,r.isActivated,p);return new tt(d.statement,c,!1,d.isActivated)}).filter(l=>!!l.script)},"getAddPkScriptDtos"),ch=i((t,e)=>r=>{let{getFullCollectionName:n,getSchemaOfAlterCollection:s,getEntityName:a,wrapInQuotes:o}=B()(t),c=s(r),u=n(c),l=a(c);return t.toPairs(r.properties).filter(([m,p])=>{if(ah(t)(p,r))return!0;let d=ih(t)(p,r);return d.didTransitionHappen?d.wasPkChangedInTransition:Jo(t)(p,r)}).map(([m,p])=>{let d=p.compMod.oldField.name,f=r.role.properties[d],y=o(Xo(f,l)),g=e.dropPkConstraint(u,y);return new tt(g,u,!0,r.isActivated)}).filter(m=>!!m.script)},"getDropPkScriptDto"),uh=i((t,e)=>r=>{let n=ch(t,e)(r),s=oh(t,e)(r);return[...n,...s].filter(Boolean)},"getModifyPkScriptDtos"),lh=i(t=>t.sort((e,r)=>e.fullTableName===r.fullTableName?Number(r.isDropScript)-Number(e.isDropScript):e.fullTableName<r.fullTableName),"sortModifyPkConstraints"),ph=i((t,e)=>r=>{let n=th(t,e)(r),s=uh(t,e)(r),a=[...n,...s];return lh(a).map(c=>Wf.getInstance([c.script],c.isActivated,c.isDropScript)).filter(Boolean)},"getModifyPkConstraintsScriptDtos");Zo.exports={getModifyPkConstraintsScriptDtos:ph}});var yt=A((FE,tc)=>{"use strict";tc.exports=t=>{let{createColumnDefinition:e}=t.require("@hackolade/ddl-fe-utils"),r=i(s=>s.$ref?s.$ref.split("/").pop():s.mode||s.childType||s.type,"getType");return{createColumnDefinitionBySchema:i(({name:s,jsonSchema:a,parentJsonSchema:o,ddlProvider:c,schemaData:u,definitionJsonSchema:l})=>e({name:s,jsonSchema:a,parentJsonSchema:o,ddlProvider:c,schemaData:u,definitionJsonSchema:l,getType:r}),"createColumnDefinitionBySchema")}}});var nc=A((BE,rc)=>{"use strict";var{AlterCollectionDto:$E}=we(),{AlterScriptDto:Ht}=ae(),{getModifyCheckConstraintScriptDtos:mh}=qo(),{getModifyEntityCommentsScriptDtos:dh}=$o(),{getUpdateTypesScriptDtos:fh}=Uo(),{getModifyNonNullColumnsScriptDtos:hh}=Vo(),{getModifiedCommentOnColumnScriptDtos:gh}=Yo(),{getRenameColumnScriptDtos:_h}=jo(),{getModifyPkConstraintsScriptDtos:yh}=ec(),Eh=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>a=>{let o=t.require("lodash"),{getEntityName:c}=B()(o),{createColumnDefinitionBySchema:u}=yt()(t),l=ee()(null,null,t),{getDefinitionByReference:m}=t.require("@hackolade/ddl-fe-utils"),d={schemaName:a.compMod.keyspaceName,dbVersion:e},f={...a,...o.omit(a==null?void 0:a.role,"properties")||{}},y=o.toPairs(f.properties).map(([C,P])=>{let x=m({propertySchema:P,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return u({name:C,jsonSchema:P,parentJsonSchema:f,ddlProvider:l,schemaData:d,definitionJsonSchema:x})}),g=(f.chkConstr||[]).map(C=>l.createCheckConstraint(l.hydrateCheckConstraint(C))),E={name:c(f),columns:y.map(l.convertColumnDefinition),checkConstraints:g,foreignKeyConstraints:[],schemaData:d,columnDefinitions:y},_=l.hydrateTable({tableData:E,entityData:[f],jsonSchema:f}),b=l.createTable(_,f.isActivated);return Ht.getInstance([b],!0,!1)},"getAddCollectionScriptDto"),Th=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{getFullTableName:s}=B()(r),a=s(e),o=n.dropTable(a);return Ht.getInstance([o],!0,!0)},"getDeleteCollectionScriptDto"),Sh=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),s=mh(r,n)(e),a=dh(r,n)(e),o=yh(r,n)(e);return[...s,...a,...o]},"getModifyCollectionScriptDtos"),Ah=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>a=>{var _;let o=t.require("lodash"),{getEntityName:c,getNamePrefixedWithSchemaName:u}=B()(o),{createColumnDefinitionBySchema:l}=yt()(t),m=ee()(null,null,t),{getDefinitionByReference:p}=t.require("@hackolade/ddl-fe-utils"),d={...a,...o.omit(a==null?void 0:a.role,"properties")||{}},f=c(d),y=(_=d.compMod)==null?void 0:_.keyspaceName,g=u(f,y),E={schemaName:y,dbVersion:e};return o.toPairs(a.properties).filter(([b,C])=>!C.compMod).map(([b,C])=>{let P=p({propertySchema:C,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return l({name:b,jsonSchema:C,parentJsonSchema:d,ddlProvider:m,schemaData:E,definitionJsonSchema:P})}).map(m.convertColumnDefinition).map(b=>m.addColumn(g,b)).map(b=>Ht.getInstance([b],!0,!1))},"getAddColumnScriptDtos"),Ch=i(t=>e=>{var p;let r=t.require("lodash"),{getEntityName:n,getNamePrefixedWithSchemaName:s,wrapInQuotes:a}=B()(r),o=ee()(null,null,t),c={...e,...r.omit(e==null?void 0:e.role,"properties")||{}},u=n(c),l=(p=c.compMod)==null?void 0:p.keyspaceName,m=s(u,l);return r.toPairs(e.properties).filter(([d,f])=>!f.compMod).map(([d])=>o.dropColumn(m,a(d))).map(d=>Ht.getInstance([d],!0,!0))},"getDeleteColumnScriptDtos"),Nh=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),s=_h(r,n)(e),a=fh(r,n)(e),o=hh(r,n)(e),c=gh(r,n)(e);return[...s,...a,...o,...c]},"getModifyColumnScriptDtos");rc.exports={getAddCollectionScriptDto:Eh,getDeleteCollectionScriptDto:Th,getModifyCollectionScriptDtos:Sh,getAddColumnScriptDtos:Ah,getDeleteColumnScriptDtos:Ch,getModifyColumnScriptDtos:Nh}});var ic=A((KE,sc)=>{"use strict";var{AlterScriptDto:Ke}=ae(),bh=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>a=>{let o=t.require("lodash"),{createColumnDefinitionBySchema:c}=yt()(t),u=ee()(null,null,t),{getDefinitionByReference:l}=t.require("@hackolade/ddl-fe-utils"),m={dbVersion:e},p=o.toPairs(a.properties||{}).map(([g,E])=>{let _=l({propertySchema:E,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return c({name:g,jsonSchema:E,parentJsonSchema:a,ddlProvider:u,schemaData:m,definitionJsonSchema:_})}),f={...c({name:a.code||a.name,jsonSchema:a,parentJsonSchema:{required:[]},definitionJsonSchema:{},ddlProvider:u,schemaData:m}),properties:p},y=u.createUdt(f);return Ke.getInstance([y],!0,!1)},"getCreateUdtScriptDto"),vh=i(t=>e=>{let r=t.require("lodash"),{wrapInQuotes:n,getUdtName:s}=B()(r),a=ee()(null,null,t),o=s(e),c=n(o);if(e.type==="domain"){let u=a.dropDomain(c);return Ke.getInstance([u],!0,!0)}else{let u=a.dropType(c);return Ke.getInstance([u],!0,!0)}},"getDeleteUdtScriptDto"),Oh=i(({app:t,dbVersion:e,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s})=>a=>{let o=t.require("lodash"),{createColumnDefinitionBySchema:c}=yt()(t),{wrapInQuotes:u,getUdtName:l}=B()(o),m=ee()(null,null,t),{getDefinitionByReference:p}=t.require("@hackolade/ddl-fe-utils"),d=u(l(a)),f={dbVersion:e};return o.toPairs(a.properties).filter(([y,g])=>!g.compMod).map(([y,g])=>{let E=p({propertySchema:g,modelDefinitions:r,internalDefinitions:n,externalDefinitions:s});return c({name:y,jsonSchema:g,parentJsonSchema:{required:[]},ddlProvider:m,schemaData:f,definitionJsonSchema:E})}).map(m.convertColumnDefinition).map(y=>m.alterTypeAddAttribute(d,y)).map(y=>Ke.getInstance([y],!0,!1))},"getAddColumnToTypeScriptDtos"),Ih=i(t=>e=>{let r=t.require("lodash"),{wrapInQuotes:n,getUdtName:s}=B()(r),a=ee()(null,null,t),o=n(s(e));return r.toPairs(e.properties).filter(([c,u])=>!u.compMod).map(([c])=>a.alterTypeDropAttribute(o,n(c))).map(c=>Ke.getInstance([c],!0,!0))},"getDeleteColumnFromTypeScriptDtos"),Rh=i(t=>e=>{let r=t.require("lodash"),{checkFieldPropertiesChanged:n,wrapInQuotes:s,getUdtName:a}=B()(r),o=ee()(null,null,t),c=s(a(e)),u=r.values(e.properties).filter(m=>n(m.compMod,["name"])).map(m=>{let p=s(m.compMod.oldField.name),d=s(m.compMod.newField.name);return o.alterTypeRenameAttribute(c,p,d)}).map(m=>Ke.getInstance([m],!0,!1)),l=r.toPairs(e.properties).filter(([m,p])=>n(p.compMod,["type","mode"])).map(([m,p])=>{let d=s(m),f=p.compMod.newField.mode||p.compMod.newField.type;return o.alterTypeChangeAttributeType(c,d,f)}).map(m=>Ke.getInstance([m],!0,!1));return[...u,...l]},"getModifyColumnOfTypeScriptDtos");sc.exports={getCreateUdtScriptDto:bh,getDeleteUdtScriptDto:vh,getAddColumnToTypeScriptDtos:Oh,getDeleteColumnFromTypeScriptDtos:Ih,getModifyColumnOfTypeScriptDtos:Rh}});var oc=A((VE,ac)=>{"use strict";var as=class as{isActivated;name};i(as,"AlterRelationshipFKField");var Zn=as,os=class os{bucket;collection};i(os,"AlterRelationshipParentDto");var es=os,cs=class cs{bucket;collection};i(cs,"AlterRelationshipChildDto");var ts=cs,us=class us{relationshipOnDelete;relationshipOnUpdate;relationshipMatch};i(us,"AlterRelationshipCustomProperties");var rs=us,ls=class ls{created;deleted;modified;parent;child;name;description;customProperties;isActivated};i(ls,"AlterRelationshipRoleCompModDto");var ns=ls,ps=class ps{id;name;relationshipType;parentField;parentCardinality;childField;isActivated;childCardinality;parentCollection;childCollection;hackoladeStyles;compMod;roleType};i(ps,"AlterRelationshipRoleDto");var ss=ps,ms=class ms{type;isActivated;unique;subtype;compositeKey;compositePartitionKey;compositePrimaryKey;compositeUniqueKey;triggerUpdateColumns;role;GUID};i(ms,"AlterRelationshipDto");var is=ms;ac.exports={AlterRelationshipRoleCompModDto:ns,AlterRelationshipRoleDto:ss,AlterRelationshipDto:is,AlterRelationshipFKField:Zn,AlterRelationshipParentDto:es,AlterRelationshipChildDto:ts,AlterRelationshipCustomProperties:rs}});var dc=A((YE,mc)=>{"use strict";var{AlterScriptDto:ds}=ae(),{AlterRelationshipDto:QE}=oc(),Qt=i(t=>t.role.name,"getRelationshipName"),wh=i(t=>e=>{let{getNamePrefixedWithSchemaName:r}=B()(t),n=e.role.compMod,s=n.child.bucket.name,a=n.child.collection.name;return r(a,s)},"getFullChildTableName"),cc=i((t,e)=>r=>{var a,o,c,u,l;let n=r.role.compMod,s=((a=n.name)==null?void 0:a.new)||Qt(r)||"";return t.createForeignKey({name:s,foreignKey:n.child.collection.fkFields,primaryKey:n.parent.collection.fkFields,customProperties:(o=n.customProperties)==null?void 0:o.new,foreignTable:n.child.collection.name,foreignSchemaName:n.child.bucket.name,foreignTableActivated:n.child.collection.isActivated,primaryTable:n.parent.collection.name,primarySchemaName:n.parent.bucket.name,primaryTableActivated:n.parent.collection.isActivated,isActivated:!!((l=(u=(c=r.role)==null?void 0:c.compMod)==null?void 0:u.isActivated)!=null&&l.new)})},"getAddSingleForeignKeyStatementDto"),uc=i(t=>{var r,n,s,a,o,c,u,l,m,p,d;let e=t.role.compMod;return e?[((r=e.name)==null?void 0:r.new)||Qt(t),(n=e.parent)==null?void 0:n.bucket,(s=e.parent)==null?void 0:s.collection,(c=(o=(a=e.parent)==null?void 0:a.collection)==null?void 0:o.fkFields)==null?void 0:c.length,(u=e.child)==null?void 0:u.bucket,(l=e.child)==null?void 0:l.collection,(d=(p=(m=e.child)==null?void 0:m.collection)==null?void 0:p.fkFields)==null?void 0:d.length].every(f=>!!f):!1},"canRelationshipBeAdded"),Ph=i((t,e)=>r=>r.filter(n=>uc(n)).map(n=>{let s=cc(t,e)(n);return ds.getInstance([s.statement],s.isActivated,!1)}).filter(Boolean).filter(n=>n.scripts.some(s=>!!s.script)),"getAddForeignKeyScriptDtos"),lc=i((t,e)=>r=>{var p,d,f,y;let{wrapInQuotes:n}=B()(e),s=r.role.compMod,a=wh(e)(r),o=((p=s.name)==null?void 0:p.old)||Qt(r)||"",c=n(o),u=t.dropForeignKey(a,c),l=!!((y=(f=(d=r.role)==null?void 0:d.compMod)==null?void 0:f.isActivated)!=null&&y.new),m=s.child.collection.isActivated;return{statement:u,isActivated:l&&m}},"getDeleteSingleForeignKeyStatementDto"),pc=i(t=>{var r,n,s;let e=t.role.compMod;return e?[((r=e.name)==null?void 0:r.old)||Qt(t),(n=e.child)==null?void 0:n.bucket,(s=e.child)==null?void 0:s.collection].every(a=>!!a):!1},"canRelationshipBeDeleted"),Dh=i((t,e)=>r=>r.filter(n=>pc(n)).map(n=>{let s=lc(t,e)(n);return ds.getInstance([s.statement],s.isActivated,!0)}).filter(Boolean).filter(n=>n.scripts.some(s=>!!s.script)),"getDeleteForeignKeyScriptDtos"),Lh=i((t,e)=>r=>r.filter(n=>uc(n)&&pc(n)).map(n=>{let s=lc(t,e)(n),a=cc(t,e)(n),o=a.isActivated&&s.isActivated;return ds.getDropAndRecreateInstance(s.statement,a.statement,o)}).filter(Boolean).filter(n=>n.scripts.some(s=>!!s.script)),"getModifyForeignKeyScriptDtos");mc.exports={getDeleteForeignKeyScriptDtos:Dh,getModifyForeignKeyScriptDtos:Lh,getAddForeignKeyScriptDtos:Ph}});var _c=A((jE,gc)=>{"use strict";var{AlterScriptDto:fc}=ae(),hc=i(t=>{var e,r;return((r=(e=t==null?void 0:t.role)==null?void 0:e.compMod)==null?void 0:r.description)||{}},"extractDescription"),xh=i((t,e)=>r=>{let{getFullViewName:n,wrapComment:s}=B()(t),a=hc(r);if(a.new&&a.new!==a.old){let o=s(a.new),c=n(r),u=e.updateViewComment(c,o);return fc.getInstance([u],!0,!1)}},"getUpsertCommentsScriptDto"),Mh=i((t,e)=>r=>{let n=hc(r),{getFullViewName:s}=B()(t);if(n.old&&!n.new){let a=s(r),o=e.dropViewComment(a);return fc.getInstance([o],!0,!0)}},"getDropCommentsScriptDto"),qh=i((t,e)=>r=>{let n=xh(t,e)(r),s=Mh(t,e)(r);return[n,s].filter(Boolean)},"getModifyViewCommentsScriptDtos");gc.exports={getModifyViewCommentsScriptDtos:qh}});var Tc=A((XE,Ec)=>{"use strict";var{AlterScriptDto:yc}=ae(),{getModifyViewCommentsScriptDtos:Fh}=_c(),kh=i(t=>e=>{let r=ee()(null,null,t),n={name:e.code||e.name,keys:[],schemaData:{schemaName:""}},s=r.hydrateView({viewData:n,entityData:[e]}),a=r.createView(s,{},e.isActivated);return yc.getInstance([a],!0,!1)},"getAddViewScriptDto"),$h=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t),{wrapInQuotes:s}=B()(r),a=s(e.code||e.name),o=n.dropView(a);return yc.getInstance([o],!0,!0)},"getDeleteViewScriptDto"),Bh=i(t=>e=>{let r=t.require("lodash"),n=ee()(null,null,t);return[...Fh(r,n)(e)]},"getModifyViewScriptDtos");Ec.exports={getAddViewScriptDto:kh,getDeleteViewScriptDto:$h,getModifyViewScriptDtos:Bh}});var Ac=A((eT,Sc)=>{"use strict";var{AlterScriptDto:ZE}=ae(),{getAddContainerScriptDto:Uh,getDeleteContainerScriptDto:Kh,getModifyContainerScriptDtos:Gh}=Lo(),{getAddCollectionScriptDto:Vh,getDeleteCollectionScriptDto:Hh,getAddColumnScriptDtos:Qh,getDeleteColumnScriptDtos:Yh,getModifyColumnScriptDtos:Wh,getModifyCollectionScriptDtos:jh}=nc(),{getDeleteUdtScriptDto:zh,getCreateUdtScriptDto:Xh,getAddColumnToTypeScriptDtos:Jh,getDeleteColumnFromTypeScriptDtos:Zh,getModifyColumnOfTypeScriptDtos:eg}=ic(),{getModifyForeignKeyScriptDtos:tg,getDeleteForeignKeyScriptDtos:rg,getAddForeignKeyScriptDtos:ng}=dc(),{getAddViewScriptDto:sg,getDeleteViewScriptDto:ig,getModifyViewScriptDtos:ag}=Tc(),og=i(({collection:t,app:e})=>{var u,l,m,p,d,f,y,g,E,_,b,C;let r=(p=(m=(l=(u=t.properties)==null?void 0:u.containers)==null?void 0:l.properties)==null?void 0:m.added)==null?void 0:p.items,n=(g=(y=(f=(d=t.properties)==null?void 0:d.containers)==null?void 0:f.properties)==null?void 0:y.deleted)==null?void 0:g.items,s=(C=(b=(_=(E=t.properties)==null?void 0:E.containers)==null?void 0:_.properties)==null?void 0:b.modified)==null?void 0:C.items,a=[].concat(r).filter(Boolean).map(P=>Uh(e)(Object.keys(P.properties)[0])),o=[].concat(n).filter(Boolean).map(P=>Kh(e)(Object.keys(P.properties)[0])),c=[].concat(s).filter(Boolean).map(P=>Object.values(P.properties)[0]).flatMap(P=>Gh(e)(P));return[...a,...o,...c].filter(Boolean)},"getAlterContainersScriptDtos"),cg=i(({collection:t,app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})=>{var g,E,_,b,C,P,x,$,U,V,v,O;let o=[].concat((b=(_=(E=(g=t.properties)==null?void 0:g.entities)==null?void 0:E.properties)==null?void 0:_.added)==null?void 0:b.items).filter(Boolean).map(F=>Object.values(F.properties)[0]),c=[].concat(($=(x=(P=(C=t.properties)==null?void 0:C.entities)==null?void 0:P.properties)==null?void 0:x.deleted)==null?void 0:$.items).filter(Boolean).map(F=>Object.values(F.properties)[0]),u=[].concat((O=(v=(V=(U=t.properties)==null?void 0:U.entities)==null?void 0:V.properties)==null?void 0:v.modified)==null?void 0:O.items).filter(Boolean).map(F=>Object.values(F.properties)[0]),l=o.filter(F=>{var K;return(K=F.compMod)==null?void 0:K.created}).map(Vh({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})),m=c.filter(F=>{var K;return(K=F.compMod)==null?void 0:K.deleted}).map(Hh(e)),p=u.map(jh(e)).flat(),d=o.filter(F=>{var K;return!((K=F==null?void 0:F.compMod)!=null&&K.created)}).flatMap(Qh({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})),f=c.filter(F=>{var K;return!((K=F==null?void 0:F.compMod)!=null&&K.deleted)}).flatMap(Yh(e)),y=u.flatMap(Wh(e));return[...l,...m,...p,...d,...f,...y].filter(Boolean)},"getAlterCollectionsScriptDtos"),ug=i((t,e)=>{var a,o,c,u,l,m,p,d,f,y,g,E;let r=[].concat((u=(c=(o=(a=t.properties)==null?void 0:a.views)==null?void 0:o.properties)==null?void 0:c.added)==null?void 0:u.items).filter(Boolean).map(_=>Object.values(_.properties)[0]).map(_=>({..._,..._.role||{}})).filter(_=>{var b;return((b=_.compMod)==null?void 0:b.created)&&_.selectStatement}).map(sg(e)),n=[].concat((d=(p=(m=(l=t.properties)==null?void 0:l.views)==null?void 0:m.properties)==null?void 0:p.deleted)==null?void 0:d.items).filter(Boolean).map(_=>Object.values(_.properties)[0]).map(_=>({..._,..._.role||{}})).map(ig(e)),s=[].concat((E=(g=(y=(f=t.properties)==null?void 0:f.views)==null?void 0:y.properties)==null?void 0:g.modified)==null?void 0:E.items).filter(Boolean).map(_=>Object.values(_.properties)[0]).map(_=>({..._,..._.role||{}})).flatMap(_=>ag(e)(_));return[...n,...r,...s].filter(Boolean)},"getAlterViewScriptDtos"),lg=i(({collection:t,app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})=>{var p,d,f,y,g,E,_,b,C,P,x,$,U,V,v,O,F,K,Me,qe;let o=[].concat((y=(f=(d=(p=t.properties)==null?void 0:p.modelDefinitions)==null?void 0:d.properties)==null?void 0:f.added)==null?void 0:y.items).filter(Boolean).map(L=>Object.values(L.properties)[0]).map(L=>({...L,...e.require("lodash").omit(L.role,"properties")||{}})).filter(L=>{var S;return(S=L.compMod)==null?void 0:S.created}).map(Xh({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})),c=[].concat((b=(_=(E=(g=t.properties)==null?void 0:g.modelDefinitions)==null?void 0:E.properties)==null?void 0:_.deleted)==null?void 0:b.items).filter(Boolean).map(L=>Object.values(L.properties)[0]).map(L=>({...L,...e.require("lodash").omit(L.role,"properties")||{}})).filter(L=>{var S;return(S=L.compMod)==null?void 0:S.deleted}).map(zh(e)),u=[].concat(($=(x=(P=(C=t.properties)==null?void 0:C.modelDefinitions)==null?void 0:P.properties)==null?void 0:x.added)==null?void 0:$.items).filter(Boolean).map(L=>Object.values(L.properties)[0]).filter(L=>!L.compMod).map(L=>({...L,...e.require("lodash").omit(L.role,"properties")||{}})).filter(L=>L.childType==="composite").flatMap(Jh({app:e,dbVersion:r,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a})),l=[].concat((O=(v=(V=(U=t.properties)==null?void 0:U.modelDefinitions)==null?void 0:V.properties)==null?void 0:v.deleted)==null?void 0:O.items).filter(Boolean).map(L=>Object.values(L.properties)[0]).filter(L=>!L.compMod).map(L=>({...L,...e.require("lodash").omit(L.role,"properties")||{}})).filter(L=>L.childType==="composite").flatMap(Zh(e)),m=[].concat((qe=(Me=(K=(F=t.properties)==null?void 0:F.modelDefinitions)==null?void 0:K.properties)==null?void 0:Me.modified)==null?void 0:qe.items).filter(Boolean).map(L=>Object.values(L.properties)[0]).filter(L=>!L.compMod).map(L=>({...L,...e.require("lodash").omit(L.role,"properties")||{}})).filter(L=>L.childType==="composite").flatMap(eg(e));return[...c,...o,...u,...l,...m].filter(Boolean)},"getAlterModelDefinitionsScriptDtos"),pg=i(({collection:t,app:e})=>{var m,p,d,f,y,g,E,_,b,C,P,x;let r=e.require("lodash"),n=ee()(null,null,e),s=[].concat((f=(d=(p=(m=t.properties)==null?void 0:m.relationships)==null?void 0:p.properties)==null?void 0:d.added)==null?void 0:f.items).filter(Boolean).map($=>Object.values($.properties)[0]).filter($=>{var U,V;return(V=(U=$==null?void 0:$.role)==null?void 0:U.compMod)==null?void 0:V.created}),a=[].concat((_=(E=(g=(y=t.properties)==null?void 0:y.relationships)==null?void 0:g.properties)==null?void 0:E.deleted)==null?void 0:_.items).filter(Boolean).map($=>Object.values($.properties)[0]).filter($=>{var U,V;return(V=(U=$==null?void 0:$.role)==null?void 0:U.compMod)==null?void 0:V.deleted}),o=[].concat((x=(P=(C=(b=t.properties)==null?void 0:b.relationships)==null?void 0:C.properties)==null?void 0:P.modified)==null?void 0:x.items).filter(Boolean).map($=>Object.values($.properties)[0]).filter($=>{var U,V;return(V=(U=$==null?void 0:$.role)==null?void 0:U.compMod)==null?void 0:V.modified}),c=rg(n,r)(a),u=ng(n,r)(s),l=tg(n,r)(o);return[...c,...u,...l].filter(Boolean)},"getAlterRelationshipsScriptDtos"),mg=i(t=>{if(!t)return;let e=t.scripts.map(r=>({...r,script:(r.script||"").trim()})).filter(r=>!!r.script);if(e.length)return{...t,scripts:e}},"prettifyAlterScriptDto"),dg=i((t,e)=>{var d;let r=JSON.parse(t.jsonSchema);if(!r)throw new Error('"comparisonModelCollection" is not found. Alter script can be generated only from Delta model');let n=JSON.parse(t.modelDefinitions),s=JSON.parse(t.internalDefinitions),a=JSON.parse(t.externalDefinitions),o=(d=t.modelData[0])==null?void 0:d.dbVersion,c=og({collection:r,app:e}),u=cg({collection:r,app:e,dbVersion:o,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a}),l=ug(r,e),m=lg({collection:r,app:e,dbVersion:o,modelDefinitions:n,internalDefinitions:s,externalDefinitions:a}),p=pg({collection:r,app:e});return[...c,...m,...u,...l,...p].filter(Boolean).map(f=>mg(f)).filter(Boolean)},"getAlterScriptDtos");Sc.exports={getAlterScriptDtos:dg}});var vc=A((nT,bc)=>{"use strict";var{getAlterScriptDtos:Yt}=Ac(),{AlterScriptDto:rT}=ae(),Cc=i(t=>(e,r)=>{let{commentIfDeactivated:n}=B()(t);return e.map(s=>s.isActivated===!1?s.scripts.map(a=>n(a.script,{isActivated:!1,isPartOfLine:!1})):r?s.scripts.map(a=>a.script):s.scripts.map(a=>n(a.script,{isActivated:!a.isDropScript,isPartOfLine:!1}))).flat().filter(Boolean).map(s=>s.trim()).filter(Boolean).join(`

`)},"joinAlterScriptDtosIntoScript"),fg=i((t,e)=>{var a,o;let r=e.require("lodash"),n=Yt(t,e),s=(o=(a=t.options)==null?void 0:a.additionalOptions)==null?void 0:o.some(c=>c.id==="applyDropStatements"&&c.value);return Cc(r)(n,s)},"buildEntityLevelAlterScript"),hg=i((t,e)=>Yt(t,e).some(n=>n.isActivated&&n.scripts.some(s=>s.isDropScript)),"doesEntityLevelAlterScriptContainDropStatements"),Nc=i(t=>({...t,jsonSchema:t.collections[0],internalDefinitions:Object.values(t.internalDefinitions)[0]}),"mapCoreDataForContainerLevelScripts"),gg=i((t,e)=>{var o,c;let r=Nc(t),n=e.require("lodash"),s=Yt(r,e),a=(c=(o=r.options)==null?void 0:o.additionalOptions)==null?void 0:c.some(u=>u.id==="applyDropStatements"&&u.value);return Cc(n)(s,a)},"buildContainerLevelAlterScript"),_g=i((t,e)=>{let r=Nc(t);return Yt(r,e).some(s=>s.isActivated&&s.scripts.some(a=>a.isDropScript))},"doesContainerLevelAlterScriptContainDropStatements");bc.exports={buildEntityLevelAlterScript:fg,doesEntityLevelAlterScriptContainDropStatements:hg,buildContainerLevelAlterScript:gg,doesContainerLevelAlterScriptContainDropStatements:_g}});var Oc=Ba(),{createLogger:yg}=jt(),Eg=Ka(),{buildEntityLevelAlterScript:Tg,buildContainerLevelAlterScript:Sg,doesContainerLevelAlterScriptContainDropStatements:Ag,doesEntityLevelAlterScriptContainDropStatements:Cg}=vc();module.exports={generateScript(t,e,r,n){try{let s=Tg(t,n);r(null,s)}catch(s){e.log("error",{message:s.message,stack:s.stack},"YugabyteDB YSQL Forward-Engineering Error"),r({message:s.message,stack:s.stack})}},generateViewScript(t,e,r,n){r(new Error("Forward-Engineering of delta model on view level is not supported"))},generateContainerScript(t,e,r,n){try{let s=Sg(t,n);r(null,s)}catch(s){e.log("error",{message:s.message,stack:s.stack},"YugabyteDB YSQL Forward-Engineering Error"),r({message:s.message,stack:s.stack})}},getDatabases(t,e,r,n){e.progress({message:"Find all databases"}),Oc.getDatabases(t,e,r,n)},applyToInstance(t,e,r,n){e.clear(),e.log("info",n.require("lodash").omit(t,"script","containerData"),"connectionInfo",t.hiddenKeys);let s=yg({title:"Apply to instance",hiddenKeys:t.hiddenKeys,logger:e});Eg.applyToInstance(t,s,n).then(r,r)},testConnection(t,e,r,n){Oc.testConnection(t,e,r,n).then(r,r)},isDropInStatements(t,e,r,n){try{if(t.level==="container"){let s=Ag(t,n);r(null,s)}else{let s=Cg(t,n);r(null,s)}}catch(s){r({message:s.message,stack:s.stack})}}};
